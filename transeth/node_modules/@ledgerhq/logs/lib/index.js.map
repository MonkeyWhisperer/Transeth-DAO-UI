{"version":3,"sources":["../src/index.js"],"names":["id","subscribers","log","type","message","data","obj","String","date","Date","dispatch","listen","cb","push","i","indexOf","length","pop","e","console","error","global","__ledgerLogsListen"],"mappings":";;;;;;;AAEA;;;AAaA,IAAIA,KAAK,CAAT;AACA,IAAMC,cAAc,EAApB;;AAEA;;;;;AAKO,IAAMC,oBAAM,SAANA,GAAM,CAACC,IAAD,EAAeC,OAAf,EAAiCC,IAAjC,EAAgD;AACjE,MAAMC,MAAW,EAAEH,UAAF,EAAQH,IAAIO,OAAO,EAAEP,EAAT,CAAZ,EAA0BQ,MAAM,IAAIC,IAAJ,EAAhC,EAAjB;AACA,MAAIL,OAAJ,EAAaE,IAAIF,OAAJ,GAAcA,OAAd;AACb,MAAIC,IAAJ,EAAUC,IAAID,IAAJ,GAAWA,IAAX;AACVK,WAASJ,GAAT;AACD,CALM;;AAOP;;;;;AAKO,IAAMK,0BAAS,SAATA,MAAS,CAACC,EAAD,EAAkC;AACtDX,cAAYY,IAAZ,CAAiBD,EAAjB;AACA,SAAO,YAAM;AACX,QAAME,IAAIb,YAAYc,OAAZ,CAAoBH,EAApB,CAAV;AACA,QAAIE,MAAM,CAAC,CAAX,EAAc;AACZ;AACAb,kBAAYa,CAAZ,IAAiBb,YAAYA,YAAYe,MAAZ,GAAqB,CAAjC,CAAjB;AACAf,kBAAYgB,GAAZ;AACD;AACF,GAPD;AAQD,CAVM;;AAYP,SAASP,QAAT,CAAkBR,GAAlB,EAA4B;AAC1B,OAAK,IAAIY,IAAI,CAAb,EAAgBA,IAAIb,YAAYe,MAAhC,EAAwCF,GAAxC,EAA6C;AAC3C,QAAI;AACFb,kBAAYa,CAAZ,EAAeZ,GAAf;AACD,KAFD,CAEE,OAAOgB,CAAP,EAAU;AACVC,cAAQC,KAAR,CAAcF,CAAd;AACD;AACF;AACF;;AAED;AACAG,OAAOC,kBAAP,GAA4BX,MAA5B","file":"index.js","sourcesContent":["// @flow\n\n/**\n * A Log object\n */\nexport type Log = {\n  type: string,\n  message?: string,\n  data?: any,\n  id: string, // unique amount all logs\n  date: Date // date of the log\n};\n\nexport type Unsubscribe = () => void;\n\nlet id = 0;\nconst subscribers = [];\n\n/**\n * log something\n * @param type a namespaced identifier of the log (it is not a level like \"debug\", \"error\" but more like \"apdu-in\", \"apdu-out\", etc...)\n * @param message a clear message of the log associated to the type\n */\nexport const log = (type: string, message?: string, data?: any) => {\n  const obj: Log = { type, id: String(++id), date: new Date() };\n  if (message) obj.message = message;\n  if (data) obj.data = data;\n  dispatch(obj);\n};\n\n/**\n * listen to logs.\n * @param cb that is called for each future log() with the Log object\n * @return a function that can be called to unsubscribe the listener\n */\nexport const listen = (cb: Log => void): Unsubscribe => {\n  subscribers.push(cb);\n  return () => {\n    const i = subscribers.indexOf(cb);\n    if (i !== -1) {\n      // equivalent of subscribers.splice(i, 1) // https://twitter.com/Rich_Harris/status/1125850391155965952\n      subscribers[i] = subscribers[subscribers.length - 1];\n      subscribers.pop();\n    }\n  };\n};\n\nfunction dispatch(log: Log) {\n  for (let i = 0; i < subscribers.length; i++) {\n    try {\n      subscribers[i](log);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n}\n\n// for debug purpose\nglobal.__ledgerLogsListen = listen;\n"]}