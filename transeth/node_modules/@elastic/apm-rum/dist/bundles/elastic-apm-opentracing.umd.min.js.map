{"version":3,"sources":["webpack://@elastic/apm-rum/../node_modules/error-stack-parser/error-stack-parser.js","webpack://@elastic/apm-rum/../node_modules/opentracing/lib/constants.js","webpack://@elastic/apm-rum/../node_modules/opentracing/lib/functions.js","webpack://@elastic/apm-rum/../node_modules/opentracing/lib/noop.js","webpack://@elastic/apm-rum/../node_modules/opentracing/lib/reference.js","webpack://@elastic/apm-rum/../node_modules/opentracing/lib/span.js","webpack://@elastic/apm-rum/../node_modules/opentracing/lib/span_context.js","webpack://@elastic/apm-rum/../node_modules/opentracing/lib/tracer.js","webpack://@elastic/apm-rum/../node_modules/stackframe/stackframe.js","webpack://@elastic/apm-rum/webpack/bootstrap","webpack://@elastic/apm-rum/webpack/runtime/compat get default export","webpack://@elastic/apm-rum/webpack/runtime/define property getters","webpack://@elastic/apm-rum/webpack/runtime/hasOwnProperty shorthand","webpack://@elastic/apm-rum/../rum-core/dist/es/error-logging/stack-trace.js","webpack://@elastic/apm-rum/../node_modules/promise-polyfill/src/finally.js","webpack://@elastic/apm-rum/../node_modules/promise-polyfill/src/index.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/polyfills.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/utils.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/url.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/constants.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/context.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/truncate.js","webpack://@elastic/apm-rum/../rum-core/dist/es/error-logging/error-logging.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/queue.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/ndjson.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/patching/patch-utils.js","webpack://@elastic/apm-rum/../rum-core/dist/es/performance-monitoring/span-base.js","webpack://@elastic/apm-rum/../rum-core/dist/es/performance-monitoring/span.js","webpack://@elastic/apm-rum/../rum-core/dist/es/state.js","webpack://@elastic/apm-rum/../rum-core/dist/es/performance-monitoring/capture-navigation.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/compress.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/apm-server.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/throttle.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/event-handler.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/config-service.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/service-factory.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/logging-service.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/patching/xhr-patch.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/patching/event-target-patch.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/patching/index.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/patching/fetch-patch.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/patching/history-patch.js","webpack://@elastic/apm-rum/../rum-core/dist/es/performance-monitoring/performance-monitoring.js","webpack://@elastic/apm-rum/../rum-core/dist/es/performance-monitoring/breakdown.js","webpack://@elastic/apm-rum/../rum-core/dist/es/performance-monitoring/transaction.js","webpack://@elastic/apm-rum/../rum-core/dist/es/performance-monitoring/metrics.js","webpack://@elastic/apm-rum/../rum-core/dist/es/performance-monitoring/transaction-service.js","webpack://@elastic/apm-rum/../rum-core/dist/es/index.js","webpack://@elastic/apm-rum/../rum-core/dist/es/performance-monitoring/index.js","webpack://@elastic/apm-rum/../rum-core/dist/es/error-logging/index.js","webpack://@elastic/apm-rum/../rum-core/dist/es/bootstrap.js","webpack://@elastic/apm-rum/./src/apm-base.js","webpack://@elastic/apm-rum/../rum-core/dist/es/common/instrument.js","webpack://@elastic/apm-rum/./src/index.js","webpack://@elastic/apm-rum/../rum-core/dist/es/opentracing/span.js","webpack://@elastic/apm-rum/../rum-core/dist/es/opentracing/tracer.js","webpack://@elastic/apm-rum/./src/opentracing.js","webpack://@elastic/apm-rum/../rum-core/dist/es/opentracing/index.js"],"names":["StackFrame","FIREFOX_SAFARI_STACK_REGEXP","CHROME_IE_STACK_REGEXP","SAFARI_NATIVE_CODE_REGEXP","_map","array","fn","thisArg","Array","prototype","map","output","length","i","call","_filter","filter","push","parse","error","stacktrace","this","parseOpera","stack","match","parseV8OrIE","parseFFOrSafari","Error","extractLocation","urlLike","indexOf","parts","exec","replace","undefined","split","line","tokens","slice","locationParts","pop","functionName","join","fileName","target","_indexOf","e","message","parseOpera9","parseOpera11","parseOpera10","lineRE","lines","result","len","argsRaw","functionCall","shift","args","Object","defineProperty","exports","value","FORMAT_BINARY","FORMAT_TEXT_MAP","FORMAT_HTTP_HEADERS","REFERENCE_CHILD_OF","REFERENCE_FOLLOWS_FROM","Constants","reference_1","span_1","childOf","spanContext","default","context","followsFrom","span_context_1","tracer_1","tracer","span","initialize","Reference","type","referencedContext","_type","_referencedContext","noop","Span","_context","_tracer","setOperationName","name","_setOperationName","setBaggageItem","key","_setBaggageItem","getBaggageItem","_getBaggageItem","setTag","_addTags","_a","addTags","keyValueMap","log","keyValuePairs","timestamp","_log","logEvent","eventName","payload","event","finish","finishTime","_finish","SpanContext","Functions","Noop","Tracer","startSpan","options","references","_startSpan","inject","format","carrier","_inject","extract","_extract","fields","_isNumber","n","isNaN","parseFloat","isFinite","lineNumber","columnNumber","source","setFunctionName","setArgs","setFileName","setLineNumber","setColumnNumber","setSource","getFunctionName","v","String","getArgs","toString","TypeError","getFileName","getLineNumber","Number","getColumnNumber","getSource","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","module","__webpack_modules__","getter","__esModule","d","a","definition","o","enumerable","get","obj","prop","hasOwnProperty","createStackTraces","errorEvent","filename","lineno","colno","stackTraces","stackParser","frame","fnName","_stack$functionName","fileUrl","origin","filePath","cleanFilePath","cleanedFileName","window","location","protocol","hostname","port","href","isFileInline","abs_path","function","callback","constructor","then","resolve","reason","reject","setTimeoutFunc","setTimeout","isArray","x","Boolean","Promise","_state","_handled","_value","_deferreds","doResolve","handle","self","deferred","_immediateFn","cb","onFulfilled","onRejected","ret","promise","newValue","finale","apply","arguments","_unhandledRejectionFn","Handler","done","ex","prom","all","arr","remaining","res","val","race","setImmediate","err","console","warn","local","isBrowser","PromisePollyfill","PERF","performance","byteToHex","substr","destination","Uint8Array","generateRandomId","buffer","hexOctets","_i","bytesToHex","crypto","getRandomValues","msCrypto","setRequestHeader","headers","append","checkSameOrigin","isSame","test","forEach","t","isPlatformSupported","Set","JSON","stringify","now","XMLHttpRequest","setLabel","skey","removeInvalidChars","valueType","getTimeOrigin","timing","fetchStart","stripQueryStringFromUrl","url","isObject","baseExtend","dst","objs","deep","ii","keys","j","jj","src","getCurrentScript","document","currentScript","scripts","getElementsByTagName","l","sc","getElasticScript","extend","merge","isUndefined","getTime","time","getDuration","start","end","parseInt","scheduleMicroTask","isPerfTimelineSupported","getEntriesByType","isPerfTypeSupported","PerformanceObserver","supportedEntryTypes","RULES","NaN","PROTOCOL_REGEX","Url","index","_this$extractProtocol","extractProtocol","address","slashes","relative","getLocation","instructions","instruction","instLength","newIndex","lastIndexOf","Math","max","toLowerCase","path","charAt","host","isDefaultPort","_proto","auth","userpass","query","hash","globalVar","INVOKE","RESOURCE_INITIATOR_TYPES","PAGE_LOAD","TRANSACTION_TYPE_ORDER","_excluded","getResponseContext","perfTimingEntry","respContext","transfer_size","transferSize","encoded_body_size","encodedBodySize","decoded_body_size","decodedBodySize","serverTimingStr","serverTimingEntries","serverTimingInfo","_i2","_serverTimingEntries$","duration","description","timingValue","valueSeparator","getServerTimingInfo","serverTiming","getDestination","parsedUrl","portNumber","getPortNumber","ipv6Hostname","charCodeAt","service","resource","getPageContext","page","referer","referrer","addSpanContext","data","statusCode","method","response","http","status","status_code","getExternalContext","entry","getResourceContext","getNavigationContext","addContext","addTransactionContext","transaction","_temp","_ref","configContext","tags","excluded","sourceKeys","_objectWithoutPropertiesLoose","pageContext","responseContext","entries","METADATA_MODEL","version","agent","environment","labels","RESPONSE_MODEL","CONTEXT_MODEL","user","id","email","username","SPAN_MODEL","trace_id","parent_id","transaction_id","subtype","action","TRANSACTION_MODEL","span_count","started","ERROR_MODEL","culprit","exception","isEmpty","replaceValue","currModel","limit","required","placeholder","substring","truncate","truncateModel","model","childTarget","emptyArr","_loop","currKey","IGNORE_KEYS","ErrorLogging","apmServer","configService","transactionService","_apmServer","_configService","_transactionService","createErrorDataModel","filteredFrames","frames","filterInvalidFrames","lastFrame","errorMessage","errorType","errorContext","customProperties","propertyFound","properties","toISOString","getErrorProperties","custom","currentTransaction","getCurrentTransaction","transactionContext","_this$_configService$","errorObject","traceId","sampled","logErrorEvent","addError","registerListeners","_this","addEventListener","promiseRejectionEvent","logPromiseEvent","prefix","logError","messageOrError","Queue","onFlush","opts","items","queueLimit","flushInterval","timeoutId","_setTimer","flush","_clear","clearTimeout","add","item","NDJSON","object","globalState","fetchInProgress","apmSymbol","patchMethod","patchFn","proto","getPrototypeOf","delegate","patched","original","propertyDesc","delegateName","desc","getOwnPropertyDescriptor","writable","set","patchDelegate","XHR_IGNORE","XHR_SYNC","XHR_URL","XHR_METHOD","SpanBase","sampleRate","_start","startTime","_end","ended","outcome","onEnd","ensureContext","addLabels","ctx","k","_len","_key","concat","endTime","callOnEnd","_setPrototypeOf","p","setPrototypeOf","__proto__","_SpanBase","subClass","superClass","parentId","sync","create","state","bootstrapTime","lastHiddenStart","MIN_SAFE_INTEGER","eventPairs","shouldCreateSpan","trStart","trEnd","baseTime","createResourceTimingSpan","resourceTimingEntry","initiatorType","responseEnd","kind","spanName","isCapturedByPatching","resourceStartTime","requestPatchTime","NAVIGATION_TIMING_MARKS","COMPRESSED_NAV_TIMING_MARKS","getPageLoadMarks","marks","navigationStart","responseStart","timingKey","m","getNavigationTimingMarks","navigationTiming","timeToFirstByte","domInteractive","domComplete","captureNavigation","captureTimings","customMarks","timings","spans","pageResponse","createNavigationTimingSpans","pageLoadSpanId","addMarks","_trStart","_entries$i","createResourceTimingSpans","userTimingSpans","_entries$i2","createUserTimingSpans","compressResponse","ts","ebs","dbs","compressContext","compressed","rf","h","mt","r","compressHTTP","dt","se","rc","ad","po","u","un","em","cu","compressMarks","nt","mark","mapping","fb","rs","di","dc","fp","firstContentfulPaint","lp","largestContentfulPaint","ApmServer","loggingService","_loggingService","queue","throttleEvents","init","events","sendEvents","catch","_constructError","onThrottle","interval","counter","throttle","bind","_postJson","endPoint","_this2","params","beforeSend","isCompressionStreamSupported","CompressionStream","compressedStream","Blob","stream","pipeThrough","Response","blob","compressPayload","_makeHttpRequest","responseText","_ref2","_ref2$timeout","timeout","xhr","open","header","onreadystatechange","readyState","onerror","canSend","send","fetchConfig","serviceName","_this3","configEndpoint","localConfig","getLocalConfig","etag","apmRequest","remoteConfig","getResponseHeader","setLocalConfig","createMetaData","cfg","metadata","language","_this$throttleEvents","addTransaction","_this$throttleEvents2","ndjsonErrors","errors","compress","_NDJSON$stringify","cl","mg","st","ap","f","li","co","c","tid","pid","xid","sm","compressError","ndjsonMetricsets","metricsets","metricset","ndjsonTransactions","transactions","_this4","tr","_NDJSON$stringify2","breakdowns","breakdown","spanData","s","sr","sample_rate","sy","su","ac","me","samples","isSpan","y","sa","ysc","yss","xdc","xds","xbc","yc","sd","experience","_transaction$experien","cls","fid","tbt","longtask","exp","lt","session","_transaction$session","sequence","ses","seq","compressTransaction","_payload","_NDJSON$stringify3","filteredPayload","applyFilters","apiVersion","ndjson","metadataKey","ve","la","en","compressMetadata","ndjsonPayload","EventHandler","observers","observe","splice","sendOnly","obs","_extends","assign","_serviceCreators","Config","config","serviceVersion","serverUrl","active","instrument","disableInstrumentations","logLevel","breakdownMetrics","ignoreTransactions","eventsLimit","distributedTracing","distributedTracingOrigins","distributedTracingHeaderName","pageLoadTraceId","pageLoadSampled","pageLoadTransactionName","propagateTracestate","transactionSampleRate","centralConfig","monitorLongtasks","filters","scriptData","node","dataAttrs","dataRegex","attrs","attributes","attr","nodeName","camelCasedkey","toUpperCase","nodeValue","getDataAttributesFromNode","setConfig","setVersion","addFilter","reduce","objKey","setUserContext","userContext","_userContext","setCustomContext","customContext","_properties","round","validate","requiredKeys","missing","invalid","allowed","storage","sessionStorage","localStorage","getItem","setItem","LoggingService","spec","levels","level","resetLogMethods","shouldLog","setLevel","normalizedLevel","realMethod","serviceCreators","ConfigService","factory","_factory$getService","getService","ServiceFactory","instances","initialized","_this$getService","patchXMLHttpRequest","XMLHttpRequestPrototype","openNative","sendNative","task","addListener","invokeTask","scheduleTask","eventTypes","eventTypeSymbols","et","shouldInstrumentEvent","eventType","listenerFn","Element","patchEventHandler","alreadyPatched","patchAll","fetch","Request","nativeFetch","input","request","fetchSelf","aborted","patchFetch","history","nativePushState","pushState","title","patchHistory","EventTarget","nativeAddEventListener","nativeRemoveEventListener","optionsOrCapture","wrappingListenerFn","createListenerWrapper","wrappingFn","getWrappingFn","findTaskIndex","existingTasks","capture","isCapture","eventSymbol","taskIndex","patchEventTarget","PerformanceMonitoring","_logginService","flags","TRANSACTION_END","createTransactionPayload","getHistorySub","getXHRSub","getFetchSub","getEventTargetSub","getAttribute","additionalInfo","tagName","startTransaction","managed","canReuse","reuseThreshold","classes","processAPICalls","requestUrl","blocking","isDtEnabled","dtOrigins","currentUrl","isSameOrigin","injectDtHeader","injectTSHeader","process","_data","_span","_target","endSpan","headerName","headerValue","dtVersion","getDtHeaderValue","getTSHeaderValue","extractDtHeader","parsed","parseDtHeaderValue","filterTransaction","isManaged","createTransactionDataModel","transactionStart","transactionData","breakdownTimings","adjustedTransaction","filterdSpans","similarSpans","originalSpans","transDuration","threshold","sort","spanA","spanB","lastCount","lastSpan","isContinuouslySimilar","isLastSpan","groupSmallContinuouslySimilarSpans","resetFields","adjustTransaction","pageLoadBreakdowns","getValue","getSpanBreakdown","transactionDetails","details","_ref$count","count","Transaction","_activeSpans","_activeTasks","blocked","random","markTime","redefine","trc","_onSpanEnd","addTask","isFinished","size","detectFinish","sid","captureBreakdown","trDuration","current","spanMap","transactionSelfTime","span1","span2","spanEnd","spanStart","lastContinuousEnd","selfTime","calculateSelfTime","groupSpans","_key$split","_spanMap$key","_captureBreakdown","block","flag","taskId","removeTask","delete","metrics","fcp","Infinity","captureObserverEntries","list","isHardNavigation","longtaskEntries","longtasks","agg","_longtasks$i","attribution","_attribution$","_name","containerType","containerName","containerId","createLongTaskSpans","lcpEntries","lastLcpEntry","lcp","unloadDiff","fcpEntry","getEntriesByName","fidSpan","fidEntries","firstInput","processingStart","createFirstInputDelaySpan","min","blockingTime","calculateTotalBlockingTime","clsEntries","hadRecentInput","calculateCumulativeLayoutShift","PerfEntryRecorder","disconnect","buffered","_","stop","TransactionService","logger","_config","_logger","respIntervalId","recorder","_tr$spans","_captureObserverEntri","createCurrentTransaction","createOptions","perfOptions","startManagedTransaction","isRedefined","redefineType","currentTypeOrder","redefineTypeOrder","fireOnstartHook","handleTransactionEnd","shouldIgnoreTransaction","tbtObject","tbtSpan","sum","setSession","urlStr","depth","pathParts","specialCharsRegex","digitsRegex","lowerCaseRegex","upperCaseRegex","redactedParts","redactedBefore","part","numberOfDigits","numberofUpperCase","lowerCaseRate","upperCaseRate","slugifyUrl","adjustTransactionTime","Date","sessionConfig","earliestSpan","_i4","getEarliestSpan","latestSpan","_i3","getLatestNonXHRSpan","transactionEnd","transactionName","ignoreList","element","createServiceFactory","serviceFactory","_serviceFactory$getSe","_serviceFactory$getSe2","enabled","bootstrap","visibilityState","bootstrapPerf","ApmBase","disable","_disable","_initialized","isEnabled","isActive","disabledInstrumentations","_flags","getInstrumentationFlags","sendPageLoad","_sendPageLoadMetrics","fetchCentralConfig","sendPageLoadMetrics","setInitialPageLoadName","captureError","apmBase","elasticApm","getApmBase","_otSpan","__tracer","isTransaction","userId","errorLogging","otSpan","_otTracer","performanceMonitoring","spanOptions","childRef","predicate","kValue","find","ref","NoopSpan","otTracer","createTracer"],"mappings":"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","file":"elastic-apm-opentracing.umd.min.js","sourcesContent":["(function(root, factory) {\n    'use strict';\n    // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js, Rhino, and browsers.\n\n    /* istanbul ignore next */\n    if (typeof define === 'function' && define.amd) {\n        define('error-stack-parser', ['stackframe'], factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory(require('stackframe'));\n    } else {\n        root.ErrorStackParser = factory(root.StackFrame);\n    }\n}(this, function ErrorStackParser(StackFrame) {\n    'use strict';\n\n    var FIREFOX_SAFARI_STACK_REGEXP = /(^|@)\\S+\\:\\d+/;\n    var CHROME_IE_STACK_REGEXP = /^\\s*at .*(\\S+\\:\\d+|\\(native\\))/m;\n    var SAFARI_NATIVE_CODE_REGEXP = /^(eval@)?(\\[native code\\])?$/;\n\n    function _map(array, fn, thisArg) {\n        if (typeof Array.prototype.map === 'function') {\n            return array.map(fn, thisArg);\n        } else {\n            var output = new Array(array.length);\n            for (var i = 0; i < array.length; i++) {\n                output[i] = fn.call(thisArg, array[i]);\n            }\n            return output;\n        }\n    }\n\n    function _filter(array, fn, thisArg) {\n        if (typeof Array.prototype.filter === 'function') {\n            return array.filter(fn, thisArg);\n        } else {\n            var output = [];\n            for (var i = 0; i < array.length; i++) {\n                if (fn.call(thisArg, array[i])) {\n                    output.push(array[i]);\n                }\n            }\n            return output;\n        }\n    }\n\n    function _indexOf(array, target) {\n        if (typeof Array.prototype.indexOf === 'function') {\n            return array.indexOf(target);\n        } else {\n            for (var i = 0; i < array.length; i++) {\n                if (array[i] === target) {\n                    return i;\n                }\n            }\n            return -1;\n        }\n    }\n\n    return {\n        /**\n         * Given an Error object, extract the most information from it.\n         *\n         * @param {Error} error object\n         * @return {Array} of StackFrames\n         */\n        parse: function ErrorStackParser$$parse(error) {\n            if (typeof error.stacktrace !== 'undefined' || typeof error['opera#sourceloc'] !== 'undefined') {\n                return this.parseOpera(error);\n            } else if (error.stack && error.stack.match(CHROME_IE_STACK_REGEXP)) {\n                return this.parseV8OrIE(error);\n            } else if (error.stack) {\n                return this.parseFFOrSafari(error);\n            } else {\n                throw new Error('Cannot parse given Error object');\n            }\n        },\n\n        // Separate line and column numbers from a string of the form: (URI:Line:Column)\n        extractLocation: function ErrorStackParser$$extractLocation(urlLike) {\n            // Fail-fast but return locations like \"(native)\"\n            if (urlLike.indexOf(':') === -1) {\n                return [urlLike];\n            }\n\n            var regExp = /(.+?)(?:\\:(\\d+))?(?:\\:(\\d+))?$/;\n            var parts = regExp.exec(urlLike.replace(/[\\(\\)]/g, ''));\n            return [parts[1], parts[2] || undefined, parts[3] || undefined];\n        },\n\n        parseV8OrIE: function ErrorStackParser$$parseV8OrIE(error) {\n            var filtered = _filter(error.stack.split('\\n'), function(line) {\n                return !!line.match(CHROME_IE_STACK_REGEXP);\n            }, this);\n\n            return _map(filtered, function(line) {\n                if (line.indexOf('(eval ') > -1) {\n                    // Throw away eval information until we implement stacktrace.js/stackframe#8\n                    line = line.replace(/eval code/g, 'eval').replace(/(\\(eval at [^\\()]*)|(\\)\\,.*$)/g, '');\n                }\n                var tokens = line.replace(/^\\s+/, '').replace(/\\(eval code/g, '(').split(/\\s+/).slice(1);\n                var locationParts = this.extractLocation(tokens.pop());\n                var functionName = tokens.join(' ') || undefined;\n                var fileName = _indexOf(['eval', '<anonymous>'], locationParts[0]) > -1 ? undefined : locationParts[0];\n\n                return new StackFrame(functionName, undefined, fileName, locationParts[1], locationParts[2], line);\n            }, this);\n        },\n\n        parseFFOrSafari: function ErrorStackParser$$parseFFOrSafari(error) {\n            var filtered = _filter(error.stack.split('\\n'), function(line) {\n                return !line.match(SAFARI_NATIVE_CODE_REGEXP);\n            }, this);\n\n            return _map(filtered, function(line) {\n                // Throw away eval information until we implement stacktrace.js/stackframe#8\n                if (line.indexOf(' > eval') > -1) {\n                    line = line.replace(/ line (\\d+)(?: > eval line \\d+)* > eval\\:\\d+\\:\\d+/g, ':$1');\n                }\n\n                if (line.indexOf('@') === -1 && line.indexOf(':') === -1) {\n                    // Safari eval frames only have function names and nothing else\n                    return new StackFrame(line);\n                } else {\n                    var tokens = line.split('@');\n                    var locationParts = this.extractLocation(tokens.pop());\n                    var functionName = tokens.join('@') || undefined;\n                    return new StackFrame(functionName,\n                        undefined,\n                        locationParts[0],\n                        locationParts[1],\n                        locationParts[2],\n                        line);\n                }\n            }, this);\n        },\n\n        parseOpera: function ErrorStackParser$$parseOpera(e) {\n            if (!e.stacktrace || (e.message.indexOf('\\n') > -1 &&\n                e.message.split('\\n').length > e.stacktrace.split('\\n').length)) {\n                return this.parseOpera9(e);\n            } else if (!e.stack) {\n                return this.parseOpera10(e);\n            } else {\n                return this.parseOpera11(e);\n            }\n        },\n\n        parseOpera9: function ErrorStackParser$$parseOpera9(e) {\n            var lineRE = /Line (\\d+).*script (?:in )?(\\S+)/i;\n            var lines = e.message.split('\\n');\n            var result = [];\n\n            for (var i = 2, len = lines.length; i < len; i += 2) {\n                var match = lineRE.exec(lines[i]);\n                if (match) {\n                    result.push(new StackFrame(undefined, undefined, match[2], match[1], undefined, lines[i]));\n                }\n            }\n\n            return result;\n        },\n\n        parseOpera10: function ErrorStackParser$$parseOpera10(e) {\n            var lineRE = /Line (\\d+).*script (?:in )?(\\S+)(?:: In function (\\S+))?$/i;\n            var lines = e.stacktrace.split('\\n');\n            var result = [];\n\n            for (var i = 0, len = lines.length; i < len; i += 2) {\n                var match = lineRE.exec(lines[i]);\n                if (match) {\n                    result.push(\n                        new StackFrame(\n                            match[3] || undefined,\n                            undefined,\n                            match[2],\n                            match[1],\n                            undefined,\n                            lines[i]\n                        )\n                    );\n                }\n            }\n\n            return result;\n        },\n\n        // Opera 10.65+ Error.stack very similar to FF/Safari\n        parseOpera11: function ErrorStackParser$$parseOpera11(error) {\n            var filtered = _filter(error.stack.split('\\n'), function(line) {\n                return !!line.match(FIREFOX_SAFARI_STACK_REGEXP) && !line.match(/^Error created at/);\n            }, this);\n\n            return _map(filtered, function(line) {\n                var tokens = line.split('@');\n                var locationParts = this.extractLocation(tokens.pop());\n                var functionCall = (tokens.shift() || '');\n                var functionName = functionCall\n                        .replace(/<anonymous function(: (\\w+))?>/, '$2')\n                        .replace(/\\([^\\)]*\\)/g, '') || undefined;\n                var argsRaw;\n                if (functionCall.match(/\\(([^\\)]*)\\)/)) {\n                    argsRaw = functionCall.replace(/^[^\\(]+\\(([^\\)]*)\\)$/, '$1');\n                }\n                var args = (argsRaw === undefined || argsRaw === '[arguments not available]') ?\n                    undefined : argsRaw.split(',');\n                return new StackFrame(\n                    functionName,\n                    args,\n                    locationParts[0],\n                    locationParts[1],\n                    locationParts[2],\n                    line);\n            }, this);\n        }\n    };\n}));\n\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * The FORMAT_BINARY format represents SpanContexts in an opaque binary\n * carrier.\n *\n * Tracer.inject() will set the buffer field to an Array-like (Array,\n * ArrayBuffer, or TypedBuffer) object containing the injected binary data.\n * Any valid Object can be used as long as the buffer field of the object\n * can be set.\n *\n * Tracer.extract() will look for `carrier.buffer`, and that field is\n * expected to be an Array-like object (Array, ArrayBuffer, or\n * TypedBuffer).\n */\nexports.FORMAT_BINARY = 'binary';\n/**\n * The FORMAT_TEXT_MAP format represents SpanContexts using a\n * string->string map (backed by a Javascript Object) as a carrier.\n *\n * NOTE: Unlike FORMAT_HTTP_HEADERS, FORMAT_TEXT_MAP places no restrictions\n * on the characters used in either the keys or the values of the map\n * entries.\n *\n * The FORMAT_TEXT_MAP carrier map may contain unrelated data (e.g.,\n * arbitrary gRPC metadata); as such, the Tracer implementation should use\n * a prefix or other convention to distinguish Tracer-specific key:value\n * pairs.\n */\nexports.FORMAT_TEXT_MAP = 'text_map';\n/**\n * The FORMAT_HTTP_HEADERS format represents SpanContexts using a\n * character-restricted string->string map (backed by a Javascript Object)\n * as a carrier.\n *\n * Keys and values in the FORMAT_HTTP_HEADERS carrier must be suitable for\n * use as HTTP headers (without modification or further escaping). That is,\n * the keys have a greatly restricted character set, casing for the keys\n * may not be preserved by various intermediaries, and the values should be\n * URL-escaped.\n *\n * The FORMAT_HTTP_HEADERS carrier map may contain unrelated data (e.g.,\n * arbitrary HTTP headers); as such, the Tracer implementation should use a\n * prefix or other convention to distinguish Tracer-specific key:value\n * pairs.\n */\nexports.FORMAT_HTTP_HEADERS = 'http_headers';\n/**\n * A Span may be the \"child of\" a parent Span. In a “child of” reference,\n * the parent Span depends on the child Span in some capacity.\n *\n * See more about reference types at https://github.com/opentracing/specification\n */\nexports.REFERENCE_CHILD_OF = 'child_of';\n/**\n * Some parent Spans do not depend in any way on the result of their child\n * Spans. In these cases, we say merely that the child Span “follows from”\n * the parent Span in a causal sense.\n *\n * See more about reference types at https://github.com/opentracing/specification\n */\nexports.REFERENCE_FOLLOWS_FROM = 'follows_from';\n//# sourceMappingURL=constants.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Constants = require(\"./constants\");\nvar reference_1 = require(\"./reference\");\nvar span_1 = require(\"./span\");\n/**\n * Return a new REFERENCE_CHILD_OF reference.\n *\n * @param {SpanContext} spanContext - the parent SpanContext instance to\n *        reference.\n * @return a REFERENCE_CHILD_OF reference pointing to `spanContext`\n */\nfunction childOf(spanContext) {\n    // Allow the user to pass a Span instead of a SpanContext\n    if (spanContext instanceof span_1.default) {\n        spanContext = spanContext.context();\n    }\n    return new reference_1.default(Constants.REFERENCE_CHILD_OF, spanContext);\n}\nexports.childOf = childOf;\n/**\n * Return a new REFERENCE_FOLLOWS_FROM reference.\n *\n * @param {SpanContext} spanContext - the parent SpanContext instance to\n *        reference.\n * @return a REFERENCE_FOLLOWS_FROM reference pointing to `spanContext`\n */\nfunction followsFrom(spanContext) {\n    // Allow the user to pass a Span instead of a SpanContext\n    if (spanContext instanceof span_1.default) {\n        spanContext = spanContext.context();\n    }\n    return new reference_1.default(Constants.REFERENCE_FOLLOWS_FROM, spanContext);\n}\nexports.followsFrom = followsFrom;\n//# sourceMappingURL=functions.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar span_1 = require(\"./span\");\nvar span_context_1 = require(\"./span_context\");\nvar tracer_1 = require(\"./tracer\");\nexports.tracer = null;\nexports.spanContext = null;\nexports.span = null;\n// Deferred initialization to avoid a dependency cycle where Tracer depends on\n// Span which depends on the noop tracer.\nfunction initialize() {\n    exports.tracer = new tracer_1.default();\n    exports.span = new span_1.default();\n    exports.spanContext = new span_context_1.default();\n}\nexports.initialize = initialize;\n//# sourceMappingURL=noop.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar span_1 = require(\"./span\");\n/**\n * Reference pairs a reference type constant (e.g., REFERENCE_CHILD_OF or\n * REFERENCE_FOLLOWS_FROM) with the SpanContext it points to.\n *\n * See the exported childOf() and followsFrom() functions at the package level.\n */\nvar Reference = /** @class */ (function () {\n    /**\n     * Initialize a new Reference instance.\n     *\n     * @param {string} type - the Reference type constant (e.g.,\n     *        REFERENCE_CHILD_OF or REFERENCE_FOLLOWS_FROM).\n     * @param {SpanContext} referencedContext - the SpanContext being referred\n     *        to. As a convenience, a Span instance may be passed in instead\n     *        (in which case its .context() is used here).\n     */\n    function Reference(type, referencedContext) {\n        this._type = type;\n        this._referencedContext = (referencedContext instanceof span_1.default ?\n            referencedContext.context() :\n            referencedContext);\n    }\n    /**\n     * @return {string} The Reference type (e.g., REFERENCE_CHILD_OF or\n     *         REFERENCE_FOLLOWS_FROM).\n     */\n    Reference.prototype.type = function () {\n        return this._type;\n    };\n    /**\n     * @return {SpanContext} The SpanContext being referred to (e.g., the\n     *         parent in a REFERENCE_CHILD_OF Reference).\n     */\n    Reference.prototype.referencedContext = function () {\n        return this._referencedContext;\n    };\n    return Reference;\n}());\nexports.default = Reference;\n//# sourceMappingURL=reference.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar noop = require(\"./noop\");\n/**\n * Span represents a logical unit of work as part of a broader Trace. Examples\n * of span might include remote procedure calls or a in-process function calls\n * to sub-components. A Trace has a single, top-level \"root\" Span that in turn\n * may have zero or more child Spans, which in turn may have children.\n */\nvar Span = /** @class */ (function () {\n    function Span() {\n    }\n    // ---------------------------------------------------------------------- //\n    // OpenTracing API methods\n    // ---------------------------------------------------------------------- //\n    /**\n     * Returns the SpanContext object associated with this Span.\n     *\n     * @return {SpanContext}\n     */\n    Span.prototype.context = function () {\n        return this._context();\n    };\n    /**\n     * Returns the Tracer object used to create this Span.\n     *\n     * @return {Tracer}\n     */\n    Span.prototype.tracer = function () {\n        return this._tracer();\n    };\n    /**\n     * Sets the string name for the logical operation this span represents.\n     *\n     * @param {string} name\n     */\n    Span.prototype.setOperationName = function (name) {\n        this._setOperationName(name);\n        return this;\n    };\n    /**\n     * Sets a key:value pair on this Span that also propagates to future\n     * children of the associated Span.\n     *\n     * setBaggageItem() enables powerful functionality given a full-stack\n     * opentracing integration (e.g., arbitrary application data from a web\n     * client can make it, transparently, all the way into the depths of a\n     * storage system), and with it some powerful costs: use this feature with\n     * care.\n     *\n     * IMPORTANT NOTE #1: setBaggageItem() will only propagate baggage items to\n     * *future* causal descendants of the associated Span.\n     *\n     * IMPORTANT NOTE #2: Use this thoughtfully and with care. Every key and\n     * value is copied into every local *and remote* child of the associated\n     * Span, and that can add up to a lot of network and cpu overhead.\n     *\n     * @param {string} key\n     * @param {string} value\n     */\n    Span.prototype.setBaggageItem = function (key, value) {\n        this._setBaggageItem(key, value);\n        return this;\n    };\n    /**\n     * Returns the value for a baggage item given its key.\n     *\n     * @param  {string} key\n     *         The key for the given trace attribute.\n     * @return {string}\n     *         String value for the given key, or undefined if the key does not\n     *         correspond to a set trace attribute.\n     */\n    Span.prototype.getBaggageItem = function (key) {\n        return this._getBaggageItem(key);\n    };\n    /**\n     * Adds a single tag to the span.  See `addTags()` for details.\n     *\n     * @param {string} key\n     * @param {any} value\n     */\n    Span.prototype.setTag = function (key, value) {\n        // NOTE: the call is normalized to a call to _addTags()\n        this._addTags((_a = {}, _a[key] = value, _a));\n        return this;\n        var _a;\n    };\n    /**\n     * Adds the given key value pairs to the set of span tags.\n     *\n     * Multiple calls to addTags() results in the tags being the superset of\n     * all calls.\n     *\n     * The behavior of setting the same key multiple times on the same span\n     * is undefined.\n     *\n     * The supported type of the values is implementation-dependent.\n     * Implementations are expected to safely handle all types of values but\n     * may choose to ignore unrecognized / unhandle-able values (e.g. objects\n     * with cyclic references, function objects).\n     *\n     * @return {[type]} [description]\n     */\n    Span.prototype.addTags = function (keyValueMap) {\n        this._addTags(keyValueMap);\n        return this;\n    };\n    /**\n     * Add a log record to this Span, optionally at a user-provided timestamp.\n     *\n     * For example:\n     *\n     *     span.log({\n     *         size: rpc.size(),  // numeric value\n     *         URI: rpc.URI(),  // string value\n     *         payload: rpc.payload(),  // Object value\n     *         \"keys can be arbitrary strings\": rpc.foo(),\n     *     });\n     *\n     *     span.log({\n     *         \"error.description\": someError.description(),\n     *     }, someError.timestampMillis());\n     *\n     * @param {object} keyValuePairs\n     *        An object mapping string keys to arbitrary value types. All\n     *        Tracer implementations should support bool, string, and numeric\n     *        value types, and some may also support Object values.\n     * @param {number} timestamp\n     *        An optional parameter specifying the timestamp in milliseconds\n     *        since the Unix epoch. Fractional values are allowed so that\n     *        timestamps with sub-millisecond accuracy can be represented. If\n     *        not specified, the implementation is expected to use its notion\n     *        of the current time of the call.\n     */\n    Span.prototype.log = function (keyValuePairs, timestamp) {\n        this._log(keyValuePairs, timestamp);\n        return this;\n    };\n    /**\n     * DEPRECATED\n     */\n    Span.prototype.logEvent = function (eventName, payload) {\n        return this._log({ event: eventName, payload: payload });\n    };\n    /**\n     * Sets the end timestamp and finalizes Span state.\n     *\n     * With the exception of calls to Span.context() (which are always allowed),\n     * finish() must be the last call made to any span instance, and to do\n     * otherwise leads to undefined behavior.\n     *\n     * @param  {number} finishTime\n     *         Optional finish time in milliseconds as a Unix timestamp. Decimal\n     *         values are supported for timestamps with sub-millisecond accuracy.\n     *         If not specified, the current time (as defined by the\n     *         implementation) will be used.\n     */\n    Span.prototype.finish = function (finishTime) {\n        this._finish(finishTime);\n        // Do not return `this`. The Span generally should not be used after it\n        // is finished so chaining is not desired in this context.\n    };\n    // ---------------------------------------------------------------------- //\n    // Derived classes can choose to implement the below\n    // ---------------------------------------------------------------------- //\n    // By default returns a no-op SpanContext.\n    Span.prototype._context = function () {\n        return noop.spanContext;\n    };\n    // By default returns a no-op tracer.\n    //\n    // The base class could store the tracer that created it, but it does not\n    // in order to ensure the no-op span implementation has zero members,\n    // which allows V8 to aggressively optimize calls to such objects.\n    Span.prototype._tracer = function () {\n        return noop.tracer;\n    };\n    // By default does nothing\n    Span.prototype._setOperationName = function (name) {\n    };\n    // By default does nothing\n    Span.prototype._setBaggageItem = function (key, value) {\n    };\n    // By default does nothing\n    Span.prototype._getBaggageItem = function (key) {\n        return undefined;\n    };\n    // By default does nothing\n    //\n    // NOTE: both setTag() and addTags() map to this function. keyValuePairs\n    // will always be an associative array.\n    Span.prototype._addTags = function (keyValuePairs) {\n    };\n    // By default does nothing\n    Span.prototype._log = function (keyValuePairs, timestamp) {\n    };\n    // By default does nothing\n    //\n    // finishTime is expected to be either a number or undefined.\n    Span.prototype._finish = function (finishTime) {\n    };\n    return Span;\n}());\nexports.Span = Span;\nexports.default = Span;\n//# sourceMappingURL=span.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * SpanContext represents Span state that must propagate to descendant Spans\n * and across process boundaries.\n *\n * SpanContext is logically divided into two pieces: the user-level \"Baggage\"\n * (see setBaggageItem and getBaggageItem) that propagates across Span\n * boundaries and any Tracer-implementation-specific fields that are needed to\n * identify or otherwise contextualize the associated Span instance (e.g., a\n * <trace_id, span_id, sampled> tuple).\n */\nvar SpanContext = /** @class */ (function () {\n    function SpanContext() {\n    }\n    return SpanContext;\n}());\nexports.SpanContext = SpanContext;\nexports.default = SpanContext;\n//# sourceMappingURL=span_context.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Functions = require(\"./functions\");\nvar Noop = require(\"./noop\");\nvar span_1 = require(\"./span\");\n/**\n * Tracer is the entry-point between the instrumentation API and the tracing\n * implementation.\n *\n * The default object acts as a no-op implementation.\n *\n * Note to implementators: derived classes can choose to directly implement the\n * methods in the \"OpenTracing API methods\" section, or optionally the subset of\n * underscore-prefixed methods to pick up the argument checking and handling\n * automatically from the base class.\n */\nvar Tracer = /** @class */ (function () {\n    function Tracer() {\n    }\n    // ---------------------------------------------------------------------- //\n    // OpenTracing API methods\n    // ---------------------------------------------------------------------- //\n    /**\n     * Starts and returns a new Span representing a logical unit of work.\n     *\n     * For example:\n     *\n     *     // Start a new (parentless) root Span:\n     *     var parent = Tracer.startSpan('DoWork');\n     *\n     *     // Start a new (child) Span:\n     *     var child = Tracer.startSpan('load-from-db', {\n     *         childOf: parent.context(),\n     *     });\n     *\n     *     // Start a new async (FollowsFrom) Span:\n     *     var child = Tracer.startSpan('async-cache-write', {\n     *         references: [\n     *             opentracing.followsFrom(parent.context())\n     *         ],\n     *     });\n     *\n     * @param {string} name - the name of the operation (REQUIRED).\n     * @param {SpanOptions} [options] - options for the newly created span.\n     * @return {Span} - a new Span object.\n     */\n    Tracer.prototype.startSpan = function (name, options) {\n        if (options === void 0) { options = {}; }\n        // Convert options.childOf to fields.references as needed.\n        if (options.childOf) {\n            // Convert from a Span or a SpanContext into a Reference.\n            var childOf = Functions.childOf(options.childOf);\n            if (options.references) {\n                options.references.push(childOf);\n            }\n            else {\n                options.references = [childOf];\n            }\n            delete (options.childOf);\n        }\n        return this._startSpan(name, options);\n    };\n    /**\n     * Injects the given SpanContext instance for cross-process propagation\n     * within `carrier`. The expected type of `carrier` depends on the value of\n     * `format.\n     *\n     * OpenTracing defines a common set of `format` values (see\n     * FORMAT_TEXT_MAP, FORMAT_HTTP_HEADERS, and FORMAT_BINARY), and each has\n     * an expected carrier type.\n     *\n     * Consider this pseudocode example:\n     *\n     *     var clientSpan = ...;\n     *     ...\n     *     // Inject clientSpan into a text carrier.\n     *     var headersCarrier = {};\n     *     Tracer.inject(clientSpan.context(), Tracer.FORMAT_HTTP_HEADERS, headersCarrier);\n     *     // Incorporate the textCarrier into the outbound HTTP request header\n     *     // map.\n     *     Object.assign(outboundHTTPReq.headers, headersCarrier);\n     *     // ... send the httpReq\n     *\n     * @param  {SpanContext} spanContext - the SpanContext to inject into the\n     *         carrier object. As a convenience, a Span instance may be passed\n     *         in instead (in which case its .context() is used for the\n     *         inject()).\n     * @param  {string} format - the format of the carrier.\n     * @param  {any} carrier - see the documentation for the chosen `format`\n     *         for a description of the carrier object.\n     */\n    Tracer.prototype.inject = function (spanContext, format, carrier) {\n        // Allow the user to pass a Span instead of a SpanContext\n        if (spanContext instanceof span_1.default) {\n            spanContext = spanContext.context();\n        }\n        return this._inject(spanContext, format, carrier);\n    };\n    /**\n     * Returns a SpanContext instance extracted from `carrier` in the given\n     * `format`.\n     *\n     * OpenTracing defines a common set of `format` values (see\n     * FORMAT_TEXT_MAP, FORMAT_HTTP_HEADERS, and FORMAT_BINARY), and each has\n     * an expected carrier type.\n     *\n     * Consider this pseudocode example:\n     *\n     *     // Use the inbound HTTP request's headers as a text map carrier.\n     *     var headersCarrier = inboundHTTPReq.headers;\n     *     var wireCtx = Tracer.extract(Tracer.FORMAT_HTTP_HEADERS, headersCarrier);\n     *     var serverSpan = Tracer.startSpan('...', { childOf : wireCtx });\n     *\n     * @param  {string} format - the format of the carrier.\n     * @param  {any} carrier - the type of the carrier object is determined by\n     *         the format.\n     * @return {SpanContext}\n     *         The extracted SpanContext, or null if no such SpanContext could\n     *         be found in `carrier`\n     */\n    Tracer.prototype.extract = function (format, carrier) {\n        return this._extract(format, carrier);\n    };\n    // ---------------------------------------------------------------------- //\n    // Derived classes can choose to implement the below\n    // ---------------------------------------------------------------------- //\n    // NOTE: the input to this method is *always* an associative array. The\n    // public-facing startSpan() method normalizes the arguments so that\n    // all N implementations do not need to worry about variations in the call\n    // signature.\n    //\n    // The default behavior returns a no-op span.\n    Tracer.prototype._startSpan = function (name, fields) {\n        return Noop.span;\n    };\n    // The default behavior is a no-op.\n    Tracer.prototype._inject = function (spanContext, format, carrier) {\n    };\n    // The default behavior is to return a no-op SpanContext.\n    Tracer.prototype._extract = function (format, carrier) {\n        return Noop.spanContext;\n    };\n    return Tracer;\n}());\nexports.Tracer = Tracer;\nexports.default = Tracer;\n//# sourceMappingURL=tracer.js.map","(function (root, factory) {\n    'use strict';\n    // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js, Rhino, and browsers.\n\n    /* istanbul ignore next */\n    if (typeof define === 'function' && define.amd) {\n        define('stackframe', [], factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory();\n    } else {\n        root.StackFrame = factory();\n    }\n}(this, function () {\n    'use strict';\n    function _isNumber(n) {\n        return !isNaN(parseFloat(n)) && isFinite(n);\n    }\n\n    function StackFrame(functionName, args, fileName, lineNumber, columnNumber, source) {\n        if (functionName !== undefined) {\n            this.setFunctionName(functionName);\n        }\n        if (args !== undefined) {\n            this.setArgs(args);\n        }\n        if (fileName !== undefined) {\n            this.setFileName(fileName);\n        }\n        if (lineNumber !== undefined) {\n            this.setLineNumber(lineNumber);\n        }\n        if (columnNumber !== undefined) {\n            this.setColumnNumber(columnNumber);\n        }\n        if (source !== undefined) {\n            this.setSource(source);\n        }\n    }\n\n    StackFrame.prototype = {\n        getFunctionName: function () {\n            return this.functionName;\n        },\n        setFunctionName: function (v) {\n            this.functionName = String(v);\n        },\n\n        getArgs: function () {\n            return this.args;\n        },\n        setArgs: function (v) {\n            if (Object.prototype.toString.call(v) !== '[object Array]') {\n                throw new TypeError('Args must be an Array');\n            }\n            this.args = v;\n        },\n\n        // NOTE: Property name may be misleading as it includes the path,\n        // but it somewhat mirrors V8's JavaScriptStackTraceApi\n        // https://code.google.com/p/v8/wiki/JavaScriptStackTraceApi and Gecko's\n        // http://mxr.mozilla.org/mozilla-central/source/xpcom/base/nsIException.idl#14\n        getFileName: function () {\n            return this.fileName;\n        },\n        setFileName: function (v) {\n            this.fileName = String(v);\n        },\n\n        getLineNumber: function () {\n            return this.lineNumber;\n        },\n        setLineNumber: function (v) {\n            if (!_isNumber(v)) {\n                throw new TypeError('Line Number must be a Number');\n            }\n            this.lineNumber = Number(v);\n        },\n\n        getColumnNumber: function () {\n            return this.columnNumber;\n        },\n        setColumnNumber: function (v) {\n            if (!_isNumber(v)) {\n                throw new TypeError('Column Number must be a Number');\n            }\n            this.columnNumber = Number(v);\n        },\n\n        getSource: function () {\n            return this.source;\n        },\n        setSource: function (v) {\n            this.source = String(v);\n        },\n\n        toString: function() {\n            var functionName = this.getFunctionName() || '{anonymous}';\n            var args = '(' + (this.getArgs() || []).join(',') + ')';\n            var fileName = this.getFileName() ? ('@' + this.getFileName()) : '';\n            var lineNumber = _isNumber(this.getLineNumber()) ? (':' + this.getLineNumber()) : '';\n            var columnNumber = _isNumber(this.getColumnNumber()) ? (':' + this.getColumnNumber()) : '';\n            return functionName + args + fileName + lineNumber + columnNumber;\n        }\n    };\n\n    return StackFrame;\n}));\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","import stackParser from 'error-stack-parser';\n\nfunction filePathToFileName(fileUrl) {\n  var origin = window.location.origin || window.location.protocol + '//' + window.location.hostname + (window.location.port ? ':' + window.location.port : '');\n\n  if (fileUrl.indexOf(origin) > -1) {\n    fileUrl = fileUrl.replace(origin + '/', '');\n  }\n\n  return fileUrl;\n}\n\nfunction cleanFilePath(filePath) {\n  if (filePath === void 0) {\n    filePath = '';\n  }\n\n  if (filePath === '<anonymous>') {\n    filePath = '';\n  }\n\n  return filePath;\n}\n\nfunction isFileInline(fileUrl) {\n  if (fileUrl) {\n    return window.location.href.indexOf(fileUrl) === 0;\n  }\n\n  return false;\n}\n\nfunction normalizeStackFrames(stackFrames) {\n  return stackFrames.map(function (frame) {\n    if (frame.functionName) {\n      frame.functionName = normalizeFunctionName(frame.functionName);\n    }\n\n    return frame;\n  });\n}\n\nfunction normalizeFunctionName(fnName) {\n  var parts = fnName.split('/');\n\n  if (parts.length > 1) {\n    fnName = ['Object', parts[parts.length - 1]].join('.');\n  } else {\n    fnName = parts[0];\n  }\n\n  fnName = fnName.replace(/.<$/gi, '.<anonymous>');\n  fnName = fnName.replace(/^Anonymous function$/, '<anonymous>');\n  parts = fnName.split('.');\n\n  if (parts.length > 1) {\n    fnName = parts[parts.length - 1];\n  } else {\n    fnName = parts[0];\n  }\n\n  return fnName;\n}\n\nexport function createStackTraces(errorEvent) {\n  var error = errorEvent.error,\n      filename = errorEvent.filename,\n      lineno = errorEvent.lineno,\n      colno = errorEvent.colno;\n  var stackTraces = [];\n\n  if (error) {\n    try {\n      stackTraces = stackParser.parse(error);\n    } catch (e) {}\n  }\n\n  if (stackTraces.length === 0) {\n    stackTraces = [{\n      fileName: filename,\n      lineNumber: lineno,\n      columnNumber: colno\n    }];\n  }\n\n  var normalizedStackTraces = normalizeStackFrames(stackTraces);\n  return normalizedStackTraces.map(function (stack) {\n    var fileName = stack.fileName,\n        lineNumber = stack.lineNumber,\n        columnNumber = stack.columnNumber,\n        _stack$functionName = stack.functionName,\n        functionName = _stack$functionName === void 0 ? '<anonymous>' : _stack$functionName;\n\n    if (!fileName && !lineNumber) {\n      return {};\n    }\n\n    if (!columnNumber && !lineNumber) {\n      return {};\n    }\n\n    var filePath = cleanFilePath(fileName);\n    var cleanedFileName = filePathToFileName(filePath);\n\n    if (isFileInline(filePath)) {\n      cleanedFileName = '(inline script)';\n    }\n\n    return {\n      abs_path: fileName,\n      filename: cleanedFileName,\n      function: functionName,\n      lineno: lineNumber,\n      colno: columnNumber\n    };\n  });\n}\nexport function filterInvalidFrames(frames) {\n  return frames.filter(function (_ref) {\n    var filename = _ref.filename,\n        lineno = _ref.lineno;\n    return typeof filename !== 'undefined' && typeof lineno !== 'undefined';\n  });\n}","/**\n * @this {Promise}\n */\nfunction finallyConstructor(callback) {\n  var constructor = this.constructor;\n  return this.then(\n    function(value) {\n      // @ts-ignore\n      return constructor.resolve(callback()).then(function() {\n        return value;\n      });\n    },\n    function(reason) {\n      // @ts-ignore\n      return constructor.resolve(callback()).then(function() {\n        // @ts-ignore\n        return constructor.reject(reason);\n      });\n    }\n  );\n}\n\nexport default finallyConstructor;\n","import promiseFinally from './finally';\n\n// Store setTimeout reference so promise-polyfill will be unaffected by\n// other code modifying setTimeout (like sinon.useFakeTimers())\nvar setTimeoutFunc = setTimeout;\n\nfunction isArray(x) {\n  return Boolean(x && typeof x.length !== 'undefined');\n}\n\nfunction noop() {}\n\n// Polyfill for Function.prototype.bind\nfunction bind(fn, thisArg) {\n  return function() {\n    fn.apply(thisArg, arguments);\n  };\n}\n\n/**\n * @constructor\n * @param {Function} fn\n */\nfunction Promise(fn) {\n  if (!(this instanceof Promise))\n    throw new TypeError('Promises must be constructed via new');\n  if (typeof fn !== 'function') throw new TypeError('not a function');\n  /** @type {!number} */\n  this._state = 0;\n  /** @type {!boolean} */\n  this._handled = false;\n  /** @type {Promise|undefined} */\n  this._value = undefined;\n  /** @type {!Array<!Function>} */\n  this._deferreds = [];\n\n  doResolve(fn, this);\n}\n\nfunction handle(self, deferred) {\n  while (self._state === 3) {\n    self = self._value;\n  }\n  if (self._state === 0) {\n    self._deferreds.push(deferred);\n    return;\n  }\n  self._handled = true;\n  Promise._immediateFn(function() {\n    var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n    if (cb === null) {\n      (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n      return;\n    }\n    var ret;\n    try {\n      ret = cb(self._value);\n    } catch (e) {\n      reject(deferred.promise, e);\n      return;\n    }\n    resolve(deferred.promise, ret);\n  });\n}\n\nfunction resolve(self, newValue) {\n  try {\n    // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n    if (newValue === self)\n      throw new TypeError('A promise cannot be resolved with itself.');\n    if (\n      newValue &&\n      (typeof newValue === 'object' || typeof newValue === 'function')\n    ) {\n      var then = newValue.then;\n      if (newValue instanceof Promise) {\n        self._state = 3;\n        self._value = newValue;\n        finale(self);\n        return;\n      } else if (typeof then === 'function') {\n        doResolve(bind(then, newValue), self);\n        return;\n      }\n    }\n    self._state = 1;\n    self._value = newValue;\n    finale(self);\n  } catch (e) {\n    reject(self, e);\n  }\n}\n\nfunction reject(self, newValue) {\n  self._state = 2;\n  self._value = newValue;\n  finale(self);\n}\n\nfunction finale(self) {\n  if (self._state === 2 && self._deferreds.length === 0) {\n    Promise._immediateFn(function() {\n      if (!self._handled) {\n        Promise._unhandledRejectionFn(self._value);\n      }\n    });\n  }\n\n  for (var i = 0, len = self._deferreds.length; i < len; i++) {\n    handle(self, self._deferreds[i]);\n  }\n  self._deferreds = null;\n}\n\n/**\n * @constructor\n */\nfunction Handler(onFulfilled, onRejected, promise) {\n  this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n  this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n  this.promise = promise;\n}\n\n/**\n * Take a potentially misbehaving resolver function and make sure\n * onFulfilled and onRejected are only called once.\n *\n * Makes no guarantees about asynchrony.\n */\nfunction doResolve(fn, self) {\n  var done = false;\n  try {\n    fn(\n      function(value) {\n        if (done) return;\n        done = true;\n        resolve(self, value);\n      },\n      function(reason) {\n        if (done) return;\n        done = true;\n        reject(self, reason);\n      }\n    );\n  } catch (ex) {\n    if (done) return;\n    done = true;\n    reject(self, ex);\n  }\n}\n\nPromise.prototype['catch'] = function(onRejected) {\n  return this.then(null, onRejected);\n};\n\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  // @ts-ignore\n  var prom = new this.constructor(noop);\n\n  handle(this, new Handler(onFulfilled, onRejected, prom));\n  return prom;\n};\n\nPromise.prototype['finally'] = promiseFinally;\n\nPromise.all = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!isArray(arr)) {\n      return reject(new TypeError('Promise.all accepts an array'));\n    }\n\n    var args = Array.prototype.slice.call(arr);\n    if (args.length === 0) return resolve([]);\n    var remaining = args.length;\n\n    function res(i, val) {\n      try {\n        if (val && (typeof val === 'object' || typeof val === 'function')) {\n          var then = val.then;\n          if (typeof then === 'function') {\n            then.call(\n              val,\n              function(val) {\n                res(i, val);\n              },\n              reject\n            );\n            return;\n          }\n        }\n        args[i] = val;\n        if (--remaining === 0) {\n          resolve(args);\n        }\n      } catch (ex) {\n        reject(ex);\n      }\n    }\n\n    for (var i = 0; i < args.length; i++) {\n      res(i, args[i]);\n    }\n  });\n};\n\nPromise.resolve = function(value) {\n  if (value && typeof value === 'object' && value.constructor === Promise) {\n    return value;\n  }\n\n  return new Promise(function(resolve) {\n    resolve(value);\n  });\n};\n\nPromise.reject = function(value) {\n  return new Promise(function(resolve, reject) {\n    reject(value);\n  });\n};\n\nPromise.race = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!isArray(arr)) {\n      return reject(new TypeError('Promise.race accepts an array'));\n    }\n\n    for (var i = 0, len = arr.length; i < len; i++) {\n      Promise.resolve(arr[i]).then(resolve, reject);\n    }\n  });\n};\n\n// Use polyfill for setImmediate for performance gains\nPromise._immediateFn =\n  // @ts-ignore\n  (typeof setImmediate === 'function' &&\n    function(fn) {\n      // @ts-ignore\n      setImmediate(fn);\n    }) ||\n  function(fn) {\n    setTimeoutFunc(fn, 0);\n  };\n\nPromise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n  if (typeof console !== 'undefined' && console) {\n    console.warn('Possible Unhandled Promise Rejection:', err); // eslint-disable-line no-console\n  }\n};\n\nexport default Promise;\n","import PromisePollyfill from 'promise-polyfill';\nimport { isBrowser } from './utils';\nvar local = {};\n\nif (isBrowser) {\n  local = window;\n} else if (typeof self !== 'undefined') {\n  local = self;\n}\n\nvar Promise = 'Promise' in local ? local.Promise : PromisePollyfill;\nexport { Promise };","import { Promise } from './polyfills';\nvar slice = [].slice;\nvar isBrowser = typeof window !== 'undefined';\nvar PERF = isBrowser && typeof performance !== 'undefined' ? performance : {};\n\nfunction isCORSSupported() {\n  var xhr = new window.XMLHttpRequest();\n  return 'withCredentials' in xhr;\n}\n\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToHex(buffer) {\n  var hexOctets = [];\n\n  for (var _i = 0; _i < buffer.length; _i++) {\n    hexOctets.push(byteToHex[buffer[_i]]);\n  }\n\n  return hexOctets.join('');\n}\n\nvar destination = new Uint8Array(16);\n\nfunction rng() {\n  if (typeof crypto != 'undefined' && typeof crypto.getRandomValues == 'function') {\n    return crypto.getRandomValues(destination);\n  } else if (typeof msCrypto != 'undefined' && typeof msCrypto.getRandomValues == 'function') {\n    return msCrypto.getRandomValues(destination);\n  }\n\n  return destination;\n}\n\nfunction generateRandomId(length) {\n  var id = bytesToHex(rng());\n  return id.substr(0, length);\n}\n\nfunction getDtHeaderValue(span) {\n  var dtVersion = '00';\n  var dtUnSampledFlags = '00';\n  var dtSampledFlags = '01';\n\n  if (span && span.traceId && span.id && span.parentId) {\n    var flags = span.sampled ? dtSampledFlags : dtUnSampledFlags;\n    var id = span.sampled ? span.id : span.parentId;\n    return dtVersion + '-' + span.traceId + '-' + id + '-' + flags;\n  }\n}\n\nfunction parseDtHeaderValue(value) {\n  var parsed = /^([\\da-f]{2})-([\\da-f]{32})-([\\da-f]{16})-([\\da-f]{2})$/.exec(value);\n\n  if (parsed) {\n    var flags = parsed[4];\n    var sampled = flags !== '00';\n    return {\n      traceId: parsed[2],\n      id: parsed[3],\n      sampled: sampled\n    };\n  }\n}\n\nfunction isDtHeaderValid(header) {\n  return /^[\\da-f]{2}-[\\da-f]{32}-[\\da-f]{16}-[\\da-f]{2}$/.test(header) && header.slice(3, 35) !== '00000000000000000000000000000000' && header.slice(36, 52) !== '0000000000000000';\n}\n\nfunction getTSHeaderValue(_ref) {\n  var sampleRate = _ref.sampleRate;\n\n  if (typeof sampleRate !== 'number' || String(sampleRate).length > 256) {\n    return;\n  }\n\n  var NAMESPACE = 'es';\n  var SEPARATOR = '=';\n  return \"\" + NAMESPACE + SEPARATOR + \"s:\" + sampleRate;\n}\n\nfunction setRequestHeader(target, name, value) {\n  if (typeof target.setRequestHeader === 'function') {\n    target.setRequestHeader(name, value);\n  } else if (target.headers && typeof target.headers.append === 'function') {\n    target.headers.append(name, value);\n  } else {\n    target[name] = value;\n  }\n}\n\nfunction checkSameOrigin(source, target) {\n  var isSame = false;\n\n  if (typeof target === 'string') {\n    isSame = source === target;\n  } else if (target && typeof target.test === 'function') {\n    isSame = target.test(source);\n  } else if (Array.isArray(target)) {\n    target.forEach(function (t) {\n      if (!isSame) {\n        isSame = checkSameOrigin(source, t);\n      }\n    });\n  }\n\n  return isSame;\n}\n\nfunction isPlatformSupported() {\n  return isBrowser && typeof Set === 'function' && typeof JSON.stringify === 'function' && PERF && typeof PERF.now === 'function' && isCORSSupported();\n}\n\nfunction setLabel(key, value, obj) {\n  if (!obj || !key) return;\n  var skey = removeInvalidChars(key);\n  var valueType = typeof value;\n\n  if (value != undefined && valueType !== 'boolean' && valueType !== 'number') {\n    value = String(value);\n  }\n\n  obj[skey] = value;\n  return obj;\n}\n\nfunction getServerTimingInfo(serverTimingEntries) {\n  if (serverTimingEntries === void 0) {\n    serverTimingEntries = [];\n  }\n\n  var serverTimingInfo = [];\n  var entrySeparator = ', ';\n  var valueSeparator = ';';\n\n  for (var _i2 = 0; _i2 < serverTimingEntries.length; _i2++) {\n    var _serverTimingEntries$ = serverTimingEntries[_i2],\n        name = _serverTimingEntries$.name,\n        duration = _serverTimingEntries$.duration,\n        description = _serverTimingEntries$.description;\n    var timingValue = name;\n\n    if (description) {\n      timingValue += valueSeparator + 'desc=' + description;\n    }\n\n    if (duration) {\n      timingValue += valueSeparator + 'dur=' + duration;\n    }\n\n    serverTimingInfo.push(timingValue);\n  }\n\n  return serverTimingInfo.join(entrySeparator);\n}\n\nfunction getTimeOrigin() {\n  return PERF.timing.fetchStart;\n}\n\nfunction stripQueryStringFromUrl(url) {\n  return url && url.split('?')[0];\n}\n\nfunction isObject(value) {\n  return value !== null && typeof value === 'object';\n}\n\nfunction isFunction(value) {\n  return typeof value === 'function';\n}\n\nfunction baseExtend(dst, objs, deep) {\n  for (var i = 0, ii = objs.length; i < ii; ++i) {\n    var obj = objs[i];\n    if (!isObject(obj) && !isFunction(obj)) continue;\n    var keys = Object.keys(obj);\n\n    for (var j = 0, jj = keys.length; j < jj; j++) {\n      var key = keys[j];\n      var src = obj[key];\n\n      if (deep && isObject(src)) {\n        if (!isObject(dst[key])) dst[key] = Array.isArray(src) ? [] : {};\n        baseExtend(dst[key], [src], false);\n      } else {\n        dst[key] = src;\n      }\n    }\n  }\n\n  return dst;\n}\n\nfunction getElasticScript() {\n  if (typeof document !== 'undefined') {\n    var scripts = document.getElementsByTagName('script');\n\n    for (var i = 0, l = scripts.length; i < l; i++) {\n      var sc = scripts[i];\n\n      if (sc.src.indexOf('elastic') > 0) {\n        return sc;\n      }\n    }\n  }\n}\n\nfunction getCurrentScript() {\n  if (typeof document !== 'undefined') {\n    var currentScript = document.currentScript;\n\n    if (!currentScript) {\n      return getElasticScript();\n    }\n\n    return currentScript;\n  }\n}\n\nfunction extend(dst) {\n  return baseExtend(dst, slice.call(arguments, 1), false);\n}\n\nfunction merge(dst) {\n  return baseExtend(dst, slice.call(arguments, 1), true);\n}\n\nfunction isUndefined(obj) {\n  return typeof obj === 'undefined';\n}\n\nfunction noop() {}\n\nfunction find(array, predicate, thisArg) {\n  if (array == null) {\n    throw new TypeError('array is null or not defined');\n  }\n\n  var o = Object(array);\n  var len = o.length >>> 0;\n\n  if (typeof predicate !== 'function') {\n    throw new TypeError('predicate must be a function');\n  }\n\n  var k = 0;\n\n  while (k < len) {\n    var kValue = o[k];\n\n    if (predicate.call(thisArg, kValue, k, o)) {\n      return kValue;\n    }\n\n    k++;\n  }\n\n  return undefined;\n}\n\nfunction removeInvalidChars(key) {\n  return key.replace(/[.*\"]/g, '_');\n}\n\nfunction getLatestNonXHRSpan(spans) {\n  var latestSpan = null;\n\n  for (var _i3 = 0; _i3 < spans.length; _i3++) {\n    var span = spans[_i3];\n\n    if (String(span.type).indexOf('external') === -1 && (!latestSpan || latestSpan._end < span._end)) {\n      latestSpan = span;\n    }\n  }\n\n  return latestSpan;\n}\n\nfunction getEarliestSpan(spans) {\n  var earliestSpan = spans[0];\n\n  for (var _i4 = 1; _i4 < spans.length; _i4++) {\n    var span = spans[_i4];\n\n    if (earliestSpan._start > span._start) {\n      earliestSpan = span;\n    }\n  }\n\n  return earliestSpan;\n}\n\nfunction now() {\n  return PERF.now();\n}\n\nfunction getTime(time) {\n  return typeof time === 'number' && time >= 0 ? time : now();\n}\n\nfunction getDuration(start, end) {\n  if (isUndefined(end) || isUndefined(start)) {\n    return null;\n  }\n\n  return parseInt(end - start);\n}\n\nfunction scheduleMacroTask(callback) {\n  setTimeout(callback, 0);\n}\n\nfunction scheduleMicroTask(callback) {\n  Promise.resolve().then(callback);\n}\n\nfunction isPerfTimelineSupported() {\n  return typeof PERF.getEntriesByType === 'function';\n}\n\nfunction isPerfTypeSupported(type) {\n  return typeof PerformanceObserver !== 'undefined' && PerformanceObserver.supportedEntryTypes && PerformanceObserver.supportedEntryTypes.indexOf(type) >= 0;\n}\n\nexport { extend, merge, isUndefined, noop, baseExtend, bytesToHex, isCORSSupported, isObject, isFunction, isPlatformSupported, isDtHeaderValid, parseDtHeaderValue, getServerTimingInfo, getDtHeaderValue, getTSHeaderValue, getCurrentScript, getElasticScript, getTimeOrigin, generateRandomId, getEarliestSpan, getLatestNonXHRSpan, getDuration, getTime, now, rng, checkSameOrigin, scheduleMacroTask, scheduleMicroTask, setLabel, setRequestHeader, stripQueryStringFromUrl, find, removeInvalidChars, PERF, isPerfTimelineSupported, isBrowser, isPerfTypeSupported };","import { isBrowser } from './utils';\n\nfunction isDefaultPort(port, protocol) {\n  switch (protocol) {\n    case 'http:':\n      return port === '80';\n\n    case 'https:':\n      return port === '443';\n  }\n\n  return true;\n}\n\nvar RULES = [['#', 'hash'], ['?', 'query'], ['/', 'path'], ['@', 'auth', 1], [NaN, 'host', undefined, 1]];\nvar PROTOCOL_REGEX = /^([a-z][a-z0-9.+-]*:)?(\\/\\/)?([\\S\\s]*)/i;\nexport var Url = function () {\n  function Url(url) {\n    var _this$extractProtocol = this.extractProtocol(url || ''),\n        protocol = _this$extractProtocol.protocol,\n        address = _this$extractProtocol.address,\n        slashes = _this$extractProtocol.slashes;\n\n    var relative = !protocol && !slashes;\n    var location = this.getLocation();\n    var instructions = RULES.slice();\n    address = address.replace('\\\\', '/');\n\n    if (!slashes) {\n      instructions[2] = [NaN, 'path'];\n    }\n\n    var index;\n\n    for (var i = 0; i < instructions.length; i++) {\n      var instruction = instructions[i];\n      var parse = instruction[0];\n      var key = instruction[1];\n\n      if (typeof parse === 'string') {\n        index = address.indexOf(parse);\n\n        if (~index) {\n          var instLength = instruction[2];\n\n          if (instLength) {\n            var newIndex = address.lastIndexOf(parse);\n            index = Math.max(index, newIndex);\n            this[key] = address.slice(0, index);\n            address = address.slice(index + instLength);\n          } else {\n            this[key] = address.slice(index);\n            address = address.slice(0, index);\n          }\n        }\n      } else {\n        this[key] = address;\n        address = '';\n      }\n\n      this[key] = this[key] || (relative && instruction[3] ? location[key] || '' : '');\n      if (instruction[3]) this[key] = this[key].toLowerCase();\n    }\n\n    if (relative && this.path.charAt(0) !== '/') {\n      this.path = '/' + this.path;\n    }\n\n    this.relative = relative;\n    this.protocol = protocol || location.protocol;\n    this.hostname = this.host;\n    this.port = '';\n\n    if (/:\\d+$/.test(this.host)) {\n      var value = this.host.split(':');\n      var port = value.pop();\n      var hostname = value.join(':');\n\n      if (isDefaultPort(port, this.protocol)) {\n        this.host = hostname;\n      } else {\n        this.port = port;\n      }\n\n      this.hostname = hostname;\n    }\n\n    this.origin = this.protocol && this.host && this.protocol !== 'file:' ? this.protocol + '//' + this.host : 'null';\n    this.href = this.toString();\n  }\n\n  var _proto = Url.prototype;\n\n  _proto.toString = function toString() {\n    var result = this.protocol;\n    result += '//';\n\n    if (this.auth) {\n      var REDACTED = '[REDACTED]';\n      var userpass = this.auth.split(':');\n      var username = userpass[0] ? REDACTED : '';\n      var password = userpass[1] ? ':' + REDACTED : '';\n      result += username + password + '@';\n    }\n\n    result += this.host;\n    result += this.path;\n    result += this.query;\n    result += this.hash;\n    return result;\n  };\n\n  _proto.getLocation = function getLocation() {\n    var globalVar = {};\n\n    if (isBrowser) {\n      globalVar = window;\n    }\n\n    return globalVar.location;\n  };\n\n  _proto.extractProtocol = function extractProtocol(url) {\n    var match = PROTOCOL_REGEX.exec(url);\n    return {\n      protocol: match[1] ? match[1].toLowerCase() : '',\n      slashes: !!match[2],\n      address: match[3]\n    };\n  };\n\n  return Url;\n}();\nexport function slugifyUrl(urlStr, depth) {\n  if (depth === void 0) {\n    depth = 2;\n  }\n\n  var parsedUrl = new Url(urlStr);\n  var query = parsedUrl.query,\n      path = parsedUrl.path;\n  var pathParts = path.substring(1).split('/');\n  var redactString = ':id';\n  var wildcard = '*';\n  var specialCharsRegex = /\\W|_/g;\n  var digitsRegex = /[0-9]/g;\n  var lowerCaseRegex = /[a-z]/g;\n  var upperCaseRegex = /[A-Z]/g;\n  var redactedParts = [];\n  var redactedBefore = false;\n\n  for (var index = 0; index < pathParts.length; index++) {\n    var part = pathParts[index];\n\n    if (redactedBefore || index > depth - 1) {\n      if (part) {\n        redactedParts.push(wildcard);\n      }\n\n      break;\n    }\n\n    var numberOfSpecialChars = (part.match(specialCharsRegex) || []).length;\n\n    if (numberOfSpecialChars >= 2) {\n      redactedParts.push(redactString);\n      redactedBefore = true;\n      continue;\n    }\n\n    var numberOfDigits = (part.match(digitsRegex) || []).length;\n\n    if (numberOfDigits > 3 || part.length > 3 && numberOfDigits / part.length >= 0.3) {\n      redactedParts.push(redactString);\n      redactedBefore = true;\n      continue;\n    }\n\n    var numberofUpperCase = (part.match(upperCaseRegex) || []).length;\n    var numberofLowerCase = (part.match(lowerCaseRegex) || []).length;\n    var lowerCaseRate = numberofLowerCase / part.length;\n    var upperCaseRate = numberofUpperCase / part.length;\n\n    if (part.length > 5 && (upperCaseRate > 0.3 && upperCaseRate < 0.6 || lowerCaseRate > 0.3 && lowerCaseRate < 0.6)) {\n      redactedParts.push(redactString);\n      redactedBefore = true;\n      continue;\n    }\n\n    part && redactedParts.push(part);\n  }\n\n  var redacted = '/' + (redactedParts.length >= 2 ? redactedParts.join('/') : redactedParts.join('')) + (query ? '?{query}' : '');\n  return redacted;\n}","var SCHEDULE = 'schedule';\nvar INVOKE = 'invoke';\nvar ADD_EVENT_LISTENER_STR = 'addEventListener';\nvar REMOVE_EVENT_LISTENER_STR = 'removeEventListener';\nvar RESOURCE_INITIATOR_TYPES = ['link', 'css', 'script', 'img', 'xmlhttprequest', 'fetch', 'beacon', 'iframe'];\nvar REUSABILITY_THRESHOLD = 5000;\nvar MAX_SPAN_DURATION = 5 * 60 * 1000;\nvar PAGE_LOAD = 'page-load';\nvar ROUTE_CHANGE = 'route-change';\nvar TYPE_CUSTOM = 'custom';\nvar USER_INTERACTION = 'user-interaction';\nvar HTTP_REQUEST_TYPE = 'http-request';\nvar TEMPORARY_TYPE = 'temporary';\nvar NAME_UNKNOWN = 'Unknown';\nvar TRANSACTION_TYPE_ORDER = [PAGE_LOAD, ROUTE_CHANGE, USER_INTERACTION, HTTP_REQUEST_TYPE, TYPE_CUSTOM, TEMPORARY_TYPE];\nvar OUTCOME_SUCCESS = 'success';\nvar OUTCOME_FAILURE = 'failure';\nvar USER_TIMING_THRESHOLD = 60;\nvar TRANSACTION_START = 'transaction:start';\nvar TRANSACTION_END = 'transaction:end';\nvar CONFIG_CHANGE = 'config:change';\nvar XMLHTTPREQUEST = 'xmlhttprequest';\nvar FETCH = 'fetch';\nvar HISTORY = 'history';\nvar EVENT_TARGET = 'eventtarget';\nvar ERROR = 'error';\nvar BEFORE_EVENT = ':before';\nvar AFTER_EVENT = ':after';\nvar LOCAL_CONFIG_KEY = 'elastic_apm_config';\nvar LONG_TASK = 'longtask';\nvar PAINT = 'paint';\nvar MEASURE = 'measure';\nvar NAVIGATION = 'navigation';\nvar RESOURCE = 'resource';\nvar FIRST_CONTENTFUL_PAINT = 'first-contentful-paint';\nvar LARGEST_CONTENTFUL_PAINT = 'largest-contentful-paint';\nvar FIRST_INPUT = 'first-input';\nvar LAYOUT_SHIFT = 'layout-shift';\nvar ERRORS = 'errors';\nvar TRANSACTIONS = 'transactions';\nvar CONFIG_SERVICE = 'ConfigService';\nvar LOGGING_SERVICE = 'LoggingService';\nvar APM_SERVER = 'ApmServer';\nvar TRUNCATED_TYPE = '.truncated';\nvar KEYWORD_LIMIT = 1024;\nvar SESSION_TIMEOUT = 30 * 60000;\nexport { SCHEDULE, INVOKE, ADD_EVENT_LISTENER_STR, REMOVE_EVENT_LISTENER_STR, RESOURCE_INITIATOR_TYPES, REUSABILITY_THRESHOLD, MAX_SPAN_DURATION, PAGE_LOAD, ROUTE_CHANGE, NAME_UNKNOWN, TYPE_CUSTOM, USER_TIMING_THRESHOLD, TRANSACTION_START, TRANSACTION_END, CONFIG_CHANGE, XMLHTTPREQUEST, FETCH, HISTORY, EVENT_TARGET, ERROR, BEFORE_EVENT, AFTER_EVENT, LOCAL_CONFIG_KEY, HTTP_REQUEST_TYPE, LONG_TASK, PAINT, MEASURE, NAVIGATION, RESOURCE, FIRST_CONTENTFUL_PAINT, LARGEST_CONTENTFUL_PAINT, KEYWORD_LIMIT, TEMPORARY_TYPE, USER_INTERACTION, TRANSACTION_TYPE_ORDER, ERRORS, TRANSACTIONS, CONFIG_SERVICE, LOGGING_SERVICE, APM_SERVER, TRUNCATED_TYPE, FIRST_INPUT, LAYOUT_SHIFT, OUTCOME_SUCCESS, OUTCOME_FAILURE, SESSION_TIMEOUT };","var _excluded = [\"tags\"];\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport { Url } from './url';\nimport { PAGE_LOAD, NAVIGATION } from './constants';\nimport { getServerTimingInfo, PERF, isPerfTimelineSupported } from './utils';\nvar LEFT_SQUARE_BRACKET = 91;\nvar RIGHT_SQUARE_BRACKET = 93;\nvar EXTERNAL = 'external';\nvar RESOURCE = 'resource';\nvar HARD_NAVIGATION = 'hard-navigation';\n\nfunction getPortNumber(port, protocol) {\n  if (port === '') {\n    port = protocol === 'http:' ? '80' : protocol === 'https:' ? '443' : '';\n  }\n\n  return port;\n}\n\nfunction getResponseContext(perfTimingEntry) {\n  var transferSize = perfTimingEntry.transferSize,\n      encodedBodySize = perfTimingEntry.encodedBodySize,\n      decodedBodySize = perfTimingEntry.decodedBodySize,\n      serverTiming = perfTimingEntry.serverTiming;\n  var respContext = {\n    transfer_size: transferSize,\n    encoded_body_size: encodedBodySize,\n    decoded_body_size: decodedBodySize\n  };\n  var serverTimingStr = getServerTimingInfo(serverTiming);\n\n  if (serverTimingStr) {\n    respContext.headers = {\n      'server-timing': serverTimingStr\n    };\n  }\n\n  return respContext;\n}\n\nfunction getDestination(parsedUrl, type) {\n  var port = parsedUrl.port,\n      protocol = parsedUrl.protocol,\n      hostname = parsedUrl.hostname,\n      host = parsedUrl.host;\n  var portNumber = getPortNumber(port, protocol);\n  var ipv6Hostname = hostname.charCodeAt(0) === LEFT_SQUARE_BRACKET && hostname.charCodeAt(hostname.length - 1) === RIGHT_SQUARE_BRACKET;\n  var address = hostname;\n\n  if (ipv6Hostname) {\n    address = hostname.slice(1, -1);\n  }\n\n  return {\n    service: {\n      name: protocol + '//' + host,\n      resource: hostname + ':' + portNumber,\n      type: type\n    },\n    address: address,\n    port: Number(portNumber)\n  };\n}\n\nfunction getResourceContext(data) {\n  var entry = data.entry,\n      url = data.url;\n  var parsedUrl = new Url(url);\n  var destination = getDestination(parsedUrl, RESOURCE);\n  return {\n    http: {\n      url: url,\n      response: getResponseContext(entry)\n    },\n    destination: destination\n  };\n}\n\nfunction getExternalContext(data) {\n  var url = data.url,\n      method = data.method,\n      target = data.target,\n      response = data.response;\n  var parsedUrl = new Url(url);\n  var destination = getDestination(parsedUrl, EXTERNAL);\n  var context = {\n    http: {\n      method: method,\n      url: parsedUrl.href\n    },\n    destination: destination\n  };\n  var statusCode;\n\n  if (target && typeof target.status !== 'undefined') {\n    statusCode = target.status;\n  } else if (response) {\n    statusCode = response.status;\n  }\n\n  context.http.status_code = statusCode;\n  return context;\n}\n\nfunction getNavigationContext(data) {\n  var url = data.url;\n  var parsedUrl = new Url(url);\n  var destination = getDestination(parsedUrl, HARD_NAVIGATION);\n  return {\n    destination: destination\n  };\n}\n\nexport function getPageContext() {\n  return {\n    page: {\n      referer: document.referrer,\n      url: location.href\n    }\n  };\n}\nexport function addSpanContext(span, data) {\n  if (!data) {\n    return;\n  }\n\n  var type = span.type;\n  var context;\n\n  switch (type) {\n    case EXTERNAL:\n      context = getExternalContext(data);\n      break;\n\n    case RESOURCE:\n      context = getResourceContext(data);\n      break;\n\n    case HARD_NAVIGATION:\n      context = getNavigationContext(data);\n      break;\n  }\n\n  span.addContext(context);\n}\nexport function addTransactionContext(transaction, _temp) {\n  var _ref = _temp === void 0 ? {} : _temp,\n      tags = _ref.tags,\n      configContext = _objectWithoutPropertiesLoose(_ref, _excluded);\n\n  var pageContext = getPageContext();\n  var responseContext = {};\n\n  if (transaction.type === PAGE_LOAD && isPerfTimelineSupported()) {\n    var entries = PERF.getEntriesByType(NAVIGATION);\n\n    if (entries && entries.length > 0) {\n      responseContext = {\n        response: getResponseContext(entries[0])\n      };\n    }\n  }\n\n  transaction.addContext(pageContext, responseContext, configContext);\n}","import { KEYWORD_LIMIT } from './constants';\nvar METADATA_MODEL = {\n  service: {\n    name: [KEYWORD_LIMIT, true],\n    version: true,\n    agent: {\n      version: [KEYWORD_LIMIT, true]\n    },\n    environment: true\n  },\n  labels: {\n    '*': true\n  }\n};\nvar RESPONSE_MODEL = {\n  '*': true,\n  headers: {\n    '*': true\n  }\n};\nvar DESTINATION_MODEL = {\n  address: [KEYWORD_LIMIT],\n  service: {\n    '*': [KEYWORD_LIMIT, true]\n  }\n};\nvar CONTEXT_MODEL = {\n  user: {\n    id: true,\n    email: true,\n    username: true\n  },\n  tags: {\n    '*': true\n  },\n  http: {\n    response: RESPONSE_MODEL\n  },\n  destination: DESTINATION_MODEL,\n  response: RESPONSE_MODEL\n};\nvar SPAN_MODEL = {\n  name: [KEYWORD_LIMIT, true],\n  type: [KEYWORD_LIMIT, true],\n  id: [KEYWORD_LIMIT, true],\n  trace_id: [KEYWORD_LIMIT, true],\n  parent_id: [KEYWORD_LIMIT, true],\n  transaction_id: [KEYWORD_LIMIT, true],\n  subtype: true,\n  action: true,\n  context: CONTEXT_MODEL\n};\nvar TRANSACTION_MODEL = {\n  name: true,\n  parent_id: true,\n  type: [KEYWORD_LIMIT, true],\n  id: [KEYWORD_LIMIT, true],\n  trace_id: [KEYWORD_LIMIT, true],\n  span_count: {\n    started: [KEYWORD_LIMIT, true]\n  },\n  context: CONTEXT_MODEL\n};\nvar ERROR_MODEL = {\n  id: [KEYWORD_LIMIT, true],\n  trace_id: true,\n  transaction_id: true,\n  parent_id: true,\n  culprit: true,\n  exception: {\n    type: true\n  },\n  transaction: {\n    type: true\n  },\n  context: CONTEXT_MODEL\n};\n\nfunction truncate(value, limit, required, placeholder) {\n  if (limit === void 0) {\n    limit = KEYWORD_LIMIT;\n  }\n\n  if (required === void 0) {\n    required = false;\n  }\n\n  if (placeholder === void 0) {\n    placeholder = 'N/A';\n  }\n\n  if (required && isEmpty(value)) {\n    value = placeholder;\n  }\n\n  if (typeof value === 'string') {\n    return value.substring(0, limit);\n  }\n\n  return value;\n}\n\nfunction isEmpty(value) {\n  return value == null || value === '' || typeof value === 'undefined';\n}\n\nfunction replaceValue(target, key, currModel) {\n  var value = truncate(target[key], currModel[0], currModel[1]);\n\n  if (isEmpty(value)) {\n    delete target[key];\n    return;\n  }\n\n  target[key] = value;\n}\n\nfunction truncateModel(model, target, childTarget) {\n  if (model === void 0) {\n    model = {};\n  }\n\n  if (childTarget === void 0) {\n    childTarget = target;\n  }\n\n  var keys = Object.keys(model);\n  var emptyArr = [];\n\n  var _loop = function _loop(i) {\n    var currKey = keys[i];\n    var currModel = model[currKey] === true ? emptyArr : model[currKey];\n\n    if (!Array.isArray(currModel)) {\n      truncateModel(currModel, target, childTarget[currKey]);\n    } else {\n      if (currKey === '*') {\n        Object.keys(childTarget).forEach(function (key) {\n          return replaceValue(childTarget, key, currModel);\n        });\n      } else {\n        replaceValue(childTarget, currKey, currModel);\n      }\n    }\n  };\n\n  for (var i = 0; i < keys.length; i++) {\n    _loop(i);\n  }\n\n  return target;\n}\n\nexport { truncate, truncateModel, SPAN_MODEL, TRANSACTION_MODEL, ERROR_MODEL, METADATA_MODEL, RESPONSE_MODEL };","var _excluded = [\"tags\"];\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport { createStackTraces, filterInvalidFrames } from './stack-trace';\nimport { generateRandomId, merge, extend } from '../common/utils';\nimport { getPageContext } from '../common/context';\nimport { truncateModel, ERROR_MODEL } from '../common/truncate';\nvar IGNORE_KEYS = ['stack', 'message'];\n\nfunction getErrorProperties(error) {\n  var propertyFound = false;\n  var properties = {};\n  Object.keys(error).forEach(function (key) {\n    if (IGNORE_KEYS.indexOf(key) >= 0) {\n      return;\n    }\n\n    var val = error[key];\n\n    if (val == null || typeof val === 'function') {\n      return;\n    }\n\n    if (typeof val === 'object') {\n      if (typeof val.toISOString !== 'function') return;\n      val = val.toISOString();\n    }\n\n    properties[key] = val;\n    propertyFound = true;\n  });\n\n  if (propertyFound) {\n    return properties;\n  }\n}\n\nvar ErrorLogging = function () {\n  function ErrorLogging(apmServer, configService, transactionService) {\n    this._apmServer = apmServer;\n    this._configService = configService;\n    this._transactionService = transactionService;\n  }\n\n  var _proto = ErrorLogging.prototype;\n\n  _proto.createErrorDataModel = function createErrorDataModel(errorEvent) {\n    var frames = createStackTraces(errorEvent);\n    var filteredFrames = filterInvalidFrames(frames);\n    var culprit = '(inline script)';\n    var lastFrame = filteredFrames[filteredFrames.length - 1];\n\n    if (lastFrame && lastFrame.filename) {\n      culprit = lastFrame.filename;\n    }\n\n    var message = errorEvent.message,\n        error = errorEvent.error;\n    var errorMessage = message;\n    var errorType = '';\n    var errorContext = {};\n\n    if (error && typeof error === 'object') {\n      errorMessage = errorMessage || error.message;\n      errorType = error.name;\n      var customProperties = getErrorProperties(error);\n\n      if (customProperties) {\n        errorContext.custom = customProperties;\n      }\n    }\n\n    if (!errorType) {\n      if (errorMessage && errorMessage.indexOf(':') > -1) {\n        errorType = errorMessage.split(':')[0];\n      }\n    }\n\n    var currentTransaction = this._transactionService.getCurrentTransaction();\n\n    var transactionContext = currentTransaction ? currentTransaction.context : {};\n\n    var _this$_configService$ = this._configService.get('context'),\n        tags = _this$_configService$.tags,\n        configContext = _objectWithoutPropertiesLoose(_this$_configService$, _excluded);\n\n    var pageContext = getPageContext();\n    var context = merge({}, pageContext, transactionContext, configContext, errorContext);\n    var errorObject = {\n      id: generateRandomId(),\n      culprit: culprit,\n      exception: {\n        message: errorMessage,\n        stacktrace: filteredFrames,\n        type: errorType\n      },\n      context: context\n    };\n\n    if (currentTransaction) {\n      errorObject = extend(errorObject, {\n        trace_id: currentTransaction.traceId,\n        parent_id: currentTransaction.id,\n        transaction_id: currentTransaction.id,\n        transaction: {\n          type: currentTransaction.type,\n          sampled: currentTransaction.sampled\n        }\n      });\n    }\n\n    return truncateModel(ERROR_MODEL, errorObject);\n  };\n\n  _proto.logErrorEvent = function logErrorEvent(errorEvent) {\n    if (typeof errorEvent === 'undefined') {\n      return;\n    }\n\n    var errorObject = this.createErrorDataModel(errorEvent);\n\n    if (typeof errorObject.exception.message === 'undefined') {\n      return;\n    }\n\n    this._apmServer.addError(errorObject);\n  };\n\n  _proto.registerListeners = function registerListeners() {\n    var _this = this;\n\n    window.addEventListener('error', function (errorEvent) {\n      return _this.logErrorEvent(errorEvent);\n    });\n    window.addEventListener('unhandledrejection', function (promiseRejectionEvent) {\n      return _this.logPromiseEvent(promiseRejectionEvent);\n    });\n  };\n\n  _proto.logPromiseEvent = function logPromiseEvent(promiseRejectionEvent) {\n    var prefix = 'Unhandled promise rejection: ';\n    var reason = promiseRejectionEvent.reason;\n\n    if (reason == null) {\n      reason = '<no reason specified>';\n    }\n\n    var errorEvent;\n\n    if (typeof reason.message === 'string') {\n      var name = reason.name ? reason.name + ': ' : '';\n      errorEvent = {\n        error: reason,\n        message: prefix + name + reason.message\n      };\n    } else {\n      reason = typeof reason === 'object' ? '<object>' : typeof reason === 'function' ? '<function>' : reason;\n      errorEvent = {\n        message: prefix + reason\n      };\n    }\n\n    this.logErrorEvent(errorEvent);\n  };\n\n  _proto.logError = function logError(messageOrError) {\n    var errorEvent = {};\n\n    if (typeof messageOrError === 'string') {\n      errorEvent.message = messageOrError;\n    } else {\n      errorEvent.error = messageOrError;\n    }\n\n    return this.logErrorEvent(errorEvent);\n  };\n\n  return ErrorLogging;\n}();\n\nexport default ErrorLogging;","var Queue = function () {\n  function Queue(onFlush, opts) {\n    if (opts === void 0) {\n      opts = {};\n    }\n\n    this.onFlush = onFlush;\n    this.items = [];\n    this.queueLimit = opts.queueLimit || -1;\n    this.flushInterval = opts.flushInterval || 0;\n    this.timeoutId = undefined;\n  }\n\n  var _proto = Queue.prototype;\n\n  _proto._setTimer = function _setTimer() {\n    var _this = this;\n\n    this.timeoutId = setTimeout(function () {\n      return _this.flush();\n    }, this.flushInterval);\n  };\n\n  _proto._clear = function _clear() {\n    if (typeof this.timeoutId !== 'undefined') {\n      clearTimeout(this.timeoutId);\n      this.timeoutId = undefined;\n    }\n\n    this.items = [];\n  };\n\n  _proto.flush = function flush() {\n    this.onFlush(this.items);\n\n    this._clear();\n  };\n\n  _proto.add = function add(item) {\n    this.items.push(item);\n\n    if (this.queueLimit !== -1 && this.items.length >= this.queueLimit) {\n      this.flush();\n    } else {\n      if (typeof this.timeoutId === 'undefined') {\n        this._setTimer();\n      }\n    }\n  };\n\n  return Queue;\n}();\n\nexport default Queue;","var NDJSON = function () {\n  function NDJSON() {}\n\n  NDJSON.stringify = function stringify(object) {\n    return JSON.stringify(object) + '\\n';\n  };\n\n  return NDJSON;\n}();\n\nexport default NDJSON;","export var globalState = {\n  fetchInProgress: false\n};\nexport function apmSymbol(name) {\n  return '__apm_symbol__' + name;\n}\n\nfunction isPropertyWritable(propertyDesc) {\n  if (!propertyDesc) {\n    return true;\n  }\n\n  if (propertyDesc.writable === false) {\n    return false;\n  }\n\n  return !(typeof propertyDesc.get === 'function' && typeof propertyDesc.set === 'undefined');\n}\n\nfunction attachOriginToPatched(patched, original) {\n  patched[apmSymbol('OriginalDelegate')] = original;\n}\n\nexport function patchMethod(target, name, patchFn) {\n  var proto = target;\n\n  while (proto && !proto.hasOwnProperty(name)) {\n    proto = Object.getPrototypeOf(proto);\n  }\n\n  if (!proto && target[name]) {\n    proto = target;\n  }\n\n  var delegateName = apmSymbol(name);\n  var delegate;\n\n  if (proto && !(delegate = proto[delegateName])) {\n    delegate = proto[delegateName] = proto[name];\n    var desc = proto && Object.getOwnPropertyDescriptor(proto, name);\n\n    if (isPropertyWritable(desc)) {\n      var patchDelegate = patchFn(delegate, delegateName, name);\n\n      proto[name] = function () {\n        return patchDelegate(this, arguments);\n      };\n\n      attachOriginToPatched(proto[name], delegate);\n    }\n  }\n\n  return delegate;\n}\nexport var XHR_IGNORE = apmSymbol('xhrIgnore');\nexport var XHR_SYNC = apmSymbol('xhrSync');\nexport var XHR_URL = apmSymbol('xhrURL');\nexport var XHR_METHOD = apmSymbol('xhrMethod');","import { generateRandomId, setLabel, merge, getDuration, getTime } from '../common/utils';\nimport { NAME_UNKNOWN, TYPE_CUSTOM } from '../common/constants';\n\nvar SpanBase = function () {\n  function SpanBase(name, type, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    if (!name) {\n      name = NAME_UNKNOWN;\n    }\n\n    if (!type) {\n      type = TYPE_CUSTOM;\n    }\n\n    this.name = name;\n    this.type = type;\n    this.options = options;\n    this.id = options.id || generateRandomId(16);\n    this.traceId = options.traceId;\n    this.sampled = options.sampled;\n    this.sampleRate = options.sampleRate;\n    this.timestamp = options.timestamp;\n    this._start = getTime(options.startTime);\n    this._end = undefined;\n    this.ended = false;\n    this.outcome = undefined;\n    this.onEnd = options.onEnd;\n  }\n\n  var _proto = SpanBase.prototype;\n\n  _proto.ensureContext = function ensureContext() {\n    if (!this.context) {\n      this.context = {};\n    }\n  };\n\n  _proto.addLabels = function addLabels(tags) {\n    this.ensureContext();\n    var ctx = this.context;\n\n    if (!ctx.tags) {\n      ctx.tags = {};\n    }\n\n    var keys = Object.keys(tags);\n    keys.forEach(function (k) {\n      return setLabel(k, tags[k], ctx.tags);\n    });\n  };\n\n  _proto.addContext = function addContext() {\n    for (var _len = arguments.length, context = new Array(_len), _key = 0; _key < _len; _key++) {\n      context[_key] = arguments[_key];\n    }\n\n    if (context.length === 0) return;\n    this.ensureContext();\n    merge.apply(void 0, [this.context].concat(context));\n  };\n\n  _proto.end = function end(endTime) {\n    if (this.ended) {\n      return;\n    }\n\n    this.ended = true;\n    this._end = getTime(endTime);\n    this.callOnEnd();\n  };\n\n  _proto.callOnEnd = function callOnEnd() {\n    if (typeof this.onEnd === 'function') {\n      this.onEnd(this);\n    }\n  };\n\n  _proto.duration = function duration() {\n    return getDuration(this._start, this._end);\n  };\n\n  return SpanBase;\n}();\n\nexport default SpanBase;","function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nimport SpanBase from './span-base';\nimport { addSpanContext } from '../common/context';\n\nvar Span = function (_SpanBase) {\n  _inheritsLoose(Span, _SpanBase);\n\n  function Span(name, type, options) {\n    var _this;\n\n    _this = _SpanBase.call(this, name, type, options) || this;\n    _this.parentId = _this.options.parentId;\n    _this.subtype = undefined;\n    _this.action = undefined;\n\n    if (_this.type.indexOf('.') !== -1) {\n      var fields = _this.type.split('.', 3);\n\n      _this.type = fields[0];\n      _this.subtype = fields[1];\n      _this.action = fields[2];\n    }\n\n    _this.sync = _this.options.sync;\n    return _this;\n  }\n\n  var _proto = Span.prototype;\n\n  _proto.end = function end(endTime, data) {\n    _SpanBase.prototype.end.call(this, endTime);\n\n    addSpanContext(this, data);\n  };\n\n  return Span;\n}(SpanBase);\n\nexport default Span;","var __DEV__ = process.env.NODE_ENV !== 'production';\n\nvar state = {\n  bootstrapTime: null,\n  lastHiddenStart: Number.MIN_SAFE_INTEGER\n};\nexport { __DEV__, state };","import Span from './span';\nimport { RESOURCE_INITIATOR_TYPES, MAX_SPAN_DURATION, USER_TIMING_THRESHOLD, PAGE_LOAD, RESOURCE, MEASURE } from '../common/constants';\nimport { stripQueryStringFromUrl, PERF, isPerfTimelineSupported } from '../common/utils';\nimport { state } from '../state';\nvar eventPairs = [['domainLookupStart', 'domainLookupEnd', 'Domain lookup'], ['connectStart', 'connectEnd', 'Making a connection to the server'], ['requestStart', 'responseEnd', 'Requesting and receiving the document'], ['domLoading', 'domInteractive', 'Parsing the document, executing sync. scripts'], ['domContentLoadedEventStart', 'domContentLoadedEventEnd', 'Fire \"DOMContentLoaded\" event'], ['loadEventStart', 'loadEventEnd', 'Fire \"load\" event']];\n\nfunction shouldCreateSpan(start, end, trStart, trEnd, baseTime) {\n  if (baseTime === void 0) {\n    baseTime = 0;\n  }\n\n  return typeof start === 'number' && typeof end === 'number' && start >= baseTime && end > start && start - baseTime >= trStart && end - baseTime <= trEnd && end - start < MAX_SPAN_DURATION && start - baseTime < MAX_SPAN_DURATION && end - baseTime < MAX_SPAN_DURATION;\n}\n\nfunction createNavigationTimingSpans(timings, baseTime, trStart, trEnd) {\n  var spans = [];\n\n  for (var i = 0; i < eventPairs.length; i++) {\n    var start = timings[eventPairs[i][0]];\n    var end = timings[eventPairs[i][1]];\n\n    if (!shouldCreateSpan(start, end, trStart, trEnd, baseTime)) {\n      continue;\n    }\n\n    var span = new Span(eventPairs[i][2], 'hard-navigation.browser-timing');\n    var data = null;\n\n    if (eventPairs[i][0] === 'requestStart') {\n      span.pageResponse = true;\n      data = {\n        url: location.origin\n      };\n    }\n\n    span._start = start - baseTime;\n    span.end(end - baseTime, data);\n    spans.push(span);\n  }\n\n  return spans;\n}\n\nfunction createResourceTimingSpan(resourceTimingEntry) {\n  var name = resourceTimingEntry.name,\n      initiatorType = resourceTimingEntry.initiatorType,\n      startTime = resourceTimingEntry.startTime,\n      responseEnd = resourceTimingEntry.responseEnd;\n  var kind = 'resource';\n\n  if (initiatorType) {\n    kind += '.' + initiatorType;\n  }\n\n  var spanName = stripQueryStringFromUrl(name);\n  var span = new Span(spanName, kind);\n  span._start = startTime;\n  span.end(responseEnd, {\n    url: name,\n    entry: resourceTimingEntry\n  });\n  return span;\n}\n\nfunction isCapturedByPatching(resourceStartTime, requestPatchTime) {\n  return requestPatchTime != null && resourceStartTime > requestPatchTime;\n}\n\nfunction isIntakeAPIEndpoint(url) {\n  return /intake\\/v\\d+\\/rum\\/events/.test(url);\n}\n\nfunction createResourceTimingSpans(entries, requestPatchTime, trStart, trEnd) {\n  var spans = [];\n\n  for (var i = 0; i < entries.length; i++) {\n    var _entries$i = entries[i],\n        initiatorType = _entries$i.initiatorType,\n        name = _entries$i.name,\n        startTime = _entries$i.startTime,\n        responseEnd = _entries$i.responseEnd;\n\n    if (RESOURCE_INITIATOR_TYPES.indexOf(initiatorType) === -1 || name == null) {\n      continue;\n    }\n\n    if ((initiatorType === 'xmlhttprequest' || initiatorType === 'fetch') && (isIntakeAPIEndpoint(name) || isCapturedByPatching(startTime, requestPatchTime))) {\n      continue;\n    }\n\n    if (shouldCreateSpan(startTime, responseEnd, trStart, trEnd)) {\n      spans.push(createResourceTimingSpan(entries[i]));\n    }\n  }\n\n  return spans;\n}\n\nfunction createUserTimingSpans(entries, trStart, trEnd) {\n  var userTimingSpans = [];\n\n  for (var i = 0; i < entries.length; i++) {\n    var _entries$i2 = entries[i],\n        name = _entries$i2.name,\n        startTime = _entries$i2.startTime,\n        duration = _entries$i2.duration;\n    var end = startTime + duration;\n\n    if (duration <= USER_TIMING_THRESHOLD || !shouldCreateSpan(startTime, end, trStart, trEnd)) {\n      continue;\n    }\n\n    var kind = 'app';\n    var span = new Span(name, kind);\n    span._start = startTime;\n    span.end(end);\n    userTimingSpans.push(span);\n  }\n\n  return userTimingSpans;\n}\n\nvar NAVIGATION_TIMING_MARKS = ['fetchStart', 'domainLookupStart', 'domainLookupEnd', 'connectStart', 'connectEnd', 'requestStart', 'responseStart', 'responseEnd', 'domLoading', 'domInteractive', 'domContentLoadedEventStart', 'domContentLoadedEventEnd', 'domComplete', 'loadEventStart', 'loadEventEnd'];\nvar COMPRESSED_NAV_TIMING_MARKS = ['fs', 'ls', 'le', 'cs', 'ce', 'qs', 'rs', 're', 'dl', 'di', 'ds', 'de', 'dc', 'es', 'ee'];\n\nfunction getNavigationTimingMarks(timing) {\n  var fetchStart = timing.fetchStart,\n      navigationStart = timing.navigationStart,\n      responseStart = timing.responseStart,\n      responseEnd = timing.responseEnd;\n\n  if (fetchStart >= navigationStart && responseStart >= fetchStart && responseEnd >= responseStart) {\n    var marks = {};\n    NAVIGATION_TIMING_MARKS.forEach(function (timingKey) {\n      var m = timing[timingKey];\n\n      if (m && m >= fetchStart) {\n        marks[timingKey] = parseInt(m - fetchStart);\n      }\n    });\n    return marks;\n  }\n\n  return null;\n}\n\nfunction getPageLoadMarks(timing) {\n  var marks = getNavigationTimingMarks(timing);\n\n  if (marks == null) {\n    return null;\n  }\n\n  return {\n    navigationTiming: marks,\n    agent: {\n      timeToFirstByte: marks.responseStart,\n      domInteractive: marks.domInteractive,\n      domComplete: marks.domComplete\n    }\n  };\n}\n\nfunction captureNavigation(transaction) {\n  if (!transaction.captureTimings) {\n    return;\n  }\n\n  var trEnd = transaction._end;\n\n  if (transaction.type === PAGE_LOAD) {\n    if (transaction.marks && transaction.marks.custom) {\n      var customMarks = transaction.marks.custom;\n      Object.keys(customMarks).forEach(function (key) {\n        customMarks[key] += transaction._start;\n      });\n    }\n\n    var trStart = 0;\n    transaction._start = trStart;\n    var timings = PERF.timing;\n    createNavigationTimingSpans(timings, timings.fetchStart, trStart, trEnd).forEach(function (span) {\n      span.traceId = transaction.traceId;\n      span.sampled = transaction.sampled;\n\n      if (span.pageResponse && transaction.options.pageLoadSpanId) {\n        span.id = transaction.options.pageLoadSpanId;\n      }\n\n      transaction.spans.push(span);\n    });\n    transaction.addMarks(getPageLoadMarks(timings));\n  }\n\n  if (isPerfTimelineSupported()) {\n    var _trStart = transaction._start;\n    var resourceEntries = PERF.getEntriesByType(RESOURCE);\n    createResourceTimingSpans(resourceEntries, state.bootstrapTime, _trStart, trEnd).forEach(function (span) {\n      return transaction.spans.push(span);\n    });\n    var userEntries = PERF.getEntriesByType(MEASURE);\n    createUserTimingSpans(userEntries, _trStart, trEnd).forEach(function (span) {\n      return transaction.spans.push(span);\n    });\n  }\n}\n\nexport { getPageLoadMarks, captureNavigation, createNavigationTimingSpans, createResourceTimingSpans, createUserTimingSpans, NAVIGATION_TIMING_MARKS, COMPRESSED_NAV_TIMING_MARKS };","import { Promise } from './polyfills';\nimport { NAVIGATION_TIMING_MARKS, COMPRESSED_NAV_TIMING_MARKS } from '../performance-monitoring/capture-navigation';\n\nfunction compressStackFrames(frames) {\n  return frames.map(function (frame) {\n    return {\n      ap: frame.abs_path,\n      f: frame.filename,\n      fn: frame.function,\n      li: frame.lineno,\n      co: frame.colno\n    };\n  });\n}\n\nfunction compressResponse(response) {\n  return {\n    ts: response.transfer_size,\n    ebs: response.encoded_body_size,\n    dbs: response.decoded_body_size\n  };\n}\n\nfunction compressHTTP(http) {\n  var compressed = {};\n  var method = http.method,\n      status_code = http.status_code,\n      url = http.url,\n      response = http.response;\n  compressed.url = url;\n\n  if (method) {\n    compressed.mt = method;\n  }\n\n  if (status_code) {\n    compressed.sc = status_code;\n  }\n\n  if (response) {\n    compressed.r = compressResponse(response);\n  }\n\n  return compressed;\n}\n\nfunction compressContext(context) {\n  if (!context) {\n    return null;\n  }\n\n  var compressed = {};\n  var page = context.page,\n      http = context.http,\n      response = context.response,\n      destination = context.destination,\n      user = context.user,\n      custom = context.custom;\n\n  if (page) {\n    compressed.p = {\n      rf: page.referer,\n      url: page.url\n    };\n  }\n\n  if (http) {\n    compressed.h = compressHTTP(http);\n  }\n\n  if (response) {\n    compressed.r = compressResponse(response);\n  }\n\n  if (destination) {\n    var service = destination.service;\n    compressed.dt = {\n      se: {\n        n: service.name,\n        t: service.type,\n        rc: service.resource\n      },\n      ad: destination.address,\n      po: destination.port\n    };\n  }\n\n  if (user) {\n    compressed.u = {\n      id: user.id,\n      un: user.username,\n      em: user.email\n    };\n  }\n\n  if (custom) {\n    compressed.cu = custom;\n  }\n\n  return compressed;\n}\n\nfunction compressMarks(marks) {\n  if (!marks) {\n    return null;\n  }\n\n  var navigationTiming = marks.navigationTiming,\n      agent = marks.agent;\n  var compressed = {\n    nt: {}\n  };\n  COMPRESSED_NAV_TIMING_MARKS.forEach(function (mark, index) {\n    var mapping = NAVIGATION_TIMING_MARKS[index];\n    compressed.nt[mark] = navigationTiming[mapping];\n  });\n  compressed.a = {\n    fb: compressed.nt.rs,\n    di: compressed.nt.di,\n    dc: compressed.nt.dc\n  };\n  var fp = agent.firstContentfulPaint;\n  var lp = agent.largestContentfulPaint;\n\n  if (fp) {\n    compressed.a.fp = fp;\n  }\n\n  if (lp) {\n    compressed.a.lp = lp;\n  }\n\n  return compressed;\n}\n\nexport function compressMetadata(metadata) {\n  var service = metadata.service,\n      labels = metadata.labels;\n  var agent = service.agent,\n      language = service.language;\n  return {\n    se: {\n      n: service.name,\n      ve: service.version,\n      a: {\n        n: agent.name,\n        ve: agent.version\n      },\n      la: {\n        n: language.name\n      },\n      en: service.environment\n    },\n    l: labels\n  };\n}\nexport function compressTransaction(transaction) {\n  var spans = transaction.spans.map(function (span) {\n    var spanData = {\n      id: span.id,\n      n: span.name,\n      t: span.type,\n      s: span.start,\n      d: span.duration,\n      c: compressContext(span.context),\n      o: span.outcome,\n      sr: span.sample_rate\n    };\n\n    if (span.parent_id !== transaction.id) {\n      spanData.pid = span.parent_id;\n    }\n\n    if (span.sync === true) {\n      spanData.sy = true;\n    }\n\n    if (span.subtype) {\n      spanData.su = span.subtype;\n    }\n\n    if (span.action) {\n      spanData.ac = span.action;\n    }\n\n    return spanData;\n  });\n  var tr = {\n    id: transaction.id,\n    tid: transaction.trace_id,\n    n: transaction.name,\n    t: transaction.type,\n    d: transaction.duration,\n    c: compressContext(transaction.context),\n    k: compressMarks(transaction.marks),\n    me: compressMetricsets(transaction.breakdown),\n    y: spans,\n    yc: {\n      sd: spans.length\n    },\n    sm: transaction.sampled,\n    sr: transaction.sample_rate,\n    o: transaction.outcome\n  };\n\n  if (transaction.experience) {\n    var _transaction$experien = transaction.experience,\n        cls = _transaction$experien.cls,\n        fid = _transaction$experien.fid,\n        tbt = _transaction$experien.tbt,\n        longtask = _transaction$experien.longtask;\n    tr.exp = {\n      cls: cls,\n      fid: fid,\n      tbt: tbt,\n      lt: longtask\n    };\n  }\n\n  if (transaction.session) {\n    var _transaction$session = transaction.session,\n        id = _transaction$session.id,\n        sequence = _transaction$session.sequence;\n    tr.ses = {\n      id: id,\n      seq: sequence\n    };\n  }\n\n  return tr;\n}\nexport function compressError(error) {\n  var exception = error.exception;\n  var compressed = {\n    id: error.id,\n    cl: error.culprit,\n    ex: {\n      mg: exception.message,\n      st: compressStackFrames(exception.stacktrace),\n      t: error.type\n    },\n    c: compressContext(error.context)\n  };\n  var transaction = error.transaction;\n\n  if (transaction) {\n    compressed.tid = error.trace_id;\n    compressed.pid = error.parent_id;\n    compressed.xid = error.transaction_id;\n    compressed.x = {\n      t: transaction.type,\n      sm: transaction.sampled\n    };\n  }\n\n  return compressed;\n}\nexport function compressMetricsets(breakdowns) {\n  return breakdowns.map(function (_ref) {\n    var span = _ref.span,\n        samples = _ref.samples;\n    var isSpan = span != null;\n\n    if (isSpan) {\n      return {\n        y: {\n          t: span.type\n        },\n        sa: {\n          ysc: {\n            v: samples['span.self_time.count'].value\n          },\n          yss: {\n            v: samples['span.self_time.sum.us'].value\n          }\n        }\n      };\n    }\n\n    return {\n      sa: {\n        xdc: {\n          v: samples['transaction.duration.count'].value\n        },\n        xds: {\n          v: samples['transaction.duration.sum.us'].value\n        },\n        xbc: {\n          v: samples['transaction.breakdown.count'].value\n        }\n      }\n    };\n  });\n}\nexport function compressPayload(params, type) {\n  if (type === void 0) {\n    type = 'gzip';\n  }\n\n  var isCompressionStreamSupported = typeof CompressionStream === 'function';\n  return new Promise(function (resolve) {\n    if (!isCompressionStreamSupported) {\n      return resolve(params);\n    }\n\n    var payload = params.payload,\n        headers = params.headers,\n        beforeSend = params.beforeSend;\n    var payloadStream = new Blob([payload]).stream();\n    var compressedStream = payloadStream.pipeThrough(new CompressionStream(type));\n    return new Response(compressedStream).blob().then(function (payload) {\n      headers['Content-Encoding'] = type;\n      return resolve({\n        payload: payload,\n        headers: headers,\n        beforeSend: beforeSend\n      });\n    });\n  });\n}","import Queue from './queue';\nimport throttle from './throttle';\nimport NDJSON from './ndjson';\nimport { XHR_IGNORE } from './patching/patch-utils';\nimport { truncateModel, METADATA_MODEL } from './truncate';\nimport { ERRORS, TRANSACTIONS } from './constants';\nimport { noop } from './utils';\nimport { Promise } from './polyfills';\nimport { compressMetadata, compressTransaction, compressError, compressPayload } from './compress';\nimport { __DEV__ } from '../state';\nvar THROTTLE_INTERVAL = 60000;\n\nvar ApmServer = function () {\n  function ApmServer(configService, loggingService) {\n    this._configService = configService;\n    this._loggingService = loggingService;\n    this.queue = undefined;\n    this.throttleEvents = noop;\n  }\n\n  var _proto = ApmServer.prototype;\n\n  _proto.init = function init() {\n    var _this = this;\n\n    var queueLimit = this._configService.get('queueLimit');\n\n    var flushInterval = this._configService.get('flushInterval');\n\n    var limit = this._configService.get('eventsLimit');\n\n    var onFlush = function onFlush(events) {\n      var promise = _this.sendEvents(events);\n\n      if (promise) {\n        promise.catch(function (reason) {\n          _this._loggingService.warn('Failed sending events!', _this._constructError(reason));\n        });\n      }\n    };\n\n    this.queue = new Queue(onFlush, {\n      queueLimit: queueLimit,\n      flushInterval: flushInterval\n    });\n    this.throttleEvents = throttle(this.queue.add.bind(this.queue), function () {\n      return _this._loggingService.warn('Dropped events due to throttling!');\n    }, {\n      limit: limit,\n      interval: THROTTLE_INTERVAL\n    });\n  };\n\n  _proto._postJson = function _postJson(endPoint, payload) {\n    var _this2 = this;\n\n    var headers = {\n      'Content-Type': 'application/x-ndjson'\n    };\n\n    var apmRequest = this._configService.get('apmRequest');\n\n    var params = {\n      payload: payload,\n      headers: headers,\n      beforeSend: apmRequest\n    };\n    return compressPayload(params).catch(function (error) {\n      if (__DEV__) {\n        _this2._loggingService.debug('Compressing the payload using CompressionStream API failed', error.message);\n      }\n\n      return params;\n    }).then(function (result) {\n      return _this2._makeHttpRequest('POST', endPoint, result);\n    }).then(function (_ref) {\n      var responseText = _ref.responseText;\n      return responseText;\n    });\n  };\n\n  _proto._constructError = function _constructError(reason) {\n    var url = reason.url,\n        status = reason.status,\n        responseText = reason.responseText;\n\n    if (typeof status == 'undefined') {\n      return reason;\n    }\n\n    var message = url + ' HTTP status: ' + status;\n\n    if (__DEV__ && responseText) {\n      try {\n        var serverErrors = [];\n        var response = JSON.parse(responseText);\n\n        if (response.errors && response.errors.length > 0) {\n          response.errors.forEach(function (err) {\n            return serverErrors.push(err.message);\n          });\n          message += ' ' + serverErrors.join(',');\n        }\n      } catch (e) {\n        this._loggingService.debug('Error parsing response from APM server', e);\n      }\n    }\n\n    return new Error(message);\n  };\n\n  _proto._makeHttpRequest = function _makeHttpRequest(method, url, _temp) {\n    var _ref2 = _temp === void 0 ? {} : _temp,\n        _ref2$timeout = _ref2.timeout,\n        timeout = _ref2$timeout === void 0 ? 10000 : _ref2$timeout,\n        payload = _ref2.payload,\n        headers = _ref2.headers,\n        beforeSend = _ref2.beforeSend;\n\n    return new Promise(function (resolve, reject) {\n      var xhr = new window.XMLHttpRequest();\n      xhr[XHR_IGNORE] = true;\n      xhr.open(method, url, true);\n      xhr.timeout = timeout;\n\n      if (headers) {\n        for (var header in headers) {\n          if (headers.hasOwnProperty(header)) {\n            xhr.setRequestHeader(header, headers[header]);\n          }\n        }\n      }\n\n      xhr.onreadystatechange = function () {\n        if (xhr.readyState === 4) {\n          var status = xhr.status,\n              responseText = xhr.responseText;\n\n          if (status === 0 || status > 399 && status < 600) {\n            reject({\n              url: url,\n              status: status,\n              responseText: responseText\n            });\n          } else {\n            resolve(xhr);\n          }\n        }\n      };\n\n      xhr.onerror = function () {\n        var status = xhr.status,\n            responseText = xhr.responseText;\n        reject({\n          url: url,\n          status: status,\n          responseText: responseText\n        });\n      };\n\n      var canSend = true;\n\n      if (typeof beforeSend === 'function') {\n        canSend = beforeSend({\n          url: url,\n          method: method,\n          headers: headers,\n          payload: payload,\n          xhr: xhr\n        });\n      }\n\n      if (canSend) {\n        xhr.send(payload);\n      } else {\n        reject({\n          url: url,\n          status: 0,\n          responseText: 'Request rejected by user configuration.'\n        });\n      }\n    });\n  };\n\n  _proto.fetchConfig = function fetchConfig(serviceName, environment) {\n    var _this3 = this;\n\n    var serverUrl = this._configService.get('serverUrl');\n\n    var configEndpoint = serverUrl + \"/config/v1/rum/agents\";\n\n    if (!serviceName) {\n      return Promise.reject('serviceName is required for fetching central config.');\n    }\n\n    configEndpoint += \"?service.name=\" + serviceName;\n\n    if (environment) {\n      configEndpoint += \"&service.environment=\" + environment;\n    }\n\n    var localConfig = this._configService.getLocalConfig();\n\n    if (localConfig) {\n      configEndpoint += \"&ifnonematch=\" + localConfig.etag;\n    }\n\n    var apmRequest = this._configService.get('apmRequest');\n\n    return this._makeHttpRequest('GET', configEndpoint, {\n      timeout: 5000,\n      beforeSend: apmRequest\n    }).then(function (xhr) {\n      var status = xhr.status,\n          responseText = xhr.responseText;\n\n      if (status === 304) {\n        return localConfig;\n      } else {\n        var remoteConfig = JSON.parse(responseText);\n        var etag = xhr.getResponseHeader('etag');\n\n        if (etag) {\n          remoteConfig.etag = etag.replace(/[\"]/g, '');\n\n          _this3._configService.setLocalConfig(remoteConfig, true);\n        }\n\n        return remoteConfig;\n      }\n    }).catch(function (reason) {\n      var error = _this3._constructError(reason);\n\n      return Promise.reject(error);\n    });\n  };\n\n  _proto.createMetaData = function createMetaData() {\n    var cfg = this._configService;\n    var metadata = {\n      service: {\n        name: cfg.get('serviceName'),\n        version: cfg.get('serviceVersion'),\n        agent: {\n          name: 'rum-js',\n          version: cfg.version\n        },\n        language: {\n          name: 'javascript'\n        },\n        environment: cfg.get('environment')\n      },\n      labels: cfg.get('context.tags')\n    };\n    return truncateModel(METADATA_MODEL, metadata);\n  };\n\n  _proto.addError = function addError(error) {\n    var _this$throttleEvents;\n\n    this.throttleEvents((_this$throttleEvents = {}, _this$throttleEvents[ERRORS] = error, _this$throttleEvents));\n  };\n\n  _proto.addTransaction = function addTransaction(transaction) {\n    var _this$throttleEvents2;\n\n    this.throttleEvents((_this$throttleEvents2 = {}, _this$throttleEvents2[TRANSACTIONS] = transaction, _this$throttleEvents2));\n  };\n\n  _proto.ndjsonErrors = function ndjsonErrors(errors, compress) {\n    var key = compress ? 'e' : 'error';\n    return errors.map(function (error) {\n      var _NDJSON$stringify;\n\n      return NDJSON.stringify((_NDJSON$stringify = {}, _NDJSON$stringify[key] = compress ? compressError(error) : error, _NDJSON$stringify));\n    });\n  };\n\n  _proto.ndjsonMetricsets = function ndjsonMetricsets(metricsets) {\n    return metricsets.map(function (metricset) {\n      return NDJSON.stringify({\n        metricset: metricset\n      });\n    }).join('');\n  };\n\n  _proto.ndjsonTransactions = function ndjsonTransactions(transactions, compress) {\n    var _this4 = this;\n\n    var key = compress ? 'x' : 'transaction';\n    return transactions.map(function (tr) {\n      var _NDJSON$stringify2;\n\n      var spans = '',\n          breakdowns = '';\n\n      if (!compress) {\n        if (tr.spans) {\n          spans = tr.spans.map(function (span) {\n            return NDJSON.stringify({\n              span: span\n            });\n          }).join('');\n          delete tr.spans;\n        }\n\n        if (tr.breakdown) {\n          breakdowns = _this4.ndjsonMetricsets(tr.breakdown);\n          delete tr.breakdown;\n        }\n      }\n\n      return NDJSON.stringify((_NDJSON$stringify2 = {}, _NDJSON$stringify2[key] = compress ? compressTransaction(tr) : tr, _NDJSON$stringify2)) + spans + breakdowns;\n    });\n  };\n\n  _proto.sendEvents = function sendEvents(events) {\n    var _payload, _NDJSON$stringify3;\n\n    if (events.length === 0) {\n      return;\n    }\n\n    var transactions = [];\n    var errors = [];\n\n    for (var i = 0; i < events.length; i++) {\n      var event = events[i];\n\n      if (event[TRANSACTIONS]) {\n        transactions.push(event[TRANSACTIONS]);\n      }\n\n      if (event[ERRORS]) {\n        errors.push(event[ERRORS]);\n      }\n    }\n\n    if (transactions.length === 0 && errors.length === 0) {\n      return;\n    }\n\n    var cfg = this._configService;\n    var payload = (_payload = {}, _payload[TRANSACTIONS] = transactions, _payload[ERRORS] = errors, _payload);\n    var filteredPayload = cfg.applyFilters(payload);\n\n    if (!filteredPayload) {\n      this._loggingService.warn('Dropped payload due to filtering!');\n\n      return;\n    }\n\n    var apiVersion = cfg.get('apiVersion');\n    var compress = apiVersion > 2;\n    var ndjson = [];\n    var metadata = this.createMetaData();\n    var metadataKey = compress ? 'm' : 'metadata';\n    ndjson.push(NDJSON.stringify((_NDJSON$stringify3 = {}, _NDJSON$stringify3[metadataKey] = compress ? compressMetadata(metadata) : metadata, _NDJSON$stringify3)));\n    ndjson = ndjson.concat(this.ndjsonErrors(filteredPayload[ERRORS], compress), this.ndjsonTransactions(filteredPayload[TRANSACTIONS], compress));\n    var ndjsonPayload = ndjson.join('');\n    var endPoint = cfg.get('serverUrl') + (\"/intake/v\" + apiVersion + \"/rum/events\");\n    return this._postJson(endPoint, ndjsonPayload);\n  };\n\n  return ApmServer;\n}();\n\nexport default ApmServer;","export default function throttle(fn, onThrottle, opts) {\n  var context = this;\n  var limit = opts.limit;\n  var interval = opts.interval;\n  var counter = 0;\n  var timeoutId;\n  return function () {\n    counter++;\n\n    if (typeof timeoutId === 'undefined') {\n      timeoutId = setTimeout(function () {\n        counter = 0;\n        timeoutId = undefined;\n      }, interval);\n    }\n\n    if (counter > limit && typeof onThrottle === 'function') {\n      return onThrottle.apply(context, arguments);\n    } else {\n      return fn.apply(context, arguments);\n    }\n  };\n}","import { BEFORE_EVENT, AFTER_EVENT } from './constants';\n\nvar EventHandler = function () {\n  function EventHandler() {\n    this.observers = {};\n  }\n\n  var _proto = EventHandler.prototype;\n\n  _proto.observe = function observe(name, fn) {\n    var _this = this;\n\n    if (typeof fn === 'function') {\n      if (!this.observers[name]) {\n        this.observers[name] = [];\n      }\n\n      this.observers[name].push(fn);\n      return function () {\n        var index = _this.observers[name].indexOf(fn);\n\n        if (index > -1) {\n          _this.observers[name].splice(index, 1);\n        }\n      };\n    }\n  };\n\n  _proto.sendOnly = function sendOnly(name, args) {\n    var obs = this.observers[name];\n\n    if (obs) {\n      obs.forEach(function (fn) {\n        try {\n          fn.apply(undefined, args);\n        } catch (error) {\n          console.log(error, error.stack);\n        }\n      });\n    }\n  };\n\n  _proto.send = function send(name, args) {\n    this.sendOnly(name + BEFORE_EVENT, args);\n    this.sendOnly(name, args);\n    this.sendOnly(name + AFTER_EVENT, args);\n  };\n\n  return EventHandler;\n}();\n\nexport default EventHandler;","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport { getCurrentScript, setLabel, merge, extend, isUndefined } from './utils';\nimport EventHandler from './event-handler';\nimport { CONFIG_CHANGE, LOCAL_CONFIG_KEY } from './constants';\n\nfunction getConfigFromScript() {\n  var script = getCurrentScript();\n  var config = getDataAttributesFromNode(script);\n  return config;\n}\n\nfunction getDataAttributesFromNode(node) {\n  if (!node) {\n    return {};\n  }\n\n  var dataAttrs = {};\n  var dataRegex = /^data-([\\w-]+)$/;\n  var attrs = node.attributes;\n\n  for (var i = 0; i < attrs.length; i++) {\n    var attr = attrs[i];\n\n    if (dataRegex.test(attr.nodeName)) {\n      var key = attr.nodeName.match(dataRegex)[1];\n      var camelCasedkey = key.split('-').map(function (value, index) {\n        return index > 0 ? value.charAt(0).toUpperCase() + value.substring(1) : value;\n      }).join('');\n      dataAttrs[camelCasedkey] = attr.value || attr.nodeValue;\n    }\n  }\n\n  return dataAttrs;\n}\n\nvar Config = function () {\n  function Config() {\n    this.config = {\n      serviceName: '',\n      serviceVersion: '',\n      environment: '',\n      serverUrl: 'http://localhost:8200',\n      active: true,\n      instrument: true,\n      disableInstrumentations: [],\n      logLevel: 'warn',\n      breakdownMetrics: false,\n      ignoreTransactions: [],\n      eventsLimit: 80,\n      queueLimit: -1,\n      flushInterval: 500,\n      distributedTracing: true,\n      distributedTracingOrigins: [],\n      distributedTracingHeaderName: 'traceparent',\n      pageLoadTraceId: '',\n      pageLoadSpanId: '',\n      pageLoadSampled: false,\n      pageLoadTransactionName: '',\n      propagateTracestate: false,\n      transactionSampleRate: 1.0,\n      centralConfig: false,\n      monitorLongtasks: true,\n      apiVersion: 2,\n      context: {},\n      session: false,\n      apmRequest: null\n    };\n    this.events = new EventHandler();\n    this.filters = [];\n    this.version = '';\n  }\n\n  var _proto = Config.prototype;\n\n  _proto.init = function init() {\n    var scriptData = getConfigFromScript();\n    this.setConfig(scriptData);\n  };\n\n  _proto.setVersion = function setVersion(version) {\n    this.version = version;\n  };\n\n  _proto.addFilter = function addFilter(cb) {\n    if (typeof cb !== 'function') {\n      throw new Error('Argument to must be function');\n    }\n\n    this.filters.push(cb);\n  };\n\n  _proto.applyFilters = function applyFilters(data) {\n    for (var i = 0; i < this.filters.length; i++) {\n      data = this.filters[i](data);\n\n      if (!data) {\n        return;\n      }\n    }\n\n    return data;\n  };\n\n  _proto.get = function get(key) {\n    return key.split('.').reduce(function (obj, objKey) {\n      return obj && obj[objKey];\n    }, this.config);\n  };\n\n  _proto.setUserContext = function setUserContext(userContext) {\n    if (userContext === void 0) {\n      userContext = {};\n    }\n\n    var context = {};\n    var _userContext = userContext,\n        id = _userContext.id,\n        username = _userContext.username,\n        email = _userContext.email;\n\n    if (typeof id === 'number' || typeof id === 'string') {\n      context.id = id;\n    }\n\n    if (typeof username === 'string') {\n      context.username = username;\n    }\n\n    if (typeof email === 'string') {\n      context.email = email;\n    }\n\n    this.config.context.user = extend(this.config.context.user || {}, context);\n  };\n\n  _proto.setCustomContext = function setCustomContext(customContext) {\n    if (customContext === void 0) {\n      customContext = {};\n    }\n\n    this.config.context.custom = extend(this.config.context.custom || {}, customContext);\n  };\n\n  _proto.addLabels = function addLabels(tags) {\n    var _this = this;\n\n    if (!this.config.context.tags) {\n      this.config.context.tags = {};\n    }\n\n    var keys = Object.keys(tags);\n    keys.forEach(function (k) {\n      return setLabel(k, tags[k], _this.config.context.tags);\n    });\n  };\n\n  _proto.setConfig = function setConfig(properties) {\n    if (properties === void 0) {\n      properties = {};\n    }\n\n    var _properties = properties,\n        transactionSampleRate = _properties.transactionSampleRate,\n        serverUrl = _properties.serverUrl;\n\n    if (serverUrl) {\n      properties.serverUrl = serverUrl.replace(/\\/+$/, '');\n    }\n\n    if (!isUndefined(transactionSampleRate)) {\n      if (transactionSampleRate < 0.0001 && transactionSampleRate > 0) {\n        transactionSampleRate = 0.0001;\n      }\n\n      properties.transactionSampleRate = Math.round(transactionSampleRate * 10000) / 10000;\n    }\n\n    merge(this.config, properties);\n    this.events.send(CONFIG_CHANGE, [this.config]);\n  };\n\n  _proto.validate = function validate(properties) {\n    if (properties === void 0) {\n      properties = {};\n    }\n\n    var requiredKeys = ['serviceName', 'serverUrl'];\n    var errors = {\n      missing: [],\n      invalid: []\n    };\n    Object.keys(properties).forEach(function (key) {\n      if (requiredKeys.indexOf(key) !== -1 && !properties[key]) {\n        errors.missing.push(key);\n      }\n    });\n\n    if (properties.serviceName && !/^[a-zA-Z0-9 _-]+$/.test(properties.serviceName)) {\n      errors.invalid.push({\n        key: 'serviceName',\n        value: properties.serviceName,\n        allowed: 'a-z, A-Z, 0-9, _, -, <space>'\n      });\n    }\n\n    var sampleRate = properties.transactionSampleRate;\n\n    if (typeof sampleRate !== 'undefined' && (typeof sampleRate !== 'number' || isNaN(sampleRate) || sampleRate < 0 || sampleRate > 1)) {\n      errors.invalid.push({\n        key: 'transactionSampleRate',\n        value: sampleRate,\n        allowed: 'Number between 0 and 1'\n      });\n    }\n\n    return errors;\n  };\n\n  _proto.getLocalConfig = function getLocalConfig() {\n    var storage = sessionStorage;\n\n    if (this.config.session) {\n      storage = localStorage;\n    }\n\n    var config = storage.getItem(LOCAL_CONFIG_KEY);\n\n    if (config) {\n      return JSON.parse(config);\n    }\n  };\n\n  _proto.setLocalConfig = function setLocalConfig(config, merge) {\n    if (config) {\n      if (merge) {\n        var prevConfig = this.getLocalConfig();\n        config = _extends({}, prevConfig, config);\n      }\n\n      var storage = sessionStorage;\n\n      if (this.config.session) {\n        storage = localStorage;\n      }\n\n      storage.setItem(LOCAL_CONFIG_KEY, JSON.stringify(config));\n    }\n  };\n\n  return Config;\n}();\n\nexport default Config;","var _serviceCreators;\n\nimport ApmServer from './apm-server';\nimport ConfigService from './config-service';\nimport LoggingService from './logging-service';\nimport { CONFIG_CHANGE, CONFIG_SERVICE, LOGGING_SERVICE, APM_SERVER } from './constants';\nimport { __DEV__ } from '../state';\nvar serviceCreators = (_serviceCreators = {}, _serviceCreators[CONFIG_SERVICE] = function () {\n  return new ConfigService();\n}, _serviceCreators[LOGGING_SERVICE] = function () {\n  return new LoggingService({\n    prefix: '[Elastic APM] '\n  });\n}, _serviceCreators[APM_SERVER] = function (factory) {\n  var _factory$getService = factory.getService([CONFIG_SERVICE, LOGGING_SERVICE]),\n      configService = _factory$getService[0],\n      loggingService = _factory$getService[1];\n\n  return new ApmServer(configService, loggingService);\n}, _serviceCreators);\n\nvar ServiceFactory = function () {\n  function ServiceFactory() {\n    this.instances = {};\n    this.initialized = false;\n  }\n\n  var _proto = ServiceFactory.prototype;\n\n  _proto.init = function init() {\n    if (this.initialized) {\n      return;\n    }\n\n    this.initialized = true;\n    var configService = this.getService(CONFIG_SERVICE);\n    configService.init();\n\n    var _this$getService = this.getService([LOGGING_SERVICE, APM_SERVER]),\n        loggingService = _this$getService[0],\n        apmServer = _this$getService[1];\n\n    configService.events.observe(CONFIG_CHANGE, function () {\n      var logLevel = configService.get('logLevel');\n      loggingService.setLevel(logLevel);\n    });\n    apmServer.init();\n  };\n\n  _proto.getService = function getService(name) {\n    var _this = this;\n\n    if (typeof name === 'string') {\n      if (!this.instances[name]) {\n        if (typeof serviceCreators[name] === 'function') {\n          this.instances[name] = serviceCreators[name](this);\n        } else if (__DEV__) {\n          console.log('Cannot get service, No creator for: ' + name);\n        }\n      }\n\n      return this.instances[name];\n    } else if (Array.isArray(name)) {\n      return name.map(function (n) {\n        return _this.getService(n);\n      });\n    }\n  };\n\n  return ServiceFactory;\n}();\n\nexport { serviceCreators, ServiceFactory };","import { noop } from './utils';\n\nvar LoggingService = function () {\n  function LoggingService(spec) {\n    if (spec === void 0) {\n      spec = {};\n    }\n\n    this.levels = ['trace', 'debug', 'info', 'warn', 'error'];\n    this.level = spec.level || 'warn';\n    this.prefix = spec.prefix || '';\n    this.resetLogMethods();\n  }\n\n  var _proto = LoggingService.prototype;\n\n  _proto.shouldLog = function shouldLog(level) {\n    return this.levels.indexOf(level) >= this.levels.indexOf(this.level);\n  };\n\n  _proto.setLevel = function setLevel(level) {\n    if (level === this.level) {\n      return;\n    }\n\n    this.level = level;\n    this.resetLogMethods();\n  };\n\n  _proto.resetLogMethods = function resetLogMethods() {\n    var _this = this;\n\n    this.levels.forEach(function (level) {\n      _this[level] = _this.shouldLog(level) ? log : noop;\n\n      function log() {\n        var normalizedLevel = level;\n\n        if (level === 'trace' || level === 'debug') {\n          normalizedLevel = 'info';\n        }\n\n        var args = arguments;\n        args[0] = this.prefix + args[0];\n\n        if (console) {\n          var realMethod = console[normalizedLevel] || console.log;\n\n          if (typeof realMethod === 'function') {\n            realMethod.apply(console, args);\n          }\n        }\n      }\n    });\n  };\n\n  return LoggingService;\n}();\n\nexport default LoggingService;","import { patchMethod, XHR_SYNC, XHR_URL, XHR_METHOD, XHR_IGNORE } from './patch-utils';\nimport { SCHEDULE, INVOKE, XMLHTTPREQUEST, ADD_EVENT_LISTENER_STR } from '../constants';\nexport function patchXMLHttpRequest(callback) {\n  var XMLHttpRequestPrototype = XMLHttpRequest.prototype;\n\n  if (!XMLHttpRequestPrototype || !XMLHttpRequestPrototype[ADD_EVENT_LISTENER_STR]) {\n    return;\n  }\n\n  var READY_STATE_CHANGE = 'readystatechange';\n  var LOAD = 'load';\n  var ERROR = 'error';\n  var TIMEOUT = 'timeout';\n  var ABORT = 'abort';\n\n  function invokeTask(task, status) {\n    if (task.state !== INVOKE) {\n      task.state = INVOKE;\n      task.data.status = status;\n      callback(INVOKE, task);\n    }\n  }\n\n  function scheduleTask(task) {\n    if (task.state === SCHEDULE) {\n      return;\n    }\n\n    task.state = SCHEDULE;\n    callback(SCHEDULE, task);\n    var target = task.data.target;\n\n    function addListener(name) {\n      target[ADD_EVENT_LISTENER_STR](name, function (_ref) {\n        var type = _ref.type;\n\n        if (type === READY_STATE_CHANGE) {\n          if (target.readyState === 4 && target.status !== 0) {\n            invokeTask(task, 'success');\n          }\n        } else {\n          var status = type === LOAD ? 'success' : type;\n          invokeTask(task, status);\n        }\n      });\n    }\n\n    addListener(READY_STATE_CHANGE);\n    addListener(LOAD);\n    addListener(TIMEOUT);\n    addListener(ERROR);\n    addListener(ABORT);\n  }\n\n  var openNative = patchMethod(XMLHttpRequestPrototype, 'open', function () {\n    return function (self, args) {\n      if (!self[XHR_IGNORE]) {\n        self[XHR_METHOD] = args[0];\n        self[XHR_URL] = args[1];\n        self[XHR_SYNC] = args[2] === false;\n      }\n\n      return openNative.apply(self, args);\n    };\n  });\n  var sendNative = patchMethod(XMLHttpRequestPrototype, 'send', function () {\n    return function (self, args) {\n      if (self[XHR_IGNORE]) {\n        return sendNative.apply(self, args);\n      }\n\n      var task = {\n        source: XMLHTTPREQUEST,\n        state: '',\n        type: 'macroTask',\n        data: {\n          target: self,\n          method: self[XHR_METHOD],\n          sync: self[XHR_SYNC],\n          url: self[XHR_URL],\n          status: ''\n        }\n      };\n\n      try {\n        scheduleTask(task);\n        return sendNative.apply(self, args);\n      } catch (e) {\n        invokeTask(task, ERROR);\n        throw e;\n      }\n    };\n  });\n}","import { SCHEDULE, INVOKE, ADD_EVENT_LISTENER_STR, REMOVE_EVENT_LISTENER_STR, EVENT_TARGET } from '../constants';\nimport { apmSymbol } from './patch-utils';\nvar eventTypes = ['click'];\nvar eventTypeSymbols = {};\n\nfor (var i = 0; i < eventTypes.length; i++) {\n  var et = eventTypes[i];\n  eventTypeSymbols[et] = apmSymbol(et);\n}\n\nfunction shouldInstrumentEvent(target, eventType, listenerFn) {\n  return target instanceof Element && eventTypes.indexOf(eventType) >= 0 && typeof listenerFn === 'function';\n}\n\nexport function patchEventTarget(callback) {\n  if (!window.EventTarget) {\n    return;\n  }\n\n  var proto = window.EventTarget.prototype;\n  var nativeAddEventListener = proto[ADD_EVENT_LISTENER_STR];\n  var nativeRemoveEventListener = proto[REMOVE_EVENT_LISTENER_STR];\n\n  function findTaskIndex(existingTasks, eventType, listenerFn, capture) {\n    for (var _i = 0; _i < existingTasks.length; _i++) {\n      var task = existingTasks[_i];\n\n      if (task.eventType === eventType && task.listenerFn === listenerFn && task.capture === capture) {\n        return _i;\n      }\n    }\n\n    return -1;\n  }\n\n  function isCapture(options) {\n    var capture;\n\n    if (typeof options === 'boolean') {\n      capture = options;\n    } else {\n      capture = options ? !!options.capture : false;\n    }\n\n    return capture;\n  }\n\n  function createListenerWrapper(target, eventType, listenerFn, options) {\n    var eventSymbol = eventTypeSymbols[eventType];\n    if (!eventSymbol) return listenerFn;\n    var existingTasks = target[eventSymbol];\n    var capture = isCapture(options);\n\n    if (existingTasks) {\n      var taskIndex = findTaskIndex(existingTasks, eventType, listenerFn, capture);\n\n      if (taskIndex !== -1) {\n        var _task = existingTasks[taskIndex];\n        return _task.wrappingFn;\n      }\n    } else {\n      existingTasks = target[eventSymbol] = [];\n    }\n\n    var task = {\n      source: EVENT_TARGET,\n      target: target,\n      eventType: eventType,\n      listenerFn: listenerFn,\n      capture: capture,\n      wrappingFn: wrappingFn\n    };\n    existingTasks.push(task);\n\n    function wrappingFn() {\n      callback(SCHEDULE, task);\n      var result;\n\n      try {\n        result = listenerFn.apply(this, arguments);\n      } finally {\n        callback(INVOKE, task);\n      }\n\n      return result;\n    }\n\n    return wrappingFn;\n  }\n\n  function getWrappingFn(target, eventType, listenerFn, options) {\n    var eventSymbol = eventTypeSymbols[eventType];\n    var existingTasks = target[eventSymbol];\n\n    if (existingTasks) {\n      var capture = isCapture(options);\n      var taskIndex = findTaskIndex(existingTasks, eventType, listenerFn, capture);\n\n      if (taskIndex !== -1) {\n        var task = existingTasks[taskIndex];\n        existingTasks.splice(taskIndex, 1);\n\n        if (existingTasks.length === 0) {\n          target[eventSymbol] = undefined;\n        }\n\n        return task.wrappingFn;\n      }\n    }\n\n    return listenerFn;\n  }\n\n  proto[ADD_EVENT_LISTENER_STR] = function (eventType, listenerFn, optionsOrCapture) {\n    var target = this;\n\n    if (!shouldInstrumentEvent(target, eventType, listenerFn)) {\n      return nativeAddEventListener.apply(target, arguments);\n    }\n\n    var wrappingListenerFn = createListenerWrapper(target, eventType, listenerFn, optionsOrCapture);\n    var args = Array.prototype.slice.call(arguments);\n    args[1] = wrappingListenerFn;\n    return nativeAddEventListener.apply(target, args);\n  };\n\n  proto[REMOVE_EVENT_LISTENER_STR] = function (eventType, listenerFn, optionsOrCapture) {\n    var target = this;\n\n    if (!shouldInstrumentEvent(target, eventType, listenerFn)) {\n      return nativeRemoveEventListener.apply(target, arguments);\n    }\n\n    var wrappingFn = getWrappingFn(target, eventType, listenerFn, optionsOrCapture);\n    var args = Array.prototype.slice.call(arguments);\n    args[1] = wrappingFn;\n    return nativeRemoveEventListener.apply(target, args);\n  };\n}","import { patchXMLHttpRequest } from './xhr-patch';\nimport { patchFetch } from './fetch-patch';\nimport { patchHistory } from './history-patch';\nimport { patchEventTarget } from './event-target-patch';\nimport EventHandler from '../event-handler';\nimport { HISTORY, FETCH, XMLHTTPREQUEST, EVENT_TARGET } from '../constants';\nvar patchEventHandler = new EventHandler();\nvar alreadyPatched = false;\n\nfunction patchAll() {\n  if (!alreadyPatched) {\n    alreadyPatched = true;\n    patchXMLHttpRequest(function (event, task) {\n      patchEventHandler.send(XMLHTTPREQUEST, [event, task]);\n    });\n    patchFetch(function (event, task) {\n      patchEventHandler.send(FETCH, [event, task]);\n    });\n    patchHistory(function (event, task) {\n      patchEventHandler.send(HISTORY, [event, task]);\n    });\n    patchEventTarget(function (event, task) {\n      patchEventHandler.send(EVENT_TARGET, [event, task]);\n    });\n  }\n\n  return patchEventHandler;\n}\n\nexport { patchAll, patchEventHandler };","import { Promise } from '../polyfills';\nimport { globalState } from './patch-utils';\nimport { SCHEDULE, INVOKE, FETCH } from '../constants';\nimport { scheduleMicroTask } from '../utils';\nexport function patchFetch(callback) {\n  if (!window.fetch || !window.Request) {\n    return;\n  }\n\n  function scheduleTask(task) {\n    task.state = SCHEDULE;\n    callback(SCHEDULE, task);\n  }\n\n  function invokeTask(task) {\n    task.state = INVOKE;\n    callback(INVOKE, task);\n  }\n\n  var nativeFetch = window.fetch;\n\n  window.fetch = function (input, init) {\n    var fetchSelf = this;\n    var args = arguments;\n    var request, url;\n\n    if (typeof input === 'string') {\n      request = new Request(input, init);\n      url = input;\n    } else if (input) {\n      request = input;\n      url = request.url;\n    } else {\n      return nativeFetch.apply(fetchSelf, args);\n    }\n\n    var task = {\n      source: FETCH,\n      state: '',\n      type: 'macroTask',\n      data: {\n        target: request,\n        method: request.method,\n        url: url,\n        aborted: false\n      }\n    };\n    return new Promise(function (resolve, reject) {\n      globalState.fetchInProgress = true;\n      scheduleTask(task);\n      var promise;\n\n      try {\n        promise = nativeFetch.apply(fetchSelf, [request]);\n      } catch (error) {\n        reject(error);\n        task.data.error = error;\n        invokeTask(task);\n        globalState.fetchInProgress = false;\n        return;\n      }\n\n      promise.then(function (response) {\n        resolve(response);\n        scheduleMicroTask(function () {\n          task.data.response = response;\n          invokeTask(task);\n        });\n      }, function (error) {\n        reject(error);\n        scheduleMicroTask(function () {\n          task.data.error = error;\n          invokeTask(task);\n        });\n      });\n      globalState.fetchInProgress = false;\n    });\n  };\n}","import { INVOKE, HISTORY } from '../constants';\nexport function patchHistory(callback) {\n  if (!window.history) {\n    return;\n  }\n\n  var nativePushState = history.pushState;\n\n  if (typeof nativePushState === 'function') {\n    history.pushState = function (state, title, url) {\n      var task = {\n        source: HISTORY,\n        data: {\n          state: state,\n          title: title,\n          url: url\n        }\n      };\n      callback(INVOKE, task);\n      nativePushState.apply(this, arguments);\n    };\n  }\n}","import { checkSameOrigin, isDtHeaderValid, parseDtHeaderValue, getDtHeaderValue, getTSHeaderValue, stripQueryStringFromUrl, setRequestHeader } from '../common/utils';\nimport { Url } from '../common/url';\nimport { patchEventHandler } from '../common/patching';\nimport { globalState } from '../common/patching/patch-utils';\nimport { SCHEDULE, INVOKE, TRANSACTION_END, AFTER_EVENT, FETCH, HISTORY, XMLHTTPREQUEST, EVENT_TARGET, HTTP_REQUEST_TYPE, USER_INTERACTION, OUTCOME_FAILURE, OUTCOME_SUCCESS } from '../common/constants';\nimport { truncateModel, SPAN_MODEL, TRANSACTION_MODEL } from '../common/truncate';\nimport { __DEV__ } from '../state';\nvar SIMILAR_SPAN_TO_TRANSACTION_RATIO = 0.05;\nvar TRANSACTION_DURATION_THRESHOLD = 60000;\nexport function groupSmallContinuouslySimilarSpans(originalSpans, transDuration, threshold) {\n  originalSpans.sort(function (spanA, spanB) {\n    return spanA._start - spanB._start;\n  });\n  var spans = [];\n  var lastCount = 1;\n  originalSpans.forEach(function (span, index) {\n    if (spans.length === 0) {\n      spans.push(span);\n    } else {\n      var lastSpan = spans[spans.length - 1];\n      var isContinuouslySimilar = lastSpan.type === span.type && lastSpan.subtype === span.subtype && lastSpan.action === span.action && lastSpan.name === span.name && span.duration() / transDuration < threshold && (span._start - lastSpan._end) / transDuration < threshold;\n      var isLastSpan = originalSpans.length === index + 1;\n\n      if (isContinuouslySimilar) {\n        lastCount++;\n        lastSpan._end = span._end;\n      }\n\n      if (lastCount > 1 && (!isContinuouslySimilar || isLastSpan)) {\n        lastSpan.name = lastCount + 'x ' + lastSpan.name;\n        lastCount = 1;\n      }\n\n      if (!isContinuouslySimilar) {\n        spans.push(span);\n      }\n    }\n  });\n  return spans;\n}\nexport function adjustTransaction(transaction) {\n  if (transaction.sampled) {\n    var filterdSpans = transaction.spans.filter(function (span) {\n      return span.duration() > 0 && span._start >= transaction._start && span._end <= transaction._end;\n    });\n\n    if (transaction.isManaged()) {\n      var duration = transaction.duration();\n      var similarSpans = groupSmallContinuouslySimilarSpans(filterdSpans, duration, SIMILAR_SPAN_TO_TRANSACTION_RATIO);\n      transaction.spans = similarSpans;\n    } else {\n      transaction.spans = filterdSpans;\n    }\n  } else {\n    transaction.resetFields();\n  }\n\n  return transaction;\n}\n\nvar PerformanceMonitoring = function () {\n  function PerformanceMonitoring(apmServer, configService, loggingService, transactionService) {\n    this._apmServer = apmServer;\n    this._configService = configService;\n    this._logginService = loggingService;\n    this._transactionService = transactionService;\n  }\n\n  var _proto = PerformanceMonitoring.prototype;\n\n  _proto.init = function init(flags) {\n    var _this = this;\n\n    if (flags === void 0) {\n      flags = {};\n    }\n\n    this._configService.events.observe(TRANSACTION_END + AFTER_EVENT, function (tr) {\n      var payload = _this.createTransactionPayload(tr);\n\n      if (payload) {\n        _this._apmServer.addTransaction(payload);\n      }\n    });\n\n    if (flags[HISTORY]) {\n      patchEventHandler.observe(HISTORY, this.getHistorySub());\n    }\n\n    if (flags[XMLHTTPREQUEST]) {\n      patchEventHandler.observe(XMLHTTPREQUEST, this.getXHRSub());\n    }\n\n    if (flags[FETCH]) {\n      patchEventHandler.observe(FETCH, this.getFetchSub());\n    }\n\n    if (flags[EVENT_TARGET]) {\n      patchEventHandler.observe(EVENT_TARGET, this.getEventTargetSub());\n    }\n  };\n\n  _proto.getEventTargetSub = function getEventTargetSub() {\n    var transactionService = this._transactionService;\n    return function (event, task) {\n      if (event === SCHEDULE && task.source === EVENT_TARGET && task.eventType === 'click') {\n        var target = task.target;\n        var name = target.getAttribute('name');\n        var additionalInfo = '';\n\n        if (name) {\n          additionalInfo = \"[\\\"\" + name + \"\\\"]\";\n        }\n\n        var tagName = target.tagName.toLowerCase();\n        var tr = transactionService.startTransaction(\"Click - \" + tagName + additionalInfo, USER_INTERACTION, {\n          managed: true,\n          canReuse: true,\n          reuseThreshold: 300\n        });\n\n        if (tr) {\n          var classes = target.getAttribute('class');\n\n          if (classes) {\n            tr.addContext({\n              custom: {\n                classes: classes\n              }\n            });\n          }\n        }\n      }\n    };\n  };\n\n  _proto.getHistorySub = function getHistorySub() {\n    var transactionService = this._transactionService;\n    return function (event, task) {\n      if (task.source === HISTORY && event === INVOKE) {\n        transactionService.startTransaction(task.data.title, 'route-change', {\n          managed: true,\n          canReuse: true\n        });\n      }\n    };\n  };\n\n  _proto.getXHRSub = function getXHRSub() {\n    var _this2 = this;\n\n    return function (event, task) {\n      if (task.source === XMLHTTPREQUEST && !globalState.fetchInProgress) {\n        _this2.processAPICalls(event, task);\n      }\n    };\n  };\n\n  _proto.getFetchSub = function getFetchSub() {\n    var _this3 = this;\n\n    return function (event, task) {\n      if (task.source === FETCH) {\n        _this3.processAPICalls(event, task);\n      }\n    };\n  };\n\n  _proto.processAPICalls = function processAPICalls(event, task) {\n    var configService = this._configService;\n    var transactionService = this._transactionService;\n\n    if (event === SCHEDULE && task.data) {\n      var data = task.data;\n      var requestUrl = new Url(data.url);\n      var spanName = data.method + ' ' + (requestUrl.relative ? requestUrl.path : stripQueryStringFromUrl(requestUrl.href));\n\n      if (!transactionService.getCurrentTransaction()) {\n        transactionService.startTransaction(spanName, HTTP_REQUEST_TYPE, {\n          managed: true\n        });\n      }\n\n      var span = transactionService.startSpan(spanName, 'external.http', {\n        blocking: true\n      });\n\n      if (!span) {\n        return;\n      }\n\n      var isDtEnabled = configService.get('distributedTracing');\n      var dtOrigins = configService.get('distributedTracingOrigins');\n      var currentUrl = new Url(window.location.href);\n      var isSameOrigin = checkSameOrigin(requestUrl.origin, currentUrl.origin) || checkSameOrigin(requestUrl.origin, dtOrigins);\n      var target = data.target;\n\n      if (isDtEnabled && isSameOrigin && target) {\n        this.injectDtHeader(span, target);\n        var propagateTracestate = configService.get('propagateTracestate');\n\n        if (propagateTracestate) {\n          this.injectTSHeader(span, target);\n        }\n      } else if (__DEV__) {\n        this._logginService.debug(\"Could not inject distributed tracing header to the request origin ('\" + requestUrl.origin + \"') from the current origin ('\" + currentUrl.origin + \"')\");\n      }\n\n      if (data.sync) {\n        span.sync = data.sync;\n      }\n\n      data.span = span;\n    } else if (event === INVOKE) {\n      var _data = task.data;\n\n      if (_data && _data.span) {\n        var _span = _data.span,\n            response = _data.response,\n            _target = _data.target;\n        var status;\n\n        if (response) {\n          status = response.status;\n        } else {\n          status = _target.status;\n        }\n\n        var outcome;\n\n        if (_data.status != 'abort') {\n          if (status >= 400 || status == 0) {\n            outcome = OUTCOME_FAILURE;\n          } else {\n            outcome = OUTCOME_SUCCESS;\n          }\n        }\n\n        _span.outcome = outcome;\n        var tr = transactionService.getCurrentTransaction();\n\n        if (tr && tr.type === HTTP_REQUEST_TYPE) {\n          tr.outcome = outcome;\n        }\n\n        transactionService.endSpan(_span, _data);\n      }\n    }\n  };\n\n  _proto.injectDtHeader = function injectDtHeader(span, target) {\n    var headerName = this._configService.get('distributedTracingHeaderName');\n\n    var headerValue = getDtHeaderValue(span);\n    var isHeaderValid = isDtHeaderValid(headerValue);\n\n    if (isHeaderValid && headerValue && headerName) {\n      setRequestHeader(target, headerName, headerValue);\n    }\n  };\n\n  _proto.injectTSHeader = function injectTSHeader(span, target) {\n    var headerValue = getTSHeaderValue(span);\n\n    if (headerValue) {\n      setRequestHeader(target, 'tracestate', headerValue);\n    }\n  };\n\n  _proto.extractDtHeader = function extractDtHeader(target) {\n    var configService = this._configService;\n    var headerName = configService.get('distributedTracingHeaderName');\n\n    if (target) {\n      return parseDtHeaderValue(target[headerName]);\n    }\n  };\n\n  _proto.filterTransaction = function filterTransaction(tr) {\n    var duration = tr.duration();\n\n    if (!duration) {\n      if (__DEV__) {\n        var message = \"transaction(\" + tr.id + \", \" + tr.name + \") was discarded! \";\n\n        if (duration === 0) {\n          message += \"Transaction duration is 0\";\n        } else {\n          message += \"Transaction wasn't ended\";\n        }\n\n        this._logginService.debug(message);\n      }\n\n      return false;\n    }\n\n    if (tr.isManaged()) {\n      if (duration > TRANSACTION_DURATION_THRESHOLD) {\n        if (__DEV__) {\n          this._logginService.debug(\"transaction(\" + tr.id + \", \" + tr.name + \") was discarded! Transaction duration (\" + duration + \") is greater than managed transaction threshold (\" + TRANSACTION_DURATION_THRESHOLD + \")\");\n        }\n\n        return false;\n      }\n\n      if (tr.sampled && tr.spans.length === 0) {\n        if (__DEV__) {\n          this._logginService.debug(\"transaction(\" + tr.id + \", \" + tr.name + \") was discarded! Transaction does not have any spans\");\n        }\n\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  _proto.createTransactionDataModel = function createTransactionDataModel(transaction) {\n    var transactionStart = transaction._start;\n    var spans = transaction.spans.map(function (span) {\n      var spanData = {\n        id: span.id,\n        transaction_id: transaction.id,\n        parent_id: span.parentId || transaction.id,\n        trace_id: transaction.traceId,\n        name: span.name,\n        type: span.type,\n        subtype: span.subtype,\n        action: span.action,\n        sync: span.sync,\n        start: parseInt(span._start - transactionStart),\n        duration: span.duration(),\n        context: span.context,\n        outcome: span.outcome,\n        sample_rate: span.sampleRate\n      };\n      return truncateModel(SPAN_MODEL, spanData);\n    });\n    var transactionData = {\n      id: transaction.id,\n      trace_id: transaction.traceId,\n      session: transaction.session,\n      name: transaction.name,\n      type: transaction.type,\n      duration: transaction.duration(),\n      spans: spans,\n      context: transaction.context,\n      marks: transaction.marks,\n      breakdown: transaction.breakdownTimings,\n      span_count: {\n        started: spans.length\n      },\n      sampled: transaction.sampled,\n      sample_rate: transaction.sampleRate,\n      experience: transaction.experience,\n      outcome: transaction.outcome\n    };\n    return truncateModel(TRANSACTION_MODEL, transactionData);\n  };\n\n  _proto.createTransactionPayload = function createTransactionPayload(transaction) {\n    var adjustedTransaction = adjustTransaction(transaction);\n    var filtered = this.filterTransaction(adjustedTransaction);\n\n    if (filtered) {\n      return this.createTransactionDataModel(transaction);\n    }\n  };\n\n  return PerformanceMonitoring;\n}();\n\nexport { PerformanceMonitoring as default };","import { getDuration, PERF } from '../common/utils';\nimport { PAGE_LOAD, TRUNCATED_TYPE } from '../common/constants';\nvar pageLoadBreakdowns = [['domainLookupStart', 'domainLookupEnd', 'DNS'], ['connectStart', 'connectEnd', 'TCP'], ['requestStart', 'responseStart', 'Request'], ['responseStart', 'responseEnd', 'Response'], ['domLoading', 'domComplete', 'Processing'], ['loadEventStart', 'loadEventEnd', 'Load']];\n\nfunction getValue(value) {\n  return {\n    value: value\n  };\n}\n\nfunction calculateSelfTime(transaction) {\n  var spans = transaction.spans,\n      _start = transaction._start,\n      _end = transaction._end;\n\n  if (spans.length === 0) {\n    return transaction.duration();\n  }\n\n  spans.sort(function (span1, span2) {\n    return span1._start - span2._start;\n  });\n  var span = spans[0];\n  var spanEnd = span._end;\n  var spanStart = span._start;\n  var lastContinuousEnd = spanEnd;\n  var selfTime = spanStart - _start;\n\n  for (var i = 1; i < spans.length; i++) {\n    span = spans[i];\n    spanStart = span._start;\n    spanEnd = span._end;\n\n    if (spanStart > lastContinuousEnd) {\n      selfTime += spanStart - lastContinuousEnd;\n      lastContinuousEnd = spanEnd;\n    } else if (spanEnd > lastContinuousEnd) {\n      lastContinuousEnd = spanEnd;\n    }\n  }\n\n  if (lastContinuousEnd < _end) {\n    selfTime += _end - lastContinuousEnd;\n  }\n\n  return selfTime;\n}\n\nfunction groupSpans(transaction) {\n  var spanMap = {};\n  var transactionSelfTime = calculateSelfTime(transaction);\n  spanMap['app'] = {\n    count: 1,\n    duration: transactionSelfTime\n  };\n  var spans = transaction.spans;\n\n  for (var i = 0; i < spans.length; i++) {\n    var span = spans[i];\n    var duration = span.duration();\n\n    if (duration === 0 || duration == null) {\n      continue;\n    }\n\n    var type = span.type,\n        subtype = span.subtype;\n    var key = type.replace(TRUNCATED_TYPE, '');\n\n    if (subtype) {\n      key += '.' + subtype;\n    }\n\n    if (!spanMap[key]) {\n      spanMap[key] = {\n        duration: 0,\n        count: 0\n      };\n    }\n\n    spanMap[key].count++;\n    spanMap[key].duration += duration;\n  }\n\n  return spanMap;\n}\n\nfunction getSpanBreakdown(transactionDetails, _ref) {\n  var details = _ref.details,\n      _ref$count = _ref.count,\n      count = _ref$count === void 0 ? 1 : _ref$count,\n      duration = _ref.duration;\n  return {\n    transaction: transactionDetails,\n    span: details,\n    samples: {\n      'span.self_time.count': getValue(count),\n      'span.self_time.sum.us': getValue(duration)\n    }\n  };\n}\n\nexport function captureBreakdown(transaction, timings) {\n  if (timings === void 0) {\n    timings = PERF.timing;\n  }\n\n  var breakdowns = [];\n  var trDuration = transaction.duration();\n  var name = transaction.name,\n      type = transaction.type,\n      sampled = transaction.sampled;\n  var transactionDetails = {\n    name: name,\n    type: type\n  };\n  breakdowns.push({\n    transaction: transactionDetails,\n    samples: {\n      'transaction.duration.count': getValue(1),\n      'transaction.duration.sum.us': getValue(trDuration),\n      'transaction.breakdown.count': getValue(sampled ? 1 : 0)\n    }\n  });\n\n  if (!sampled) {\n    return breakdowns;\n  }\n\n  if (type === PAGE_LOAD && timings) {\n    for (var i = 0; i < pageLoadBreakdowns.length; i++) {\n      var current = pageLoadBreakdowns[i];\n      var start = timings[current[0]];\n      var end = timings[current[1]];\n      var duration = getDuration(start, end);\n\n      if (duration === 0 || duration == null) {\n        continue;\n      }\n\n      breakdowns.push(getSpanBreakdown(transactionDetails, {\n        details: {\n          type: current[2]\n        },\n        duration: duration\n      }));\n    }\n  } else {\n    var spanMap = groupSpans(transaction);\n    Object.keys(spanMap).forEach(function (key) {\n      var _key$split = key.split('.'),\n          type = _key$split[0],\n          subtype = _key$split[1];\n\n      var _spanMap$key = spanMap[key],\n          duration = _spanMap$key.duration,\n          count = _spanMap$key.count;\n      breakdowns.push(getSpanBreakdown(transactionDetails, {\n        details: {\n          type: type,\n          subtype: subtype\n        },\n        duration: duration,\n        count: count\n      }));\n    });\n  }\n\n  return breakdowns;\n}","function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nimport Span from './span';\nimport SpanBase from './span-base';\nimport { generateRandomId, merge, now, getTime, extend, removeInvalidChars } from '../common/utils';\nimport { REUSABILITY_THRESHOLD, TRUNCATED_TYPE } from '../common/constants';\nimport { captureBreakdown as _captureBreakdown } from './breakdown';\n\nvar Transaction = function (_SpanBase) {\n  _inheritsLoose(Transaction, _SpanBase);\n\n  function Transaction(name, type, options) {\n    var _this;\n\n    _this = _SpanBase.call(this, name, type, options) || this;\n    _this.traceId = generateRandomId();\n    _this.marks = undefined;\n    _this.spans = [];\n    _this._activeSpans = {};\n    _this._activeTasks = new Set();\n    _this.blocked = false;\n    _this.captureTimings = false;\n    _this.breakdownTimings = [];\n    _this.sampleRate = _this.options.transactionSampleRate;\n    _this.sampled = Math.random() <= _this.sampleRate;\n    return _this;\n  }\n\n  var _proto = Transaction.prototype;\n\n  _proto.addMarks = function addMarks(obj) {\n    this.marks = merge(this.marks || {}, obj);\n  };\n\n  _proto.mark = function mark(key) {\n    var skey = removeInvalidChars(key);\n\n    var markTime = now() - this._start;\n\n    var custom = {};\n    custom[skey] = markTime;\n    this.addMarks({\n      custom: custom\n    });\n  };\n\n  _proto.canReuse = function canReuse() {\n    var threshold = this.options.reuseThreshold || REUSABILITY_THRESHOLD;\n    return !!this.options.canReuse && !this.ended && now() - this._start < threshold;\n  };\n\n  _proto.redefine = function redefine(name, type, options) {\n    if (name) {\n      this.name = name;\n    }\n\n    if (type) {\n      this.type = type;\n    }\n\n    if (options) {\n      extend(this.options, options);\n    }\n  };\n\n  _proto.startSpan = function startSpan(name, type, options) {\n    var _this2 = this;\n\n    if (this.ended) {\n      return;\n    }\n\n    var opts = extend({}, options);\n\n    opts.onEnd = function (trc) {\n      _this2._onSpanEnd(trc);\n    };\n\n    opts.traceId = this.traceId;\n    opts.sampled = this.sampled;\n    opts.sampleRate = this.sampleRate;\n\n    if (!opts.parentId) {\n      opts.parentId = this.id;\n    }\n\n    var span = new Span(name, type, opts);\n    this._activeSpans[span.id] = span;\n\n    if (opts.blocking) {\n      this.addTask(span.id);\n    }\n\n    return span;\n  };\n\n  _proto.isFinished = function isFinished() {\n    return !this.blocked && this._activeTasks.size === 0;\n  };\n\n  _proto.detectFinish = function detectFinish() {\n    if (this.isFinished()) this.end();\n  };\n\n  _proto.end = function end(endTime) {\n    if (this.ended) {\n      return;\n    }\n\n    this.ended = true;\n    this._end = getTime(endTime);\n\n    for (var sid in this._activeSpans) {\n      var span = this._activeSpans[sid];\n      span.type = span.type + TRUNCATED_TYPE;\n      span.end(endTime);\n    }\n\n    this.callOnEnd();\n  };\n\n  _proto.captureBreakdown = function captureBreakdown() {\n    this.breakdownTimings = _captureBreakdown(this);\n  };\n\n  _proto.block = function block(flag) {\n    this.blocked = flag;\n\n    if (!this.blocked) {\n      this.detectFinish();\n    }\n  };\n\n  _proto.addTask = function addTask(taskId) {\n    if (!taskId) {\n      taskId = 'task-' + generateRandomId(16);\n    }\n\n    this._activeTasks.add(taskId);\n\n    return taskId;\n  };\n\n  _proto.removeTask = function removeTask(taskId) {\n    var deleted = this._activeTasks.delete(taskId);\n\n    deleted && this.detectFinish();\n  };\n\n  _proto.resetFields = function resetFields() {\n    this.spans = [];\n    this.sampleRate = 0;\n  };\n\n  _proto._onSpanEnd = function _onSpanEnd(span) {\n    this.spans.push(span);\n    delete this._activeSpans[span.id];\n    this.removeTask(span.id);\n  };\n\n  _proto.isManaged = function isManaged() {\n    return !!this.options.managed;\n  };\n\n  return Transaction;\n}(SpanBase);\n\nexport default Transaction;","import { LONG_TASK, LARGEST_CONTENTFUL_PAINT, FIRST_CONTENTFUL_PAINT, FIRST_INPUT, LAYOUT_SHIFT } from '../common/constants';\nimport { noop, PERF } from '../common/utils';\nimport Span from './span';\nexport var metrics = {\n  fid: 0,\n  fcp: 0,\n  tbt: {\n    start: Infinity,\n    duration: 0\n  },\n  cls: 0,\n  longtask: {\n    count: 0,\n    duration: 0,\n    max: 0\n  }\n};\nvar LONG_TASK_THRESHOLD = 50;\nexport function createLongTaskSpans(longtasks, agg) {\n  var spans = [];\n\n  for (var i = 0; i < longtasks.length; i++) {\n    var _longtasks$i = longtasks[i],\n        name = _longtasks$i.name,\n        startTime = _longtasks$i.startTime,\n        duration = _longtasks$i.duration,\n        attribution = _longtasks$i.attribution;\n    var end = startTime + duration;\n    var span = new Span(\"Longtask(\" + name + \")\", LONG_TASK, {\n      startTime: startTime\n    });\n    agg.count++;\n    agg.duration += duration;\n    agg.max = Math.max(duration, agg.max);\n\n    if (attribution.length > 0) {\n      var _attribution$ = attribution[0],\n          _name = _attribution$.name,\n          containerType = _attribution$.containerType,\n          containerName = _attribution$.containerName,\n          containerId = _attribution$.containerId;\n      var customContext = {\n        attribution: _name,\n        type: containerType\n      };\n\n      if (containerName) {\n        customContext.name = containerName;\n      }\n\n      if (containerId) {\n        customContext.id = containerId;\n      }\n\n      span.addContext({\n        custom: customContext\n      });\n    }\n\n    span.end(end);\n    spans.push(span);\n  }\n\n  return spans;\n}\nexport function createFirstInputDelaySpan(fidEntries) {\n  var firstInput = fidEntries[0];\n\n  if (firstInput) {\n    var startTime = firstInput.startTime,\n        processingStart = firstInput.processingStart;\n    var span = new Span('First Input Delay', FIRST_INPUT, {\n      startTime: startTime\n    });\n    span.end(processingStart);\n    return span;\n  }\n}\nexport function createTotalBlockingTimeSpan(tbtObject) {\n  var start = tbtObject.start,\n      duration = tbtObject.duration;\n  var tbtSpan = new Span('Total Blocking Time', LONG_TASK, {\n    startTime: start\n  });\n  tbtSpan.end(start + duration);\n  return tbtSpan;\n}\nexport function calculateTotalBlockingTime(longtaskEntries) {\n  longtaskEntries.forEach(function (entry) {\n    var name = entry.name,\n        startTime = entry.startTime,\n        duration = entry.duration;\n\n    if (startTime < metrics.fcp) {\n      return;\n    }\n\n    if (name !== 'self' && name.indexOf('same-origin') === -1) {\n      return;\n    }\n\n    metrics.tbt.start = Math.min(metrics.tbt.start, startTime);\n    var blockingTime = duration - LONG_TASK_THRESHOLD;\n\n    if (blockingTime > 0) {\n      metrics.tbt.duration += blockingTime;\n    }\n  });\n}\nexport function calculateCumulativeLayoutShift(clsEntries) {\n  clsEntries.forEach(function (entry) {\n    if (!entry.hadRecentInput && entry.value) {\n      metrics.cls += entry.value;\n    }\n  });\n}\nexport function captureObserverEntries(list, _ref) {\n  var isHardNavigation = _ref.isHardNavigation,\n      trStart = _ref.trStart;\n  var longtaskEntries = list.getEntriesByType(LONG_TASK).filter(function (entry) {\n    return entry.startTime >= trStart;\n  });\n  var longTaskSpans = createLongTaskSpans(longtaskEntries, metrics.longtask);\n  var result = {\n    spans: longTaskSpans,\n    marks: {}\n  };\n\n  if (!isHardNavigation) {\n    return result;\n  }\n\n  var lcpEntries = list.getEntriesByType(LARGEST_CONTENTFUL_PAINT);\n  var lastLcpEntry = lcpEntries[lcpEntries.length - 1];\n\n  if (lastLcpEntry) {\n    var lcp = parseInt(lastLcpEntry.startTime);\n    metrics.lcp = lcp;\n    result.marks.largestContentfulPaint = lcp;\n  }\n\n  var timing = PERF.timing;\n  var unloadDiff = timing.fetchStart - timing.navigationStart;\n  var fcpEntry = list.getEntriesByName(FIRST_CONTENTFUL_PAINT)[0];\n\n  if (fcpEntry) {\n    var fcp = parseInt(unloadDiff >= 0 ? fcpEntry.startTime - unloadDiff : fcpEntry.startTime);\n    metrics.fcp = fcp;\n    result.marks.firstContentfulPaint = fcp;\n  }\n\n  var fidEntries = list.getEntriesByType(FIRST_INPUT);\n  var fidSpan = createFirstInputDelaySpan(fidEntries);\n\n  if (fidSpan) {\n    metrics.fid = fidSpan.duration();\n    result.spans.push(fidSpan);\n  }\n\n  calculateTotalBlockingTime(longtaskEntries);\n  var clsEntries = list.getEntriesByType(LAYOUT_SHIFT);\n  calculateCumulativeLayoutShift(clsEntries);\n  return result;\n}\nexport var PerfEntryRecorder = function () {\n  function PerfEntryRecorder(callback) {\n    this.po = {\n      observe: noop,\n      disconnect: noop\n    };\n\n    if (window.PerformanceObserver) {\n      this.po = new PerformanceObserver(callback);\n    }\n  }\n\n  var _proto = PerfEntryRecorder.prototype;\n\n  _proto.start = function start(type) {\n    try {\n      this.po.observe({\n        type: type,\n        buffered: true\n      });\n    } catch (_) {}\n  };\n\n  _proto.stop = function stop() {\n    this.po.disconnect();\n  };\n\n  return PerfEntryRecorder;\n}();","import { Promise } from '../common/polyfills';\nimport Transaction from './transaction';\nimport { PerfEntryRecorder, captureObserverEntries, metrics, createTotalBlockingTimeSpan } from './metrics';\nimport { extend, getEarliestSpan, getLatestNonXHRSpan, isPerfTypeSupported, generateRandomId } from '../common/utils';\nimport { captureNavigation } from './capture-navigation';\nimport { PAGE_LOAD, NAME_UNKNOWN, TRANSACTION_START, TRANSACTION_END, TEMPORARY_TYPE, TRANSACTION_TYPE_ORDER, LARGEST_CONTENTFUL_PAINT, LONG_TASK, PAINT, TRUNCATED_TYPE, FIRST_INPUT, LAYOUT_SHIFT, SESSION_TIMEOUT } from '../common/constants';\nimport { addTransactionContext } from '../common/context';\nimport { __DEV__, state } from '../state';\nimport { slugifyUrl } from '../common/url';\n\nvar TransactionService = function () {\n  function TransactionService(logger, config) {\n    var _this = this;\n\n    this._config = config;\n    this._logger = logger;\n    this.currentTransaction = undefined;\n    this.respIntervalId = undefined;\n    this.recorder = new PerfEntryRecorder(function (list) {\n      var tr = _this.getCurrentTransaction();\n\n      if (tr && tr.captureTimings) {\n        var _tr$spans;\n\n        var isHardNavigation = tr.type === PAGE_LOAD;\n\n        var _captureObserverEntri = captureObserverEntries(list, {\n          isHardNavigation: isHardNavigation,\n          trStart: isHardNavigation ? 0 : tr._start\n        }),\n            spans = _captureObserverEntri.spans,\n            marks = _captureObserverEntri.marks;\n\n        (_tr$spans = tr.spans).push.apply(_tr$spans, spans);\n\n        tr.addMarks({\n          agent: marks\n        });\n      }\n    });\n  }\n\n  var _proto = TransactionService.prototype;\n\n  _proto.createCurrentTransaction = function createCurrentTransaction(name, type, options) {\n    var tr = new Transaction(name, type, options);\n    this.currentTransaction = tr;\n    return tr;\n  };\n\n  _proto.getCurrentTransaction = function getCurrentTransaction() {\n    if (this.currentTransaction && !this.currentTransaction.ended) {\n      return this.currentTransaction;\n    }\n  };\n\n  _proto.createOptions = function createOptions(options) {\n    var config = this._config.config;\n    var presetOptions = {\n      transactionSampleRate: config.transactionSampleRate\n    };\n    var perfOptions = extend(presetOptions, options);\n\n    if (perfOptions.managed) {\n      perfOptions = extend({\n        pageLoadTraceId: config.pageLoadTraceId,\n        pageLoadSampled: config.pageLoadSampled,\n        pageLoadSpanId: config.pageLoadSpanId,\n        pageLoadTransactionName: config.pageLoadTransactionName\n      }, perfOptions);\n    }\n\n    return perfOptions;\n  };\n\n  _proto.startManagedTransaction = function startManagedTransaction(name, type, perfOptions) {\n    var tr = this.getCurrentTransaction();\n    var isRedefined = false;\n\n    if (!tr) {\n      tr = this.createCurrentTransaction(name, type, perfOptions);\n    } else if (tr.canReuse() && perfOptions.canReuse) {\n      var redefineType = tr.type;\n      var currentTypeOrder = TRANSACTION_TYPE_ORDER.indexOf(tr.type);\n      var redefineTypeOrder = TRANSACTION_TYPE_ORDER.indexOf(type);\n\n      if (currentTypeOrder >= 0 && redefineTypeOrder < currentTypeOrder) {\n        redefineType = type;\n      }\n\n      if (__DEV__) {\n        this._logger.debug(\"redefining transaction(\" + tr.id + \", \" + tr.name + \", \" + tr.type + \")\", 'to', \"(\" + (name || tr.name) + \", \" + redefineType + \")\", tr);\n      }\n\n      tr.redefine(name, redefineType, perfOptions);\n      isRedefined = true;\n    } else {\n      if (__DEV__) {\n        this._logger.debug(\"ending previous transaction(\" + tr.id + \", \" + tr.name + \")\", tr);\n      }\n\n      tr.end();\n      tr = this.createCurrentTransaction(name, type, perfOptions);\n    }\n\n    if (tr.type === PAGE_LOAD) {\n      if (!isRedefined) {\n        this.recorder.start(LARGEST_CONTENTFUL_PAINT);\n        this.recorder.start(PAINT);\n        this.recorder.start(FIRST_INPUT);\n        this.recorder.start(LAYOUT_SHIFT);\n      }\n\n      if (perfOptions.pageLoadTraceId) {\n        tr.traceId = perfOptions.pageLoadTraceId;\n      }\n\n      if (perfOptions.pageLoadSampled) {\n        tr.sampled = perfOptions.pageLoadSampled;\n      }\n\n      if (tr.name === NAME_UNKNOWN && perfOptions.pageLoadTransactionName) {\n        tr.name = perfOptions.pageLoadTransactionName;\n      }\n    }\n\n    if (!isRedefined && this._config.get('monitorLongtasks')) {\n      this.recorder.start(LONG_TASK);\n    }\n\n    if (tr.sampled) {\n      tr.captureTimings = true;\n    }\n\n    return tr;\n  };\n\n  _proto.startTransaction = function startTransaction(name, type, options) {\n    var _this2 = this;\n\n    var perfOptions = this.createOptions(options);\n    var tr;\n    var fireOnstartHook = true;\n\n    if (perfOptions.managed) {\n      var current = this.currentTransaction;\n      tr = this.startManagedTransaction(name, type, perfOptions);\n\n      if (current === tr) {\n        fireOnstartHook = false;\n      }\n    } else {\n      tr = new Transaction(name, type, perfOptions);\n    }\n\n    tr.onEnd = function () {\n      return _this2.handleTransactionEnd(tr);\n    };\n\n    if (fireOnstartHook) {\n      if (__DEV__) {\n        this._logger.debug(\"startTransaction(\" + tr.id + \", \" + tr.name + \", \" + tr.type + \")\");\n      }\n\n      this._config.events.send(TRANSACTION_START, [tr]);\n    }\n\n    return tr;\n  };\n\n  _proto.handleTransactionEnd = function handleTransactionEnd(tr) {\n    var _this3 = this;\n\n    this.recorder.stop();\n    var currentUrl = window.location.href;\n    return Promise.resolve().then(function () {\n      var name = tr.name,\n          type = tr.type;\n      var lastHiddenStart = state.lastHiddenStart;\n\n      if (lastHiddenStart >= tr._start) {\n        if (__DEV__) {\n          _this3._logger.debug(\"transaction(\" + tr.id + \", \" + name + \", \" + type + \") was discarded! The page was hidden during the transaction!\");\n        }\n\n        return;\n      }\n\n      if (_this3.shouldIgnoreTransaction(name) || type === TEMPORARY_TYPE) {\n        if (__DEV__) {\n          _this3._logger.debug(\"transaction(\" + tr.id + \", \" + name + \", \" + type + \") is ignored\");\n        }\n\n        return;\n      }\n\n      if (type === PAGE_LOAD) {\n        var pageLoadTransactionName = _this3._config.get('pageLoadTransactionName');\n\n        if (name === NAME_UNKNOWN && pageLoadTransactionName) {\n          tr.name = pageLoadTransactionName;\n        }\n\n        if (tr.captureTimings) {\n          var cls = metrics.cls,\n              fid = metrics.fid,\n              tbt = metrics.tbt,\n              longtask = metrics.longtask;\n\n          if (tbt.duration > 0) {\n            tr.spans.push(createTotalBlockingTimeSpan(tbt));\n          }\n\n          tr.experience = {};\n\n          if (isPerfTypeSupported(LONG_TASK)) {\n            tr.experience.tbt = tbt.duration;\n          }\n\n          if (isPerfTypeSupported(LAYOUT_SHIFT)) {\n            tr.experience.cls = cls;\n          }\n\n          if (fid > 0) {\n            tr.experience.fid = fid;\n          }\n\n          if (longtask.count > 0) {\n            tr.experience.longtask = {\n              count: longtask.count,\n              sum: longtask.duration,\n              max: longtask.max\n            };\n          }\n        }\n\n        _this3.setSession(tr);\n      }\n\n      if (tr.name === NAME_UNKNOWN) {\n        tr.name = slugifyUrl(currentUrl);\n      }\n\n      captureNavigation(tr);\n\n      _this3.adjustTransactionTime(tr);\n\n      var breakdownMetrics = _this3._config.get('breakdownMetrics');\n\n      if (breakdownMetrics) {\n        tr.captureBreakdown();\n      }\n\n      var configContext = _this3._config.get('context');\n\n      addTransactionContext(tr, configContext);\n\n      _this3._config.events.send(TRANSACTION_END, [tr]);\n\n      if (__DEV__) {\n        _this3._logger.debug(\"end transaction(\" + tr.id + \", \" + tr.name + \", \" + tr.type + \")\", tr);\n      }\n    }, function (err) {\n      if (__DEV__) {\n        _this3._logger.debug(\"error ending transaction(\" + tr.id + \", \" + tr.name + \")\", err);\n      }\n    });\n  };\n\n  _proto.setSession = function setSession(tr) {\n    var session = this._config.get('session');\n\n    if (session) {\n      if (typeof session == 'boolean') {\n        tr.session = {\n          id: generateRandomId(16),\n          sequence: 1\n        };\n      } else {\n        if (session.timestamp && Date.now() - session.timestamp > SESSION_TIMEOUT) {\n          tr.session = {\n            id: generateRandomId(16),\n            sequence: 1\n          };\n        } else {\n          tr.session = {\n            id: session.id,\n            sequence: session.sequence ? session.sequence + 1 : 1\n          };\n        }\n      }\n\n      var sessionConfig = {\n        session: {\n          id: tr.session.id,\n          sequence: tr.session.sequence,\n          timestamp: Date.now()\n        }\n      };\n\n      this._config.setConfig(sessionConfig);\n\n      this._config.setLocalConfig(sessionConfig, true);\n    }\n  };\n\n  _proto.adjustTransactionTime = function adjustTransactionTime(transaction) {\n    var spans = transaction.spans;\n    var earliestSpan = getEarliestSpan(spans);\n\n    if (earliestSpan && earliestSpan._start < transaction._start) {\n      transaction._start = earliestSpan._start;\n    }\n\n    var latestSpan = getLatestNonXHRSpan(spans);\n\n    if (latestSpan && latestSpan._end > transaction._end) {\n      transaction._end = latestSpan._end;\n    }\n\n    var transactionEnd = transaction._end;\n\n    for (var i = 0; i < spans.length; i++) {\n      var span = spans[i];\n\n      if (span._end > transactionEnd) {\n        span._end = transactionEnd;\n        span.type += TRUNCATED_TYPE;\n      }\n\n      if (span._start > transactionEnd) {\n        span._start = transactionEnd;\n      }\n    }\n  };\n\n  _proto.shouldIgnoreTransaction = function shouldIgnoreTransaction(transactionName) {\n    var ignoreList = this._config.get('ignoreTransactions');\n\n    if (ignoreList && ignoreList.length) {\n      for (var i = 0; i < ignoreList.length; i++) {\n        var element = ignoreList[i];\n\n        if (typeof element.test === 'function') {\n          if (element.test(transactionName)) {\n            return true;\n          }\n        } else if (element === transactionName) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  };\n\n  _proto.startSpan = function startSpan(name, type, options) {\n    var tr = this.getCurrentTransaction();\n\n    if (!tr) {\n      tr = this.createCurrentTransaction(undefined, TEMPORARY_TYPE, this.createOptions({\n        canReuse: true,\n        managed: true\n      }));\n    }\n\n    var span = tr.startSpan(name, type, options);\n\n    if (__DEV__) {\n      this._logger.debug(\"startSpan(\" + name + \", \" + span.type + \")\", \"on transaction(\" + tr.id + \", \" + tr.name + \")\");\n    }\n\n    return span;\n  };\n\n  _proto.endSpan = function endSpan(span, context) {\n    if (!span) {\n      return;\n    }\n\n    if (__DEV__) {\n      var tr = this.getCurrentTransaction();\n      tr && this._logger.debug(\"endSpan(\" + span.name + \", \" + span.type + \")\", \"on transaction(\" + tr.id + \", \" + tr.name + \")\");\n    }\n\n    span.end(null, context);\n  };\n\n  return TransactionService;\n}();\n\nexport default TransactionService;","import { registerServices as registerErrorServices } from './error-logging';\nimport { registerServices as registerPerfServices } from './performance-monitoring';\nimport { ServiceFactory } from './common/service-factory';\nimport { isPlatformSupported, scheduleMicroTask, scheduleMacroTask, isBrowser } from './common/utils';\nimport { patchAll, patchEventHandler } from './common/patching';\nimport { PAGE_LOAD, ERROR, CONFIG_SERVICE, LOGGING_SERVICE, APM_SERVER } from './common/constants';\nimport { getInstrumentationFlags } from './common/instrument';\nimport afterFrame from './common/after-frame';\nimport { bootstrap } from './bootstrap';\nimport { createTracer } from './opentracing';\n\nfunction createServiceFactory() {\n  registerPerfServices();\n  registerErrorServices();\n  var serviceFactory = new ServiceFactory();\n  return serviceFactory;\n}\n\nexport { createServiceFactory, ServiceFactory, patchAll, patchEventHandler, isPlatformSupported, isBrowser, getInstrumentationFlags, createTracer, scheduleMicroTask, scheduleMacroTask, afterFrame, ERROR, PAGE_LOAD, CONFIG_SERVICE, LOGGING_SERVICE, APM_SERVER, bootstrap };","import PerformanceMonitoring from './performance-monitoring';\nimport TransactionService from './transaction-service';\nimport { APM_SERVER, CONFIG_SERVICE, LOGGING_SERVICE } from '../common/constants';\nimport { serviceCreators } from '../common/service-factory';\n\nfunction registerServices() {\n  serviceCreators['TransactionService'] = function (serviceFactory) {\n    var _serviceFactory$getSe = serviceFactory.getService([LOGGING_SERVICE, CONFIG_SERVICE]),\n        loggingService = _serviceFactory$getSe[0],\n        configService = _serviceFactory$getSe[1];\n\n    return new TransactionService(loggingService, configService);\n  };\n\n  serviceCreators['PerformanceMonitoring'] = function (serviceFactory) {\n    var _serviceFactory$getSe2 = serviceFactory.getService([APM_SERVER, CONFIG_SERVICE, LOGGING_SERVICE, 'TransactionService']),\n        apmServer = _serviceFactory$getSe2[0],\n        configService = _serviceFactory$getSe2[1],\n        loggingService = _serviceFactory$getSe2[2],\n        transactionService = _serviceFactory$getSe2[3];\n\n    return new PerformanceMonitoring(apmServer, configService, loggingService, transactionService);\n  };\n}\n\nexport { registerServices };","import ErrorLogging from './error-logging';\nimport { CONFIG_SERVICE, APM_SERVER } from '../common/constants';\nimport { serviceCreators } from '../common/service-factory';\n\nfunction registerServices() {\n  serviceCreators['ErrorLogging'] = function (serviceFactory) {\n    var _serviceFactory$getSe = serviceFactory.getService([APM_SERVER, CONFIG_SERVICE, 'TransactionService']),\n        apmServer = _serviceFactory$getSe[0],\n        configService = _serviceFactory$getSe[1],\n        transactionService = _serviceFactory$getSe[2];\n\n    return new ErrorLogging(apmServer, configService, transactionService);\n  };\n}\n\nexport { registerServices };","import { isPlatformSupported, isBrowser, now } from './common/utils';\nimport { patchAll } from './common/patching';\nimport { state } from './state';\nvar enabled = false;\nexport function bootstrap() {\n  if (isPlatformSupported()) {\n    patchAll();\n    bootstrapPerf();\n    state.bootstrapTime = now();\n    enabled = true;\n  } else if (isBrowser) {\n    console.log('[Elastic APM] platform is not supported!');\n  }\n\n  return enabled;\n}\nexport function bootstrapPerf() {\n  if (document.visibilityState === 'hidden') {\n    state.lastHiddenStart = 0;\n  }\n\n  window.addEventListener('visibilitychange', function () {\n    if (document.visibilityState === 'hidden') {\n      state.lastHiddenStart = performance.now();\n    }\n  }, {\n    capture: true\n  });\n}","/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\n\nimport {\n  getInstrumentationFlags,\n  PAGE_LOAD,\n  ERROR,\n  CONFIG_SERVICE,\n  LOGGING_SERVICE,\n  APM_SERVER\n} from '@elastic/apm-rum-core'\n\nexport default class ApmBase {\n  constructor(serviceFactory, disable) {\n    this._disable = disable\n    this.serviceFactory = serviceFactory\n    this._initialized = false\n  }\n\n  isEnabled() {\n    return !this._disable\n  }\n\n  isActive() {\n    const configService = this.serviceFactory.getService(CONFIG_SERVICE)\n    return this.isEnabled() && this._initialized && configService.get('active')\n  }\n\n  init(config) {\n    if (this.isEnabled() && !this._initialized) {\n      this._initialized = true\n      const [configService, loggingService] = this.serviceFactory.getService([\n        CONFIG_SERVICE,\n        LOGGING_SERVICE\n      ])\n      /**\n       * Set Agent version to be sent as part of metadata to the APM Server\n       */\n      configService.setVersion('5.9.1')\n      this.config(config)\n      /**\n       * Set level here to account for both active and inactive cases\n       */\n      const logLevel = configService.get('logLevel')\n      loggingService.setLevel(logLevel)\n      /**\n       * Deactive agent when the active config flag is set to false\n       */\n      const isConfigActive = configService.get('active')\n      if (isConfigActive) {\n        this.serviceFactory.init()\n\n        const flags = getInstrumentationFlags(\n          configService.get('instrument'),\n          configService.get('disableInstrumentations')\n        )\n\n        const performanceMonitoring = this.serviceFactory.getService(\n          'PerformanceMonitoring'\n        )\n        performanceMonitoring.init(flags)\n\n        if (flags[ERROR]) {\n          const errorLogging = this.serviceFactory.getService('ErrorLogging')\n          errorLogging.registerListeners()\n        }\n\n        if (configService.get('session')) {\n          let localConfig = configService.getLocalConfig()\n          if (localConfig && localConfig.session) {\n            configService.setConfig({\n              session: localConfig.session\n            })\n          }\n        }\n\n        const sendPageLoad = () =>\n          flags[PAGE_LOAD] && this._sendPageLoadMetrics()\n\n        if (configService.get('centralConfig')) {\n          /**\n           * Waiting for the remote config before sending the page load transaction\n           */\n          this.fetchCentralConfig().then(sendPageLoad)\n        } else {\n          sendPageLoad()\n        }\n      } else {\n        this._disable = true\n        loggingService.warn('RUM agent is inactive')\n      }\n    }\n    return this\n  }\n\n  /**\n   * `fetchCentralConfig` returns a promise that will always resolve\n   * if the internal config fetch fails the the promise resolves to `undefined` otherwise\n   * it resolves to the fetched config.\n   */\n  fetchCentralConfig() {\n    const [\n      apmServer,\n      loggingService,\n      configService\n    ] = this.serviceFactory.getService([\n      APM_SERVER,\n      LOGGING_SERVICE,\n      CONFIG_SERVICE\n    ])\n\n    return apmServer\n      .fetchConfig(\n        configService.get('serviceName'),\n        configService.get('environment')\n      )\n      .then(config => {\n        var transactionSampleRate = config['transaction_sample_rate']\n        if (transactionSampleRate) {\n          transactionSampleRate = Number(transactionSampleRate)\n          const config = { transactionSampleRate }\n          const { invalid } = configService.validate(config)\n          if (invalid.length === 0) {\n            configService.setConfig(config)\n          } else {\n            const { key, value, allowed } = invalid[0]\n            loggingService.warn(\n              `invalid value \"${value}\" for ${key}. Allowed: ${allowed}.`\n            )\n          }\n        }\n        return config\n      })\n      .catch(error => {\n        loggingService.warn('failed fetching config:', error)\n      })\n  }\n\n  _sendPageLoadMetrics() {\n    /**\n     * Name of the transaction is set in transaction service to\n     * avoid duplicating the logic at multiple places\n     */\n    const tr = this.startTransaction(undefined, PAGE_LOAD, {\n      managed: true,\n      canReuse: true\n    })\n\n    if (!tr) {\n      return\n    }\n\n    tr.addTask(PAGE_LOAD)\n    const sendPageLoadMetrics = () => {\n      // to make sure PerformanceTiming.loadEventEnd has a value\n      setTimeout(() => tr.removeTask(PAGE_LOAD))\n    }\n\n    if (document.readyState === 'complete') {\n      sendPageLoadMetrics()\n    } else {\n      window.addEventListener('load', sendPageLoadMetrics)\n    }\n  }\n\n  observe(name, fn) {\n    const configService = this.serviceFactory.getService(CONFIG_SERVICE)\n    configService.events.observe(name, fn)\n  }\n\n  /**\n   * When the required config keys are invalid, the agent is deactivated with\n   * logging error to the console\n   *\n   * validation error format\n   * {\n   *  missing: [ 'key1', 'key2']\n   *  invalid: [{\n   *    key: 'a',\n   *    value: 'abcd',\n   *    allowed: 'string'\n   *  }]\n   * }\n   */\n  config(config) {\n    const configService = this.serviceFactory.getService(CONFIG_SERVICE)\n    const { missing, invalid } = configService.validate(config)\n    if (missing.length === 0 && invalid.length === 0) {\n      configService.setConfig(config)\n    } else {\n      const loggingService = this.serviceFactory.getService(LOGGING_SERVICE)\n      const separator = ', '\n      let message = \"RUM agent isn't correctly configured. \"\n\n      if (missing.length > 0) {\n        message += missing.join(separator) + ' is missing'\n        if (invalid.length > 0) {\n          message += separator\n        }\n      }\n\n      invalid.forEach(({ key, value, allowed }, index) => {\n        message +=\n          `${key} \"${value}\" contains invalid characters! (allowed: ${allowed})` +\n          (index !== invalid.length - 1 ? separator : '')\n      })\n      loggingService.error(message)\n      configService.setConfig({ active: false })\n    }\n  }\n\n  setUserContext(userContext) {\n    var configService = this.serviceFactory.getService(CONFIG_SERVICE)\n    configService.setUserContext(userContext)\n  }\n\n  setCustomContext(customContext) {\n    var configService = this.serviceFactory.getService(CONFIG_SERVICE)\n    configService.setCustomContext(customContext)\n  }\n\n  addLabels(labels) {\n    var configService = this.serviceFactory.getService(CONFIG_SERVICE)\n    configService.addLabels(labels)\n  }\n\n  // Should call this method before 'load' event on window is fired\n  setInitialPageLoadName(name) {\n    const configService = this.serviceFactory.getService(CONFIG_SERVICE)\n    configService.setConfig({\n      pageLoadTransactionName: name\n    })\n  }\n\n  startTransaction(name, type, options) {\n    if (this.isEnabled()) {\n      var transactionService = this.serviceFactory.getService(\n        'TransactionService'\n      )\n      return transactionService.startTransaction(name, type, options)\n    }\n  }\n\n  startSpan(name, type, options) {\n    if (this.isEnabled()) {\n      var transactionService = this.serviceFactory.getService(\n        'TransactionService'\n      )\n      return transactionService.startSpan(name, type, options)\n    }\n  }\n\n  getCurrentTransaction() {\n    if (this.isEnabled()) {\n      var transactionService = this.serviceFactory.getService(\n        'TransactionService'\n      )\n      return transactionService.getCurrentTransaction()\n    }\n  }\n\n  captureError(error) {\n    if (this.isEnabled()) {\n      var errorLogging = this.serviceFactory.getService('ErrorLogging')\n      return errorLogging.logError(error)\n    }\n  }\n\n  addFilter(fn) {\n    var configService = this.serviceFactory.getService(CONFIG_SERVICE)\n    configService.addFilter(fn)\n  }\n}\n","import { XMLHTTPREQUEST, FETCH, HISTORY, PAGE_LOAD, ERROR, EVENT_TARGET } from './constants';\nexport function getInstrumentationFlags(instrument, disabledInstrumentations) {\n  var _flags;\n\n  var flags = (_flags = {}, _flags[XMLHTTPREQUEST] = false, _flags[FETCH] = false, _flags[HISTORY] = false, _flags[PAGE_LOAD] = false, _flags[ERROR] = false, _flags[EVENT_TARGET] = false, _flags);\n\n  if (!instrument) {\n    return flags;\n  }\n\n  Object.keys(flags).forEach(function (key) {\n    if (disabledInstrumentations.indexOf(key) === -1) {\n      flags[key] = true;\n    }\n  });\n  return flags;\n}","/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\n\nimport {\n  createServiceFactory,\n  bootstrap,\n  isBrowser\n} from '@elastic/apm-rum-core'\nimport ApmBase from './apm-base'\n\n/**\n * Use a single instance of ApmBase across all instance of the agent\n * including the instanes used in framework specific integrations\n */\nfunction getApmBase() {\n  if (isBrowser && window.elasticApm) {\n    return window.elasticApm\n  }\n  const enabled = bootstrap()\n  const serviceFactory = createServiceFactory()\n  const apmBase = new ApmBase(serviceFactory, !enabled)\n\n  if (isBrowser) {\n    window.elasticApm = apmBase\n  }\n\n  return apmBase\n}\n\nconst apmBase = getApmBase()\n\nconst init = apmBase.init.bind(apmBase)\n\nexport default init\nexport { init, apmBase, ApmBase, apmBase as apm }\n","function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nimport { Span as otSpan } from 'opentracing/lib/span';\nimport { extend, getTimeOrigin } from '../common/utils';\nimport Transaction from '../performance-monitoring/transaction';\n\nvar Span = function (_otSpan) {\n  _inheritsLoose(Span, _otSpan);\n\n  function Span(tracer, span) {\n    var _this;\n\n    _this = _otSpan.call(this) || this;\n    _this.__tracer = tracer;\n    _this.span = span;\n    _this.isTransaction = span instanceof Transaction;\n    _this.spanContext = {\n      id: span.id,\n      traceId: span.traceId,\n      sampled: span.sampled\n    };\n    return _this;\n  }\n\n  var _proto = Span.prototype;\n\n  _proto._context = function _context() {\n    return this.spanContext;\n  };\n\n  _proto._tracer = function _tracer() {\n    return this.__tracer;\n  };\n\n  _proto._setOperationName = function _setOperationName(name) {\n    this.span.name = name;\n  };\n\n  _proto._addTags = function _addTags(keyValuePairs) {\n    var tags = extend({}, keyValuePairs);\n\n    if (tags.type) {\n      this.span.type = tags.type;\n      delete tags.type;\n    }\n\n    if (this.isTransaction) {\n      var userId = tags['user.id'];\n      var username = tags['user.username'];\n      var email = tags['user.email'];\n\n      if (userId || username || email) {\n        this.span.addContext({\n          user: {\n            id: userId,\n            username: username,\n            email: email\n          }\n        });\n        delete tags['user.id'];\n        delete tags['user.username'];\n        delete tags['user.email'];\n      }\n    }\n\n    this.span.addLabels(tags);\n  };\n\n  _proto._log = function _log(log, timestamp) {\n    if (log.event === 'error') {\n      if (log['error.object']) {\n        this.__tracer.errorLogging.logError(log['error.object']);\n      } else if (log.message) {\n        this.__tracer.errorLogging.logError(log.message);\n      }\n    }\n  };\n\n  _proto._finish = function _finish(finishTime) {\n    this.span.end();\n\n    if (finishTime) {\n      this.span._end = finishTime - getTimeOrigin();\n    }\n  };\n\n  return Span;\n}(otSpan);\n\nexport default Span;","function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nimport { Tracer as otTracer } from 'opentracing/lib/tracer';\nimport { REFERENCE_CHILD_OF, FORMAT_TEXT_MAP, FORMAT_HTTP_HEADERS, FORMAT_BINARY } from 'opentracing/lib/constants';\nimport { Span as NoopSpan } from 'opentracing/lib/span';\nimport { getTimeOrigin, find } from '../common/utils';\nimport { __DEV__ } from '../state';\nimport Span from './span';\n\nvar Tracer = function (_otTracer) {\n  _inheritsLoose(Tracer, _otTracer);\n\n  function Tracer(performanceMonitoring, transactionService, loggingService, errorLogging) {\n    var _this;\n\n    _this = _otTracer.call(this) || this;\n    _this.performanceMonitoring = performanceMonitoring;\n    _this.transactionService = transactionService;\n    _this.loggingService = loggingService;\n    _this.errorLogging = errorLogging;\n    return _this;\n  }\n\n  var _proto = Tracer.prototype;\n\n  _proto._startSpan = function _startSpan(name, options) {\n    var spanOptions = {\n      managed: true\n    };\n\n    if (options) {\n      spanOptions.timestamp = options.startTime;\n\n      if (options.childOf) {\n        spanOptions.parentId = options.childOf.id;\n      } else if (options.references && options.references.length > 0) {\n        if (options.references.length > 1) {\n          if (__DEV__) {\n            this.loggingService.debug('Elastic APM OpenTracing: Unsupported number of references, only the first childOf reference will be recorded.');\n          }\n        }\n\n        var childRef = find(options.references, function (ref) {\n          return ref.type() === REFERENCE_CHILD_OF;\n        });\n\n        if (childRef) {\n          spanOptions.parentId = childRef.referencedContext().id;\n        }\n      }\n    }\n\n    var span;\n    var currentTransaction = this.transactionService.getCurrentTransaction();\n\n    if (currentTransaction) {\n      span = this.transactionService.startSpan(name, undefined, spanOptions);\n    } else {\n      span = this.transactionService.startTransaction(name, undefined, spanOptions);\n    }\n\n    if (!span) {\n      return new NoopSpan();\n    }\n\n    if (spanOptions.timestamp) {\n      span._start = spanOptions.timestamp - getTimeOrigin();\n    }\n\n    var otSpan = new Span(this, span);\n\n    if (options && options.tags) {\n      otSpan.addTags(options.tags);\n    }\n\n    return otSpan;\n  };\n\n  _proto._inject = function _inject(spanContext, format, carrier) {\n    switch (format) {\n      case FORMAT_TEXT_MAP:\n      case FORMAT_HTTP_HEADERS:\n        this.performanceMonitoring.injectDtHeader(spanContext, carrier);\n        break;\n\n      case FORMAT_BINARY:\n        if (__DEV__) {\n          this.loggingService.debug('Elastic APM OpenTracing: binary carrier format is not supported.');\n        }\n\n        break;\n    }\n  };\n\n  _proto._extract = function _extract(format, carrier) {\n    var ctx;\n\n    switch (format) {\n      case FORMAT_TEXT_MAP:\n      case FORMAT_HTTP_HEADERS:\n        ctx = this.performanceMonitoring.extractDtHeader(carrier);\n        break;\n\n      case FORMAT_BINARY:\n        if (__DEV__) {\n          this.loggingService.debug('Elastic APM OpenTracing: binary carrier format is not supported.');\n        }\n\n        break;\n    }\n\n    if (!ctx) {\n      ctx = null;\n    }\n\n    return ctx;\n  };\n\n  return Tracer;\n}(otTracer);\n\nexport default Tracer;","/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\n\nimport { init, apm, apmBase, ApmBase } from './index'\nimport { Tracer } from 'opentracing/lib/tracer'\nimport { createTracer as createElasticTracer } from '@elastic/apm-rum-core'\n\nfunction createTracer(apmBase) {\n  /**\n   * If the platform is not supported, return\n   * the default tracer from OT\n   */\n  if (apmBase._disable) {\n    return new Tracer()\n  }\n  return createElasticTracer(apmBase.serviceFactory)\n}\n\nif (typeof window !== 'undefined' && window.elasticApm) {\n  window.elasticApm.createTracer = createTracer.bind(\n    window.elasticApm,\n    window.elasticApm\n  )\n}\n\nexport default createTracer\nexport { createTracer, init, apm, apmBase, ApmBase }\n","import Tracer from './tracer';\nimport Span from './span';\n\nfunction createTracer(serviceFactory) {\n  var performanceMonitoring = serviceFactory.getService('PerformanceMonitoring');\n  var transactionService = serviceFactory.getService('TransactionService');\n  var errorLogging = serviceFactory.getService('ErrorLogging');\n  var loggingService = serviceFactory.getService('LoggingService');\n  return new Tracer(performanceMonitoring, transactionService, loggingService, errorLogging);\n}\n\nexport { Span, Tracer, createTracer };"],"sourceRoot":""}