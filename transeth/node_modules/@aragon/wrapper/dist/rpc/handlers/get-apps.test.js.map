{"version":3,"sources":["../../../src/rpc/handlers/get-apps.test.js"],"names":["test","afterEach","always","sinon","restore","t","plan","initialApps","appId","kernelAddress","contractAddress","abi","roles","isForwarder","name","proxyAddress","icons","src","appsMock","BehaviorSubject","identifiersMock","result","params","apm","getContentPath","content","path","apps","appIdentifiers","expectedInitialApps","appAddress","appImplementationAddress","identifier","expectedEndApps","concat","emitIndex","subscribe","value","deepEqual","fail","endApps","next","icon","expectedApps","currentAppAddress","initialApp","address","endApp"],"mappings":"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","sourcesContent":["import test from 'ava'\nimport sinon from 'sinon'\nimport { of, BehaviorSubject } from 'rxjs'\n\nimport getApps from './get-apps'\n\ntest.afterEach.always(() => {\n  sinon.restore()\n})\n\ntest('should return a subscription for the entire app list if observing all', async (t) => {\n  t.plan(2)\n\n  // arrange\n  const initialApps = [{\n    appId: 'coolApp',\n    kernelAddress: '0x123',\n    contractAddress: '0xcoolApp',\n    abi: 'abi for coolApp',\n    roles: 'roles for coolApp',\n    isForwarder: false,\n    name: 'Cool App',\n    proxyAddress: '0x456',\n    icons: [{ src: 'icon_link' }]\n  }]\n  const appsMock = new BehaviorSubject(initialApps)\n  const identifiersMock = of({\n    '0x456': 'cool identifier',\n    '0x789': 'voting identifier'\n  })\n\n  const requestStub = {\n    params: ['observe', 'all']\n  }\n  const proxyStub = {}\n  const wrapperStub = {\n    apm: {\n      getContentPath: (content, path) => `url/${path}`\n    },\n    apps: appsMock,\n    appIdentifiers: identifiersMock\n  }\n\n  // act\n  const result = await getApps(requestStub, proxyStub, wrapperStub)\n\n  // assert\n  const expectedInitialApps = [{\n    abi: 'abi for coolApp',\n    appAddress: '0x456',\n    appId: 'coolApp',\n    appImplementationAddress: '0xcoolApp',\n    identifier: 'cool identifier',\n    isForwarder: false,\n    kernelAddress: '0x123',\n    name: 'Cool App',\n    icons: [{ src: 'url/icon_link' }],\n    roles: 'roles for coolApp'\n  }]\n  const expectedEndApps = [].concat(expectedInitialApps, {\n    abi: 'abi for votingApp',\n    appAddress: '0x789',\n    appId: 'votingApp',\n    appImplementationAddress: '0xvotingApp',\n    identifier: 'voting identifier',\n    isForwarder: true,\n    kernelAddress: '0x123',\n    name: 'Voting App',\n    icons: [{ src: 'url/icon_link' }],\n    roles: 'roles for votingApp'\n  })\n  let emitIndex = 0\n  result.subscribe(value => {\n    if (emitIndex === 0) {\n      t.deepEqual(value, expectedInitialApps)\n    } else if (emitIndex === 1) {\n      t.deepEqual(value, expectedEndApps)\n    } else {\n      t.fail('too many emissions')\n    }\n\n    emitIndex++\n  })\n\n  // We need apps' second emission to fire after the identifiers have emitted,\n  // so that the combineLatest doesn't skip the initial value\n  const endApps = [].concat(initialApps, {\n    appId: 'votingApp',\n    kernelAddress: '0x123',\n    contractAddress: '0xvotingApp',\n    abi: 'abi for votingApp',\n    roles: 'roles for votingApp',\n    isForwarder: true,\n    name: 'Voting App',\n    proxyAddress: '0x789',\n    icons: [{ src: 'icon_link' }]\n  })\n  appsMock.next(endApps)\n})\n\n// Test backwards compatibility with initial RPC API (no parameters passed)\ntest('should return a subscription for the entire unmodified app list via initial RPC API', async (t) => {\n  t.plan(2)\n\n  // arrange\n  const initialApps = [{\n    appId: 'coolApp',\n    kernelAddress: '0x123',\n    contractAddress: '0xcoolApp',\n    abi: 'abi for coolApp',\n    roles: 'roles for coolApp',\n    isForwarder: false,\n    name: 'Cool App',\n    icon: 'icon link',\n    proxyAddress: '0x456'\n  }]\n  const endApps = [].concat(initialApps, {\n    appId: 'votingApp',\n    kernelAddress: '0x123',\n    contractAddress: '0xvotingApp',\n    abi: 'abi for votingApp',\n    roles: 'roles for votingApp',\n    isForwarder: true,\n    name: 'Voting App',\n    icon: 'icon link',\n    proxyAddress: '0x789'\n  })\n  const appsMock = of(initialApps, endApps)\n\n  const requestStub = {\n    params: []\n  }\n  const proxyStub = {}\n  const wrapperStub = {\n    apps: appsMock\n  }\n\n  // act\n  const result = await getApps(requestStub, proxyStub, wrapperStub)\n  // assert\n  let emitIndex = 0\n  result.subscribe(value => {\n    if (emitIndex === 0) {\n      t.deepEqual(value, initialApps)\n    } else if (emitIndex === 1) {\n      t.deepEqual(value, endApps)\n    } else {\n      t.fail('too many emissions')\n    }\n\n    emitIndex++\n  })\n})\n\ntest('should return the initial value for the entire app list if getting all', async (t) => {\n  t.plan(1)\n\n  // arrange\n  const initialApps = [{\n    appId: 'coolApp',\n    kernelAddress: '0x123',\n    contractAddress: '0xcoolApp',\n    abi: 'abi for coolApp',\n    roles: 'roles for coolApp',\n    isForwarder: false,\n    name: 'Cool App',\n    proxyAddress: '0x456',\n    icons: [{ src: 'icon_link' }]\n  }]\n  const appsMock = new BehaviorSubject(initialApps)\n  const identifiersMock = of({\n    '0x456': 'cool identifier',\n    '0x789': 'voting identifier'\n  })\n\n  const requestStub = {\n    params: ['get', 'all']\n  }\n  const proxyStub = {}\n  const wrapperStub = {\n    apm: {\n      getContentPath: (content, path) => `url/${path}`\n    },\n    apps: appsMock,\n    appIdentifiers: identifiersMock\n  }\n\n  // act\n  const result = await getApps(requestStub, proxyStub, wrapperStub)\n\n  // assert\n  const expectedApps = [{\n    abi: 'abi for coolApp',\n    appAddress: '0x456',\n    appId: 'coolApp',\n    appImplementationAddress: '0xcoolApp',\n    identifier: 'cool identifier',\n    isForwarder: false,\n    kernelAddress: '0x123',\n    name: 'Cool App',\n    icons: [{ src: 'url/icon_link' }],\n    roles: 'roles for coolApp'\n  }]\n  let emitIndex = 0\n  result.subscribe(value => {\n    if (emitIndex === 0) {\n      t.deepEqual(value, expectedApps)\n    } else {\n      t.fail('too many emissions')\n    }\n\n    emitIndex++\n  })\n\n  // Even though this is filtered out, we need apps' second emission to fire after the identifiers\n  // have emitted, so that the combineLatest doesn't skip the initial value\n  const endApps = [].concat(initialApps, {\n    appId: 'votingApp',\n    kernelAddress: '0x123',\n    contractAddress: '0xvotingApp',\n    abi: 'abi for votingApp',\n    roles: 'roles for votingApp',\n    isForwarder: true,\n    name: 'Voting App',\n    proxyAddress: '0x789',\n    icons: [{ src: 'icon_link' }]\n  })\n  appsMock.next(endApps)\n})\n\ntest('should return a subscription for just the current app if observing current', async (t) => {\n  t.plan(2)\n\n  // arrange\n  const currentAppAddress = '0x456'\n  const initialApp = {\n    appId: 'coolApp',\n    contractAddress: '0xcoolApp',\n    kernelAddress: '0x123',\n    abi: 'abi for coolApp',\n    roles: 'roles for coolApp',\n    isForwarder: false,\n    name: 'Cool App',\n    proxyAddress: currentAppAddress,\n    icons: [{ src: 'icon_link' }]\n  }\n  const appsMock = new BehaviorSubject([initialApp])\n  const identifiersMock = of({\n    '0x456': 'cool identifier'\n  })\n\n  const requestStub = {\n    params: ['observe', 'current']\n  }\n  const proxyStub = {\n    address: currentAppAddress\n  }\n  const wrapperStub = {\n    apm: {\n      getContentPath: (content, path) => `url/${path}`\n    },\n    apps: appsMock,\n    appIdentifiers: identifiersMock\n  }\n\n  // act\n  const result = await getApps(requestStub, proxyStub, wrapperStub)\n\n  // assert\n  let emitIndex = 0\n  result.subscribe(value => {\n    if (emitIndex === 0) {\n      t.deepEqual(value, {\n        abi: 'abi for coolApp',\n        appAddress: currentAppAddress,\n        appId: 'coolApp',\n        appImplementationAddress: '0xcoolApp',\n        identifier: 'cool identifier',\n        isForwarder: false,\n        kernelAddress: '0x123',\n        name: 'Cool App',\n        icons: [{ src: 'url/icon_link' }],\n        roles: 'roles for coolApp'\n      })\n    } else if (emitIndex === 1) {\n      t.deepEqual(value, {\n        abi: 'abi for coolApp',\n        appAddress: currentAppAddress,\n        appId: 'new coolApp',\n        appImplementationAddress: '0xcoolApp',\n        identifier: 'cool identifier',\n        isForwarder: false,\n        kernelAddress: '0x123',\n        name: 'Cool App',\n        icons: [{ src: 'url/icon_link' }],\n        roles: 'roles for coolApp'\n      })\n    } else {\n      t.fail('too many emissions')\n    }\n\n    emitIndex++\n  })\n\n  // We need apps' second emission to fire after the identifiers have emitted,\n  // so that the combineLatest doesn't skip the initial value\n  const endApp = {\n    ...initialApp,\n    appId: 'new coolApp'\n  }\n  appsMock.next([\n    // This extra app should be filtered out\n    {\n      appId: 'votingApp',\n      kernelAddress: '0x123',\n      contractAddress: '0xvotingApp',\n      abi: 'abi for votingApp',\n      roles: 'roles for votingApp',\n      isForwarder: true,\n      name: 'Voting App',\n      proxyAddress: '0x789',\n      icons: [{ src: 'icon_link' }]\n    },\n    endApp\n  ])\n})\n\ntest('should return the initial value for just the current app if getting current', async (t) => {\n  t.plan(1)\n\n  // arrange\n  const currentAppAddress = '0x456'\n  const initialApp = {\n    appId: 'coolApp',\n    contractAddress: '0xcoolApp',\n    kernelAddress: '0x123',\n    abi: 'abi for coolApp',\n    roles: 'roles for coolApp',\n    isForwarder: false,\n    name: 'Cool App',\n    proxyAddress: currentAppAddress,\n    icons: [{ src: 'icon_link' }]\n  }\n  const endApp = {\n    ...initialApp,\n    appId: 'new coolApp'\n  }\n  const appsMock = new BehaviorSubject([initialApp])\n  const identifiersMock = of({\n    '0x456': 'cool identifier'\n  })\n\n  const requestStub = {\n    params: ['get', 'current']\n  }\n  const proxyStub = {\n    address: currentAppAddress\n  }\n  const wrapperStub = {\n    apm: {\n      getContentPath: (content, path) => `url/${path}`\n    },\n    apps: appsMock,\n    appIdentifiers: identifiersMock\n  }\n\n  // act\n  const result = await getApps(requestStub, proxyStub, wrapperStub)\n\n  // assert\n  let emitIndex = 0\n  result.subscribe(value => {\n    if (emitIndex === 0) {\n      t.deepEqual(value, {\n        abi: 'abi for coolApp',\n        appAddress: currentAppAddress,\n        appId: 'coolApp',\n        appImplementationAddress: '0xcoolApp',\n        identifier: 'cool identifier',\n        isForwarder: false,\n        kernelAddress: '0x123',\n        name: 'Cool App',\n        icons: [{ src: 'url/icon_link' }],\n        roles: 'roles for coolApp'\n      })\n    } else {\n      t.fail('too many emissions')\n    }\n\n    emitIndex++\n  })\n\n  // Even though this is filtered out, we need apps' second emission to fire after the identifiers\n  // have emitted, so that the combineLatest doesn't skip the initial value\n  appsMock.next([endApp])\n})\n"],"file":"get-apps.test.js"}