{"version":3,"file":"index.js","names":["createResponse","request","id","error","value","kind","payload","signals","COMPLETE","Error","createRequestHandler","request$","requestType","handler","filteredRequest$","pipe","filter","method","mergeMap","proxy","wrapper","from","materialize","response","combineRequestHandlers","merge"],"sources":["../../../src/rpc/handlers/index.js"],"sourcesContent":["import { from, merge } from 'rxjs'\nimport { filter, mergeMap, materialize } from 'rxjs/operators'\nimport { signals } from '@aragon/rpc-messenger'\n\nexport function createResponse ({ request: { id } }, { error, value = null, kind }) {\n  if (kind === 'C') {\n    return { id, payload: signals.COMPLETE }\n  }\n\n  if (kind === 'E') {\n    return { id, payload: error || new Error() }\n  }\n\n  return { id, payload: value }\n}\n\nexport function createRequestHandler (request$, requestType, handler) {\n  // Filter request types to match provided params\n  const filteredRequest$ = request$.pipe(\n    filter(({ request }) => request.method === requestType)\n  )\n\n  // Send request to handler and return response\n  return filteredRequest$.pipe(\n    /**\n     * Turn the promise returned by the handler into an observable and materialize it, i.e:\n     * - if the observable emits, emit a Notification of kind 'N' (next) with a value property\n     * - if the observable rejects, emit a Notification of kind 'E' with an error property\n     * - if the observable completes, emit a Notification of kind 'C' (complete)\n     */\n    mergeMap(\n      ({ request, proxy, wrapper }) => {\n        return from(handler(request, proxy, wrapper)).pipe(materialize())\n      },\n      createResponse\n    ),\n    // TODO: instead of filtering, log if a payload is undefined\n    filter((response) => response.payload !== undefined)\n  )\n}\n\nexport function combineRequestHandlers (...handlers) {\n  return merge(\n    ...handlers\n  )\n}\n\n// Export request handlers\nexport { default as accounts } from './accounts'\nexport { default as cache } from './cache'\nexport { default as describeScript } from './describe-script'\nexport { default as describeTransaction } from './describe-transaction'\nexport { default as getApps } from './get-apps'\nexport { default as network } from './network'\nexport { default as path } from './path'\nexport { default as guiStyle } from './gui-style'\nexport { default as trigger } from './trigger'\nexport { default as web3Eth } from './web3-eth'\n\nexport { default as intent } from './intent'\nexport { default as call } from './call'\nexport { default as signMessage } from './sign-message'\nexport { default as events } from './events'\nexport { default as pastEvents } from './past-events'\n\nexport { intent as externalIntent } from './external'\nexport { call as externalCall } from './external'\nexport { events as externalEvents } from './external'\nexport { pastEvents as externalPastEvents } from './external'\n\nexport { default as addressIdentity } from './address-identity'\nexport { default as appIdentifier } from './app-identifier'\nexport { default as searchIdentities } from './search-identities'\n"],"mappings":"oJAqeuB;+gHAjehB,QAASA,eAAT,YAA6E,IAApD,CAAEC,OAAO,CAAE,CAAEC,EAAF,CAAX,CAAoD,MAA/B,CAAEC,KAAF,CAASC,KAAK,CAAG,IAAjB,CAAuBC,IAAvB,CAA+B,aACrE,GAAT,GAAAA,IAD8E,CAEzE,CAAEH,EAAF,CAAMI,OAAO,CAAEC,qBAAA,CAAQC,QAAvB,CAFyE,CAKrE,GAAT,GAAAH,IAL8E,CAMzE,CAAEH,EAAF,CAAMI,OAAO,CAAEH,KAAK,EAAI,GAAIM,MAA5B,CANyE,CAS3E,CAAEP,EAAF,CAAMI,OAAO,CAAEF,KAAf,CACR,CAEM,QAASM,qBAAT,CAA+BC,QAA/B,CAAyCC,WAAzC,CAAsDC,OAAtD,CAA+D,CACpE;AACA,KAAMC,iBAAgB,CAAGH,QAAQ,CAACI,IAAT,CACvB,GAAAC,iBAAA,EAAO,WAAC,CAAEf,OAAF,CAAD,aAAiBA,QAAO,CAACgB,MAAR,GAAmBL,WAApC,CAAP,CADuB,CAAzB,CAIA;AACA,MAAOE,iBAAgB,CAACC,IAAjB,CACL;AACJ;AACA;AACA;AACA;AACA,OACI,GAAAG,mBAAA,EACE,OAAiC,IAAhC,CAAEjB,OAAF,CAAWkB,KAAX,CAAkBC,OAAlB,CAAgC,OAC/B,MAAO,GAAAC,UAAA,EAAKR,OAAO,CAACZ,OAAD,CAAUkB,KAAV,CAAiBC,OAAjB,CAAZ,EAAuCL,IAAvC,CAA4C,GAAAO,sBAAA,GAA5C,CACR,CAHH,CAIEtB,cAJF,CAPK,CAaL;AACA,GAAAgB,iBAAA,EAAQO,QAAD,EAAcA,QAAQ,CAACjB,OAAT,SAArB,CAdK,CAgBR,CAEM,QAASkB,uBAAT,EAA8C,CACnD,MAAO,GAAAC,WAAA,EACL,YADK,CAGR,CAED"}