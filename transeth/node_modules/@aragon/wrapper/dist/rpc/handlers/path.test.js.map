{"version":3,"file":"path.test.js","names":["test","afterEach","always","sinon","restore","t","plan","pathContextMock","of","appContextPoolStub","get","stub","withArgs","APP_CONTEXTS","PATH","returns","result","path","params","address","appContextPool","emitIndex","subscribe","value","deepEqual","fail","newPath","mockResponseSymbol","Symbol","wrapperStub","requestAppPath","response","true","calledOnceWith","is","throwsAsync","message"],"sources":["../../../src/rpc/handlers/path.test.js"],"sourcesContent":["import test from 'ava'\nimport sinon from 'sinon'\nimport { of } from 'rxjs'\n\nimport { APP_CONTEXTS } from '../../apps'\nimport path from './path'\n\ntest.afterEach.always(() => {\n  sinon.restore()\n})\n\ntest(\"should return an observable for the app's paths on observe\", async (t) => {\n  t.plan(3)\n\n  // arrange\n  const appAddress = '0xABCD'\n  const pathContextMock = of('/', '/page1', '/page2')\n  const requestStub = {\n    params: ['observe']\n  }\n  const proxyStub = {\n    address: appAddress\n  }\n  const appContextPoolStub = {\n    get: sinon\n      .stub()\n      .withArgs(appAddress, APP_CONTEXTS.PATH)\n      .returns(pathContextMock)\n  }\n  const wrapperStub = {\n    appContextPool: appContextPoolStub\n  }\n\n  // act\n  const result = path(requestStub, proxyStub, wrapperStub)\n\n  // assert\n  let emitIndex = 0\n  result.subscribe(value => {\n    if (emitIndex === 0) {\n      t.deepEqual(value, '/')\n    } else if (emitIndex === 1) {\n      t.deepEqual(value, '/page1')\n    } else if (emitIndex === 2) {\n      t.deepEqual(value, '/page2')\n    } else {\n      t.fail('too many emissions')\n    }\n\n    emitIndex++\n  })\n})\n\ntest('should request app path on modify', async (t) => {\n  t.plan(2)\n\n  // arrange\n  const appAddress = '0xABCD'\n  const newPath = '/new'\n  const requestStub = {\n    params: ['modify', newPath]\n  }\n  const proxyStub = {\n    address: appAddress\n  }\n  const mockResponseSymbol = Symbol('response')\n  const wrapperStub = {\n    requestAppPath: sinon.stub().returns(mockResponseSymbol)\n  }\n\n  // act\n  const response = path(requestStub, proxyStub, wrapperStub)\n\n  // assert\n  t.true(wrapperStub.requestAppPath.calledOnceWith(appAddress, newPath))\n  t.is(response, mockResponseSymbol)\n})\n\ntest('should error on invalid path request', async (t) => {\n  t.plan(1)\n\n  // arrange\n  const appAddress = '0xABCD'\n  const requestStub = {\n    params: ['notHandled']\n  }\n  const proxyStub = {\n    address: appAddress\n  }\n\n  // assert\n  await t.throwsAsync(\n    path(requestStub, proxyStub),\n    { message: 'Invalid path operation' }\n  )\n})\n"],"mappings":"8RAOAA,YAAA,CAAKC,SAAL,CAAeC,MAAf,CAAsB,IAAM,CAC1BC,cAAA,CAAMC,OAAN,EACD,CAFD,C,CAIA,GAAAJ,YAAA,EAAK,4DAAL,CAAmE,KAAOK,EAAP,EAAa,CAC9EA,CAAC,CAACC,IAAF,CAAO,CAAP,CAD8E,CAG9E;AAH8E,KAKxEC,gBAAe,CAAG,GAAAC,QAAA,EAAG,GAAH,CAAQ,QAAR,CAAkB,QAAlB,CALsD,CAYxEC,kBAAkB,CAAG,CACzBC,GAAG,CAAEP,cAAA,CACFQ,IADE,GAEFC,QAFE,UAEmBC,kBAAA,CAAaC,IAFhC,EAGFC,OAHE,CAGMR,eAHN,CADoB,CAZmD,CAuBxES,MAAM,CAAG,GAAAC,aAAA,EAjBK,CAClBC,MAAM,CAAE,CAAC,SAAD,CADU,CAiBL,CAdG,CAChBC,OAAO,SADS,CAcH,CALK,CAClBC,cAAc,CAAEX,kBADE,CAKL,CAvB+D,CAyB9E;AACA,GAAIY,UAAS,CAAG,CAAhB,CACAL,MAAM,CAACM,SAAP,CAAiBC,KAAK,EAAI,CACN,CAAd,GAAAF,SADoB,CAEtBhB,CAAC,CAACmB,SAAF,CAAYD,KAAZ,CAAmB,GAAnB,CAFsB,CAGC,CAAd,GAAAF,SAHa,CAItBhB,CAAC,CAACmB,SAAF,CAAYD,KAAZ,CAAmB,QAAnB,CAJsB,CAKC,CAAd,GAAAF,SALa,CAMtBhB,CAAC,CAACmB,SAAF,CAAYD,KAAZ,CAAmB,QAAnB,CANsB,CAQtBlB,CAAC,CAACoB,IAAF,CAAO,oBAAP,CARsB,CAWxBJ,SAAS,EACV,CAZD,CAaD,CAxCD,C,CA0CA,GAAArB,YAAA,EAAK,mCAAL,CAA0C,KAAOK,EAAP,EAAa,CACrDA,CAAC,CAACC,IAAF,CAAO,CAAP,CADqD,CAGrD;AAHqD,KAK/CoB,QAAO,CAAG,MALqC,CAY/CC,kBAAkB,CAAGC,MAAM,CAAC,UAAD,CAZoB,CAa/CC,WAAW,CAAG,CAClBC,cAAc,CAAE3B,cAAA,CAAMQ,IAAN,GAAaI,OAAb,CAAqBY,kBAArB,CADE,CAbiC,CAkB/CI,QAAQ,CAAG,GAAAd,aAAA,EAZG,CAClBC,MAAM,CAAE,CAAC,QAAD,CAAWQ,OAAX,CADU,CAYH,CATC,CAChBP,OAAO,SADS,CASD,CAA6BU,WAA7B,CAlBoC,CAoBrD;AACAxB,CAAC,CAAC2B,IAAF,CAAOH,WAAW,CAACC,cAAZ,CAA2BG,cAA3B,UAAsDP,OAAtD,CAAP,CArBqD,CAsBrDrB,CAAC,CAAC6B,EAAF,CAAKH,QAAL,CAAeJ,kBAAf,CACD,CAvBD,C,CAyBA,GAAA3B,YAAA,EAAK,sCAAL,CAA6C,KAAOK,EAAP,EAAa,CACxDA,CAAC,CAACC,IAAF,CAAO,CAAP,CADwD,CAYxD;AACA,KAAMD,EAAC,CAAC8B,WAAF,CACJ,GAAAlB,aAAA,EATkB,CAClBC,MAAM,CAAE,CAAC,YAAD,CADU,CASlB,CANgB,CAChBC,OAAO,SADS,CAMhB,CADI,CAEJ,CAAEiB,OAAO,CAAE,wBAAX,CAFI,CAIP,CAjBD,C"}