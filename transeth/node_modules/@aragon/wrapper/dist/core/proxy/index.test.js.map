{"version":3,"sources":["../../../src/core/proxy/index.test.js"],"names":["test","beforeEach","t","configurationStub","getConfiguration","sinon","stub","utilsStub","events","eventsUtils","ContractProxy","default","context","afterEach","always","restore","plan","eventEmitter","EventEmitter","web3Stub","eth","Contract","returns","allEvents","instance","subscribe","event","deepEqual","foo","emit","amount","allEventEmitter","payFeeEventEmitter","allEventsStub","payFeeEventStub","PayFee","true","calledOnce","notCalled","eventCount","fail","initializationBlock","calledOnceWith","fromBlock","withArgs","configurationKeys","SUBSCRIPTION_EVENT_DELAY","startTime","Date","now","delayTime","Promise","resolve","toBlock","pastEventsStub","resolves","one","two","getPastEvents","pastEvents","calledWithExactly","is","length","calledWith"],"mappings":"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","sourcesContent":["import test from 'ava'\nimport proxyquire from 'proxyquire'\nimport sinon from 'sinon'\nimport { EventEmitter } from 'events'\nimport * as configurationKeys from '../../configuration/keys'\nimport * as eventsUtils from '../../utils/events'\n\ntest.beforeEach(t => {\n  const configurationStub = {\n    getConfiguration: sinon.stub()\n  }\n  const utilsStub = {\n    events: eventsUtils\n  }\n  const ContractProxy = proxyquire('./index', {\n    '../../configuration': configurationStub,\n    '../../utils': utilsStub\n  }).default\n\n  t.context = {\n    ContractProxy,\n    configurationStub,\n    utilsStub\n  }\n})\n\ntest.afterEach.always(() => {\n  sinon.restore()\n})\n\ntest('should get all the events', (t) => {\n  const { ContractProxy } = t.context\n\n  t.plan(1)\n  // arrange\n  const eventEmitter = new EventEmitter()\n  const contract = {\n    events: {\n      allEvents: () => eventEmitter\n    }\n  }\n\n  const web3Stub = {\n    eth: {\n      Contract: sinon.stub().returns(contract)\n    }\n  }\n  const instance = new ContractProxy(null, null, web3Stub)\n  // act\n  const events = instance.events()\n  // assert\n  events.subscribe(event => {\n    t.deepEqual(event, { foo: 'bar' })\n  })\n\n  eventEmitter.emit('data', { foo: 'bar' })\n})\n\ntest('should get only the requested events', (t) => {\n  const { ContractProxy } = t.context\n\n  t.plan(2)\n  // arrange\n  const eventEmitter = new EventEmitter()\n  const contract = {\n    events: {\n      allEvents: () => eventEmitter\n    }\n  }\n\n  const web3Stub = {\n    eth: {\n      Contract: sinon.stub().returns(contract)\n    }\n  }\n  const instance = new ContractProxy(null, null, web3Stub)\n  // act\n  const events = instance.events(['PayFee', 'PayService'])\n  // assert\n  events.subscribe(event => {\n    t.deepEqual(event.amount, 5)\n  })\n\n  eventEmitter.emit('data', { event: 'PayFee', amount: 5 })\n  eventEmitter.emit('data', { event: 'PaySomethingElse', amount: 10 })\n  eventEmitter.emit('data', { event: 'PayService', amount: 5 })\n})\n\ntest('should get only request the single event', (t) => {\n  const { ContractProxy } = t.context\n\n  t.plan(4)\n  // arrange\n  const allEventEmitter = new EventEmitter()\n  const payFeeEventEmitter = new EventEmitter()\n  const allEventsStub = sinon.stub().returns(allEventEmitter)\n  const payFeeEventStub = sinon.stub().returns(payFeeEventEmitter)\n  const contract = {\n    events: {\n      allEvents: allEventsStub,\n      PayFee: payFeeEventStub\n    }\n  }\n\n  const web3Stub = {\n    eth: {\n      Contract: sinon.stub().returns(contract)\n    }\n  }\n  const instance = new ContractProxy(null, null, web3Stub)\n  // act\n  const events = instance.events('PayFee')\n  // assert\n  t.true(payFeeEventStub.calledOnce)\n  t.true(allEventsStub.notCalled)\n\n  let eventCount = 0\n  events.subscribe(event => {\n    if (eventCount === 0) {\n      t.deepEqual(event.amount, 5)\n    } else if (eventCount === 1) {\n      t.deepEqual(event.amount, 10)\n    } else {\n      // Should only see it twice\n      t.fail()\n    }\n    ++eventCount\n  })\n\n  // Emit on both specific and all event emitters\n  allEventEmitter.emit('data', { event: 'PaySomethingElse', amount: 10 })\n  allEventEmitter.emit('data', { event: 'PayFee', amount: 5 })\n  payFeeEventEmitter.emit('data', { event: 'PayFee', amount: 5 })\n  allEventEmitter.emit('data', { event: 'PayFee', amount: 10 })\n  payFeeEventEmitter.emit('data', { event: 'PayFee', amount: 10 })\n  allEventEmitter.emit('data', { event: 'PayService', amount: 5 })\n})\n\ntest('should default the fromBlock to initializationBlock for requested events', (t) => {\n  const { ContractProxy } = t.context\n\n  t.plan(2)\n  // arrange\n  const initializationBlock = 5\n  const eventEmitter = new EventEmitter()\n  const allEventsStub = sinon.stub().returns(eventEmitter)\n  const contract = {\n    events: {\n      allEvents: allEventsStub\n    }\n  }\n\n  const web3Stub = {\n    eth: {\n      Contract: sinon.stub().returns(contract)\n    }\n  }\n  const instance = new ContractProxy(null, null, web3Stub, { initializationBlock })\n  // act\n  const events = instance.events()\n  // assert\n  t.true(allEventsStub.calledOnceWith({ fromBlock: initializationBlock }))\n  events.subscribe(event => {\n    t.deepEqual(event, { foo: 'bar' })\n  })\n\n  eventEmitter.emit('data', { foo: 'bar' })\n})\n\ntest('should use the correct options for requested events', (t) => {\n  const { ContractProxy } = t.context\n\n  t.plan(2)\n  // arrange\n  const fromBlock = 10\n  const eventEmitter = new EventEmitter()\n  const allEventsStub = sinon.stub().returns(eventEmitter)\n  const contract = {\n    events: {\n      allEvents: allEventsStub\n    }\n  }\n\n  const web3Stub = {\n    eth: {\n      Contract: sinon.stub().returns(contract)\n    }\n  }\n  const instance = new ContractProxy(null, null, web3Stub)\n  // act\n  const events = instance.events(null, { fromBlock })\n  // assert\n  t.true(allEventsStub.calledOnceWith({ fromBlock }))\n  events.subscribe(event => {\n    t.deepEqual(event, { foo: 'bar' })\n  })\n\n  eventEmitter.emit('data', { foo: 'bar' })\n})\n\ntest('should not apply a delay to events if not configured', (t) => {\n  const { ContractProxy, configurationStub } = t.context\n\n  t.plan(2)\n  // arrange\n  const eventEmitter = new EventEmitter()\n  const contract = {\n    events: {\n      allEvents: () => eventEmitter\n    }\n  }\n\n  const web3Stub = {\n    eth: {\n      Contract: sinon.stub().returns(contract)\n    }\n  }\n\n  // Set no delay\n  configurationStub.getConfiguration.withArgs(configurationKeys.SUBSCRIPTION_EVENT_DELAY).returns(0)\n  const instance = new ContractProxy(null, null, web3Stub)\n  // act\n  const events = instance.events()\n  // assert\n  const startTime = Date.now()\n\n  events.subscribe(event => {\n    t.deepEqual(event, { foo: 'bar' })\n    // Hard to say exactly how much time this will take, but 20ms seems safe\n    // (this should be immediate)\n    t.true((Date.now() - startTime) < 20)\n  })\n\n  eventEmitter.emit('data', { foo: 'bar' })\n})\n\ntest('should apply a delay to events if configured', (t) => {\n  const { ContractProxy, configurationStub } = t.context\n  const delayTime = 1000\n\n  t.plan(2)\n  // arrange\n  const eventEmitter = new EventEmitter()\n  const contract = {\n    events: {\n      allEvents: () => eventEmitter\n    }\n  }\n\n  const web3Stub = {\n    eth: {\n      Contract: sinon.stub().returns(contract)\n    }\n  }\n\n  // Set a delay\n  configurationStub.getConfiguration.withArgs(configurationKeys.SUBSCRIPTION_EVENT_DELAY).returns(delayTime)\n  const instance = new ContractProxy(null, null, web3Stub)\n  // act\n  const events = instance.events()\n  // assert\n  // Since we've added the delay, we need to tell ava to wait until we're done subscribing\n  return new Promise(resolve => {\n    const startTime = Date.now()\n    events.subscribe(event => {\n      t.deepEqual(event, { foo: 'bar' })\n      t.true((Date.now() - startTime) > delayTime)\n      resolve()\n    })\n\n    eventEmitter.emit('data', { foo: 'bar' })\n  })\n})\n\ntest('should use the correct options for requested past events with fromBlock and toBlock ', (t) => {\n  const { ContractProxy } = t.context\n\n  t.plan(4)\n  // arrange\n  const fromBlock = 10\n  const toBlock = 15\n\n  const pastEventsStub = sinon.stub().resolves([{ one: 1 }, { two: 2 }])\n\n  const contract = {\n    getPastEvents: pastEventsStub\n  }\n\n  const web3Stub = {\n    eth: {\n      Contract: sinon.stub().returns(contract)\n    }\n  }\n  const instance = new ContractProxy(null, null, web3Stub)\n  // act\n  const events = instance.pastEvents(null, { fromBlock, toBlock })\n  // assert\n  t.true(pastEventsStub.calledWithExactly('allEvents', { fromBlock, toBlock }))\n\n  events.subscribe(events => {\n    t.is(events.length, 2)\n    t.deepEqual(events[0], { one: 1 })\n    t.deepEqual(events[1], { two: 2 })\n  })\n  return events // return observable for ava to wait for its completion\n})\n\ntest('should use the correct options for requested past events with toBlock and initializationBlock set ', (t) => {\n  const { ContractProxy } = t.context\n\n  t.plan(1)\n  // arrange\n  const toBlock = 500\n  const initializationBlock = 20\n\n  const pastEventsStub = sinon.stub().resolves([{ one: 1 }, { two: 2 }])\n\n  const contract = {\n    getPastEvents: pastEventsStub\n  }\n\n  const web3Stub = {\n    eth: {\n      Contract: sinon.stub().returns(contract)\n    }\n  }\n  const instance = new ContractProxy(null, null, web3Stub, { initializationBlock })\n  // act\n  instance.pastEvents(null, { toBlock })\n  // assert\n  t.true(pastEventsStub.calledWithExactly('allEvents', { fromBlock: initializationBlock, toBlock }))\n})\n\ntest('should filter past events correctly when more than one eventName is passed', (t) => {\n  const { ContractProxy } = t.context\n\n  t.plan(4)\n  // arrange\n  const pastEventsStub = sinon.stub().resolves([\n    { event: 'Orange', amount: 16 },\n    { event: 'Apple', amount: 10 },\n    { event: 'Pear', amount: 5 }\n  ])\n\n  const contract = {\n    getPastEvents: pastEventsStub\n  }\n\n  const web3Stub = {\n    eth: {\n      Contract: sinon.stub().returns(contract)\n    }\n  }\n  const instance = new ContractProxy(null, null, web3Stub)\n  // act\n  const events = instance.pastEvents(['Orange', 'Pear'])\n  // assert\n  t.true(pastEventsStub.calledWith('allEvents'))\n\n  events.subscribe(events => {\n    t.is(events.length, 2)\n    t.deepEqual(events[0], { event: 'Orange', amount: 16 })\n    t.deepEqual(events[1], { event: 'Pear', amount: 5 })\n  })\n\n  return events // return observable for ava to wait for its completion\n})\n"],"file":"index.test.js"}