{"version":3,"file":"AsyncRequestCache.js","names":["AsyncRequestCache","constructor","requestFn","Map","has","key","request","invalidate","get","Promise","resolve","catch","err","delete","set"],"sources":["../../src/utils/AsyncRequestCache.js"],"sourcesContent":["/**\n * A cache to deduplicate async requests.\n */\nexport default class AsyncRequestCache {\n  #cache = new Map()\n  #requestFn\n\n  /**\n   * Create a new AsyncRequestCache that will use `requestFn` when requesting each key\n   *\n   * @param  {function} requestFn Async function for requesting each key\n   */\n  constructor (requestFn) {\n    this.#requestFn = requestFn\n  }\n\n  /**\n   * Check if the `key` is available in the cache\n   *\n   * @param  {string} key Key to check\n   * @return {boolean} If key is in the cache\n   */\n  has (key) {\n    return this.#cache.has(key)\n  }\n\n  /**\n   * Request `key`, using previous result if cached.\n   * Resets the cache for `key` if the request was not successful.\n   *\n   * @param  {string} key Key to request\n   * @param  {boolean} [invalidate] Invalidate any previous requests\n   * @return {Promise<*>} Request result\n   */\n  request (key, invalidate) {\n    if (!invalidate && this.has(key)) {\n      return this.#cache.get(key)\n    }\n    const request = Promise.resolve(this.#requestFn(key))\n      .catch((err) => {\n        this.#cache.delete(key)\n        throw err\n      })\n    this.#cache.set(key, request)\n    return request\n  }\n}\n"],"mappings":"oJAqeuB;gmBArevB;AACA;AACA,GACe,KAAMA,kBAAkB,CAIrC;AACF;AACA;AACA;AACA,KACEC,WAAW,CAAEC,SAAF,CAAa,2DARf,GAAIC,IAQW,6GACtB,IADsB,YACJD,SADI,CAEvB,CAED;AACF;AACA;AACA;AACA;AACA,KACEE,GAAG,CAAEC,GAAF,CAAO,CACR,MAAO,gDAAYD,GAAZ,CAAgBC,GAAhB,CACR,CAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA,KACEC,OAAO,CAAED,GAAF,CAAOE,UAAP,CAAmB,CACxB,GAAI,CAACA,UAAD,EAAe,KAAKH,GAAL,CAASC,GAAT,CAAnB,CACE,MAAO,gDAAYG,GAAZ,CAAgBH,GAAhB,CAAP,CAEF,KAAMC,QAAO,CAAGG,OAAO,CAACC,OAAR,oCAAgB,IAAhB,kBAAgB,IAAhB,CAAgCL,GAAhC,GACbM,KADa,CACNC,GAAD,EAAS,CAEd,KADA,gDAAYC,MAAZ,CAAmBR,GAAnB,CACA,CAAMO,GACP,CAJa,CAAhB,CAMA,MADA,gDAAYE,GAAZ,CAAgBT,GAAhB,CAAqBC,OAArB,CACA,CAAOA,OACR,CA1CoC,C"}