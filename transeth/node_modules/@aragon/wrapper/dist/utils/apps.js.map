{"version":3,"file":"apps.js","names":["apmAppId","appName","namehash","findAppMethod","app","methodTestFn","allowDeprecated","deprecatedFunctions","functions","method","Array","isArray","find","deprecatedFunctionsFromVersions","Object","values","every","allDeprecatedFunctions","concat","findAppMethodFromData","data","methodId","substring","soliditySha3","sig","findAppMethodFromSignature","methodSignature","fullMethodSignature","includes","methodName","split","knownAppIds"],"sources":["../../src/utils/apps.js"],"sourcesContent":["import { hash as namehash } from 'eth-ens-namehash'\nimport { soliditySha3 } from 'web3-utils'\n\nexport const apmAppId = appName => namehash(`${appName}.aragonpm.eth`)\n\nfunction findAppMethod (app, methodTestFn, { allowDeprecated } = {}) {\n  const { deprecatedFunctions, functions } = app || {}\n\n  let method\n  // First try to find the method in the current functions\n  if (Array.isArray(functions)) {\n    method = functions.find(methodTestFn)\n  }\n\n  if (!method && allowDeprecated) {\n    // The current functions didn't have it; try with each deprecated version's functions\n    const deprecatedFunctionsFromVersions = Object.values(deprecatedFunctions || {})\n    if (deprecatedFunctionsFromVersions.every(Array.isArray)) {\n      // Flatten all the deprecated functions\n      const allDeprecatedFunctions = [].concat(...deprecatedFunctionsFromVersions)\n      method = allDeprecatedFunctions.find(methodTestFn)\n    }\n  }\n\n  return method\n}\n\n/**\n * Find the method descriptor corresponding to the data component of a\n * transaction sent to `app`.\n *\n * @param  {Object} app App artifact\n * @param  {Object} data Data component of a transaction to app\n * @param  {Object} options Options\n * @param  {boolean} [options.allowDeprecated] Allow deprecated functions to be returned. Defaults to true.\n * @return {Object|void} Method with radspec notice and function signature, or undefined if none was found\n */\nexport function findAppMethodFromData (app, data, { allowDeprecated = true } = {}) {\n  const methodId = data.substring(2, 10)\n  return findAppMethod(\n    app,\n    method => soliditySha3(method.sig).substring(2, 10) === methodId,\n    { allowDeprecated }\n  )\n}\n\n/**\n * Find the method descriptor corresponding to an app's method signature.\n *\n * @param  {Object} app App artifact\n * @param  {string} methodSignature Method signature to be called\n * @param  {Object} options Options\n * @param  {boolean} [options.allowDeprecated] Allow deprecated functions to be returned. Defaults to true.\n * @return {Object|void} Method with radspec notice and function signature, or undefined if none was found\n */\nexport function findAppMethodFromSignature (app, methodSignature, { allowDeprecated = true } = {}) {\n  // Is the given method a full signature, e.g. 'foo(arg1,arg2,...)'\n  const fullMethodSignature =\n    Boolean(methodSignature) && methodSignature.includes('(') && methodSignature.includes(')')\n\n  return findAppMethod(\n    app,\n    method => {\n      // Note that fallback functions have the signature 'fallback' in an app's artifact.json\n      if (fullMethodSignature) {\n        return method.sig === methodSignature\n      }\n\n      // If full signature isn't given, just match against the method names\n      const methodName = method.sig.split('(')[0]\n      return methodName === methodSignature\n    },\n    { allowDeprecated }\n  )\n}\n\nexport const knownAppIds = [\n  apmAppId('finance'),\n  apmAppId('token-manager'),\n  apmAppId('vault'),\n  apmAppId('voting')\n]\n"],"mappings":"iEAqeuB;yPAlehB,KAAMA,SAAQ,CAAGC,OAAO,EAAI,GAAAC,oBAAA,EAAU,GAAED,OAAQ,eAApB,CAA5B,C,0BAEP,QAASE,cAAT,CAAwBC,GAAxB,CAA6BC,YAA7B,CAAqE,IAA1B,CAAEC,eAAF,CAA0B,wDAAJ,EAAI,CACnE,KAAM,CAAEC,mBAAF,CAAuBC,SAAvB,EAAqCJ,GAAG,EAAI,EAAlD,CAEA,GAAIK,OAAJ,CACA;AAKA,GAJIC,KAAK,CAACC,OAAN,CAAcH,SAAd,CAIJ,GAHEC,MAAM,CAAGD,SAAS,CAACI,IAAV,CAAeP,YAAf,CAGX,EAAI,CAACI,MAAD,EAAWH,eAAf,CAAgC,CAC9B;AACA,KAAMO,gCAA+B,CAAGC,MAAM,CAACC,MAAP,CAAcR,mBAAmB,EAAI,EAArC,CAAxC,CACA,GAAIM,+BAA+B,CAACG,KAAhC,CAAsCN,KAAK,CAACC,OAA5C,CAAJ,CAA0D,CACxD;AACA,KAAMM,uBAAsB,CAAG,GAAGC,MAAH,CAAU,GAAGL,+BAAb,CAA/B,CACAJ,MAAM,CAAGQ,sBAAsB,CAACL,IAAvB,CAA4BP,YAA5B,CACV,CACF,CAED,MAAOI,OACR,CAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GACO,QAASU,sBAAT,CAAgCf,GAAhC,CAAqCgB,IAArC,CAA4E,IAAjC,CAAEd,eAAe,GAAjB,CAAiC,wDAAJ,EAAI,CACjF,KAAMe,SAAQ,CAAGD,IAAI,CAACE,SAAL,CAAe,CAAf,CAAkB,EAAlB,CAAjB,CACA,MAAOnB,cAAa,CAClBC,GADkB,CAElBK,MAAM,EAAI,GAAAc,uBAAA,EAAad,MAAM,CAACe,GAApB,EAAyBF,SAAzB,CAAmC,CAAnC,CAAsC,EAAtC,IAA8CD,QAFtC,CAGlB,CAAEf,eAAF,CAHkB,CAKrB,CAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GACO,QAASmB,2BAAT,CAAqCrB,GAArC,CAA0CsB,eAA1C,CAA4F,IAAjC,CAAEpB,eAAe,GAAjB,CAAiC,wDAAJ,EAAI,CACjG;AACA,KAAMqB,oBAAmB,CACvB,EAAQD,eAAR,EAA4BA,eAAe,CAACE,QAAhB,CAAyB,GAAzB,CAA5B,EAA6DF,eAAe,CAACE,QAAhB,CAAyB,GAAzB,CAD/D,CAGA,MAAOzB,cAAa,CAClBC,GADkB,CAElBK,MAAM,EAAI,CACR;AACA,GAAIkB,mBAAJ,CACE,MAAOlB,OAAM,CAACe,GAAP,GAAeE,eAAtB,CAGF;AACA,KAAMG,WAAU,CAAGpB,MAAM,CAACe,GAAP,CAAWM,KAAX,CAAiB,GAAjB,EAAsB,CAAtB,CAAnB,CACA,MAAOD,WAAU,GAAKH,eACvB,CAXiB,CAYlB,CAAEpB,eAAF,CAZkB,CAcrB,CAEM,KAAMyB,YAAW,CAAG,CACzB/B,QAAQ,CAAC,SAAD,CADiB,CAEzBA,QAAQ,CAAC,eAAD,CAFiB,CAGzBA,QAAQ,CAAC,OAAD,CAHiB,CAIzBA,QAAQ,CAAC,QAAD,CAJiB,CAApB,C"}