{"version":3,"file":"past-events.test.js","names":["test","beforeEach","t","utilsStub","events","eventsUtils","pastEvents","proxyquire","default","context","plan","mockObservable","Symbol","proxyStub","sinon","stub","returns","pastEventsObservable","params","fromBlock","true","calledOnceWithExactly","is","calledOnceWith","toBlock"],"sources":["../../../src/rpc/handlers/past-events.test.js"],"sourcesContent":["import test from 'ava'\nimport proxyquire from 'proxyquire'\nimport sinon from 'sinon'\n\nimport * as eventsUtils from '../../utils/events'\n\ntest.beforeEach(t => {\n  const utilsStub = {\n    events: eventsUtils\n  }\n  const pastEvents = proxyquire('./past-events', {\n    '../../utils': utilsStub\n  }).default\n\n  t.context = {\n    pastEvents,\n    utilsStub\n  }\n})\n\ntest('should invoke proxy.pastEvents with the correct options', async (t) => {\n  const { pastEvents } = t.context\n\n  t.plan(2)\n  // arrange\n  const mockObservable = Symbol('mockObservable')\n  const proxyStub = {\n    pastEvents: sinon.stub().returns(mockObservable)\n  }\n  const requestStub = {\n    params: ['allEvents', { fromBlock: 5 }]\n  }\n  // act\n  const pastEventsObservable = pastEvents(requestStub, proxyStub)\n  // assert\n  t.true(proxyStub.pastEvents.calledOnceWithExactly(['allEvents'], { fromBlock: 5 }))\n  t.is(pastEventsObservable, mockObservable)\n})\n\ntest('should invoke proxy.pastEvents with the correct options for aragonAPIv1', async (t) => {\n  const { pastEvents } = t.context\n\n  t.plan(2)\n  // arrange\n  const mockObservable = Symbol('mockObservable')\n  const proxyStub = {\n    pastEvents: sinon.stub().returns(mockObservable)\n  }\n  // aragonAPIv1 only passes the fromBlock\n  const requestStub = {\n    params: [5, 10]\n  }\n  // act\n  const pastEventsObservable = pastEvents(requestStub, proxyStub)\n  // assert\n  t.true(proxyStub.pastEvents.calledOnceWith(null, { fromBlock: 5, toBlock: 10 }))\n  t.is(pastEventsObservable, mockObservable)\n})\n\ntest('should invoke proxy.pastEvents with the correct options for aragonAPIv1 when no fromBlock is passed', async (t) => {\n  const { pastEvents } = t.context\n\n  t.plan(2)\n  // arrange\n  const mockObservable = Symbol('mockObservable')\n  const proxyStub = {\n    pastEvents: sinon.stub().returns(mockObservable)\n  }\n  // aragonAPIv1 does not need to pass the fromBlock\n  const requestStub = {\n    params: []\n  }\n  // act\n  const pastEventsObservable = pastEvents(requestStub, proxyStub)\n  // assert\n  t.true(proxyStub.pastEvents.calledOnceWith(null, { fromBlock: undefined, toBlock: undefined }))\n  t.is(pastEventsObservable, mockObservable)\n})\n"],"mappings":"+uCAMAA,YAAA,CAAKC,UAAL,CAAgBC,CAAC,EAAI,MACbC,UAAS,CAAG,CAChBC,MAAM,CAAEC,WADQ,CADC,CAIbC,UAAU,CAAG,GAAAC,mBAAA,EAAW,eAAX,CAA4B,CAC7C,cAAeJ,SAD8B,CAA5B,EAEhBK,OANgB,CAQnBN,CAAC,CAACO,OAAF,CAAY,CACVH,UADU,CAEVH,SAFU,CAIb,CAZD,C,CAcA,GAAAH,YAAA,EAAK,yDAAL,CAAgE,KAAOE,EAAP,EAAa,CAC3E,KAAM,CAAEI,UAAF,EAAiBJ,CAAC,CAACO,OAAzB,CAEAP,CAAC,CAACQ,IAAF,CAAO,CAAP,CAH2E,CAI3E;AAJ2E,KAKrEC,eAAc,CAAGC,MAAM,CAAC,gBAAD,CAL8C,CAMrEC,SAAS,CAAG,CAChBP,UAAU,CAAEQ,cAAA,CAAMC,IAAN,GAAaC,OAAb,CAAqBL,cAArB,CADI,CANyD,CAarEM,oBAAoB,CAAGX,UAAU,CAJnB,CAClBY,MAAM,CAAE,CAAC,WAAD,CAAc,CAAEC,SAAS,CAAE,CAAb,CAAd,CADU,CAImB,CAAcN,SAAd,CAboC,CAc3E;AACAX,CAAC,CAACkB,IAAF,CAAOP,SAAS,CAACP,UAAV,CAAqBe,qBAArB,CAA2C,CAAC,WAAD,CAA3C,CAA0D,CAAEF,SAAS,CAAE,CAAb,CAA1D,CAAP,CAf2E,CAgB3EjB,CAAC,CAACoB,EAAF,CAAKL,oBAAL,CAA2BN,cAA3B,CACD,CAjBD,C,CAmBA,GAAAX,YAAA,EAAK,yEAAL,CAAgF,KAAOE,EAAP,EAAa,CAC3F,KAAM,CAAEI,UAAF,EAAiBJ,CAAC,CAACO,OAAzB,CAEAP,CAAC,CAACQ,IAAF,CAAO,CAAP,CAH2F,CAI3F;AAJ2F,KAKrFC,eAAc,CAAGC,MAAM,CAAC,gBAAD,CAL8D,CAMrFC,SAAS,CAAG,CAChBP,UAAU,CAAEQ,cAAA,CAAMC,IAAN,GAAaC,OAAb,CAAqBL,cAArB,CADI,CANyE,CAcrFM,oBAAoB,CAAGX,UAAU,CAJnB,CAClBY,MAAM,CAAE,CAAC,CAAD,CAAI,EAAJ,CADU,CAImB,CAAcL,SAAd,CAdoD,CAe3F;AACAX,CAAC,CAACkB,IAAF,CAAOP,SAAS,CAACP,UAAV,CAAqBiB,cAArB,CAAoC,IAApC,CAA0C,CAAEJ,SAAS,CAAE,CAAb,CAAgBK,OAAO,CAAE,EAAzB,CAA1C,CAAP,CAhB2F,CAiB3FtB,CAAC,CAACoB,EAAF,CAAKL,oBAAL,CAA2BN,cAA3B,CACD,CAlBD,C,CAoBA,GAAAX,YAAA,EAAK,qGAAL,CAA4G,KAAOE,EAAP,EAAa,CACvH,KAAM,CAAEI,UAAF,EAAiBJ,CAAC,CAACO,OAAzB,CAEAP,CAAC,CAACQ,IAAF,CAAO,CAAP,CAHuH,CAIvH;AAJuH,KAKjHC,eAAc,CAAGC,MAAM,CAAC,gBAAD,CAL0F,CAMjHC,SAAS,CAAG,CAChBP,UAAU,CAAEQ,cAAA,CAAMC,IAAN,GAAaC,OAAb,CAAqBL,cAArB,CADI,CANqG,CAcjHM,oBAAoB,CAAGX,UAAU,CAJnB,CAClBY,MAAM,CAAE,EADU,CAImB,CAAcL,SAAd,CAdgF,CAevH;AACAX,CAAC,CAACkB,IAAF,CAAOP,SAAS,CAACP,UAAV,CAAqBiB,cAArB,CAAoC,IAApC,CAA0C,CAAEJ,SAAS,OAAX,CAAwBK,OAAO,OAA/B,CAA1C,CAAP,CAhBuH,CAiBvHtB,CAAC,CAACoB,EAAF,CAAKL,oBAAL,CAA2BN,cAA3B,CACD,CAlBD,C"}