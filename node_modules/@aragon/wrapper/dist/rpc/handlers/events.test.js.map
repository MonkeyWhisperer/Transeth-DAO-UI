{"version":3,"file":"events.test.js","names":["test","beforeEach","t","utilsStub","events","eventsUtils","proxyquire","default","context","plan","mockObservable","Symbol","proxyStub","sinon","stub","returns","eventsObservable","params","fromBlock","true","calledOnceWithExactly","is","calledOnceWith"],"sources":["../../../src/rpc/handlers/events.test.js"],"sourcesContent":["import test from 'ava'\nimport proxyquire from 'proxyquire'\nimport sinon from 'sinon'\n\nimport * as eventsUtils from '../../utils/events'\n\ntest.beforeEach(t => {\n  const utilsStub = {\n    events: eventsUtils\n  }\n  const events = proxyquire('./events', {\n    '../../utils': utilsStub\n  }).default\n\n  t.context = {\n    events,\n    utilsStub\n  }\n})\n\ntest('should invoke proxy.events with the correct options', async (t) => {\n  const { events } = t.context\n\n  t.plan(2)\n  // arrange\n  const mockObservable = Symbol('mockObservable')\n  const proxyStub = {\n    events: sinon.stub().returns(mockObservable)\n  }\n  const requestStub = {\n    params: ['allEvents', { fromBlock: 5 }]\n  }\n  // act\n  const eventsObservable = events(requestStub, proxyStub)\n  // assert\n  t.true(proxyStub.events.calledOnceWithExactly(['allEvents'], { fromBlock: 5 }))\n  t.is(eventsObservable, mockObservable)\n})\n\ntest('should invoke proxy.events with the correct options for aragonAPIv1', async (t) => {\n  const { events } = t.context\n\n  t.plan(2)\n  // arrange\n  const mockObservable = Symbol('mockObservable')\n  const proxyStub = {\n    events: sinon.stub().returns(mockObservable)\n  }\n  // aragonAPIv1 only passes the fromBlock\n  const requestStub = {\n    params: [5]\n  }\n  // act\n  const eventsObservable = events(requestStub, proxyStub)\n  // assert\n  t.true(proxyStub.events.calledOnceWith(null, { fromBlock: 5 }))\n  t.is(eventsObservable, mockObservable)\n})\n\ntest('should invoke proxy.events with the correct options for aragonAPIv1 when no fromBlock is passed', async (t) => {\n  const { events } = t.context\n\n  t.plan(2)\n  // arrange\n  const mockObservable = Symbol('mockObservable')\n  const proxyStub = {\n    events: sinon.stub().returns(mockObservable)\n  }\n  // aragonAPIv1 does not need to pass the fromBlock\n  const requestStub = {\n    params: []\n  }\n  // act\n  const eventsObservable = events(requestStub, proxyStub)\n  // assert\n  t.true(proxyStub.events.calledOnceWith(null, { fromBlock: undefined }))\n  t.is(eventsObservable, mockObservable)\n})\n"],"mappings":"+uCAMAA,YAAA,CAAKC,UAAL,CAAgBC,CAAC,EAAI,MACbC,UAAS,CAAG,CAChBC,MAAM,CAAEC,WADQ,CADC,CAIbD,MAAM,CAAG,GAAAE,mBAAA,EAAW,UAAX,CAAuB,CACpC,cAAeH,SADqB,CAAvB,EAEZI,OANgB,CAQnBL,CAAC,CAACM,OAAF,CAAY,CACVJ,MADU,CAEVD,SAFU,CAIb,CAZD,C,CAcA,GAAAH,YAAA,EAAK,qDAAL,CAA4D,KAAOE,EAAP,EAAa,CACvE,KAAM,CAAEE,MAAF,EAAaF,CAAC,CAACM,OAArB,CAEAN,CAAC,CAACO,IAAF,CAAO,CAAP,CAHuE,CAIvE;AAJuE,KAKjEC,eAAc,CAAGC,MAAM,CAAC,gBAAD,CAL0C,CAMjEC,SAAS,CAAG,CAChBR,MAAM,CAAES,cAAA,CAAMC,IAAN,GAAaC,OAAb,CAAqBL,cAArB,CADQ,CANqD,CAajEM,gBAAgB,CAAGZ,MAAM,CAJX,CAClBa,MAAM,CAAE,CAAC,WAAD,CAAc,CAAEC,SAAS,CAAE,CAAb,CAAd,CADU,CAIW,CAAcN,SAAd,CAbwC,CAcvE;AACAV,CAAC,CAACiB,IAAF,CAAOP,SAAS,CAACR,MAAV,CAAiBgB,qBAAjB,CAAuC,CAAC,WAAD,CAAvC,CAAsD,CAAEF,SAAS,CAAE,CAAb,CAAtD,CAAP,CAfuE,CAgBvEhB,CAAC,CAACmB,EAAF,CAAKL,gBAAL,CAAuBN,cAAvB,CACD,CAjBD,C,CAmBA,GAAAV,YAAA,EAAK,qEAAL,CAA4E,KAAOE,EAAP,EAAa,CACvF,KAAM,CAAEE,MAAF,EAAaF,CAAC,CAACM,OAArB,CAEAN,CAAC,CAACO,IAAF,CAAO,CAAP,CAHuF,CAIvF;AAJuF,KAKjFC,eAAc,CAAGC,MAAM,CAAC,gBAAD,CAL0D,CAMjFC,SAAS,CAAG,CAChBR,MAAM,CAAES,cAAA,CAAMC,IAAN,GAAaC,OAAb,CAAqBL,cAArB,CADQ,CANqE,CAcjFM,gBAAgB,CAAGZ,MAAM,CAJX,CAClBa,MAAM,CAAE,CAAC,CAAD,CADU,CAIW,CAAcL,SAAd,CAdwD,CAevF;AACAV,CAAC,CAACiB,IAAF,CAAOP,SAAS,CAACR,MAAV,CAAiBkB,cAAjB,CAAgC,IAAhC,CAAsC,CAAEJ,SAAS,CAAE,CAAb,CAAtC,CAAP,CAhBuF,CAiBvFhB,CAAC,CAACmB,EAAF,CAAKL,gBAAL,CAAuBN,cAAvB,CACD,CAlBD,C,CAoBA,GAAAV,YAAA,EAAK,iGAAL,CAAwG,KAAOE,EAAP,EAAa,CACnH,KAAM,CAAEE,MAAF,EAAaF,CAAC,CAACM,OAArB,CAEAN,CAAC,CAACO,IAAF,CAAO,CAAP,CAHmH,CAInH;AAJmH,KAK7GC,eAAc,CAAGC,MAAM,CAAC,gBAAD,CALsF,CAM7GC,SAAS,CAAG,CAChBR,MAAM,CAAES,cAAA,CAAMC,IAAN,GAAaC,OAAb,CAAqBL,cAArB,CADQ,CANiG,CAc7GM,gBAAgB,CAAGZ,MAAM,CAJX,CAClBa,MAAM,CAAE,EADU,CAIW,CAAcL,SAAd,CAdoF,CAenH;AACAV,CAAC,CAACiB,IAAF,CAAOP,SAAS,CAACR,MAAV,CAAiBkB,cAAjB,CAAgC,IAAhC,CAAsC,CAAEJ,SAAS,OAAX,CAAtC,CAAP,CAhBmH,CAiBnHhB,CAAC,CAACmB,EAAF,CAAKL,gBAAL,CAAuBN,cAAvB,CACD,CAlBD,C"}